[TOC]

***ç”±äºŽé‡‡ç”¨ Typora ä¹¦å†™ï¼Œgithub ä¸æ”¯æŒéƒ¨åˆ†æ ¼å¼ï¼Œå»ºè®® clone åŽç”¨ Typora è§‚çœ‹***

# è‡ªå®šä¹‰Viewä¸ŽåŠ¨ç”»

## ä¸€ã€è‡ªå®šä¹‰View

### 1ã€ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ï¼Ÿ

> ä¸€å¥è¯ï¼šå®˜æ–¹çš„æŽ§ä»¶æ»¡è¶³ä¸äº†äº§å“æƒ³è¦çš„æ•ˆæžœ (
>
> ä½†å…¶å®žï¼Œå®˜æ–¹æŽ§ä»¶å·²ç»èƒ½æ»¡è¶³ç»å¤§å¤šæ•°éœ€æ±‚äº†ï¼Œæ­£å¸¸æƒ…å†µä¸‹è‡ªå®šä¹‰ View æ˜¯ä¸‹ä¸‹ç­–ï¼Œå› ä¸ºé€ è‡ªå®šä¹‰ View çš„è½®å­æ˜¯ä¸€ä»¶å¾ˆè€—æ—¶ä¹Ÿå¾ˆè€—ç²¾åŠ›çš„äº‹ã€‚
>
> è¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘å¤§ä¸€æš‘å‡æ—¶é‡åˆ°çš„äº‹æƒ…ï¼Œå½“æ—¶å…± 5 ä¸ªç»„åˆ†å¼€åšç§¯åˆ†å•†åŸŽï¼Œäº§å“ç»™äº†ä¸€ä¸ªç§¯åˆ†å•†åŸŽçš„è®¾è®¡å›¾ï¼Œå…¶ä¸­ä¸»é¡µæœ‰ä¸€ä¸ªä¸Šæ»‘å±•å¼€çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ç»„ï¼ˆæˆ‘å’Œé’Ÿæ™ºï¼‰ï¼Œæˆ‘å°±è´Ÿè´£åšè¿™ä¸ªä¸Šæ»‘çš„ç•Œé¢ã€‚å½“æ—¶æˆ‘èŠ±äº†å¥½åƒ 3ã€4 å¤©çš„æ—¶é—´åŽ»è®¾è®¡ä¸€ä¸ªè‡ªå®šä¹‰ Viewï¼ˆåŽŸè°…æˆ‘å½“æ—¶è¿˜ä¸çŸ¥é“åè°ƒè€…å¸ƒå±€è¿™ä¸ªä¸œè¥¿ï¼‰ï¼Œç»“æžœå•Šï¼Œäº§å“æ”¹éœ€æ±‚äº†ï¼Œé 
>
> ç»è¿‡ä¸Šé¢çš„è¿™ä¸ªæ•…äº‹åŽï¼Œç›¸ä¿¡å¤§å®¶åº”è¯¥ç†è§£åˆ°äº†é€‰æ‹©è‡ªå®šä¹‰ View ä¼šé¢ä¸´çš„é£Žé™©
>
> åŽæ¥æˆ‘åˆèŠ±äº†æŽ¥è¿‘ä¸€å‘¨çš„æ—¶é—´è¿˜æ˜¯ç”¨è‡ªå®šä¹‰ View å†™å‡ºäº†äº§å“çš„æ–°éœ€æ±‚ï¼Œé™äºŽå½“æ—¶æˆ‘çš„èƒ½åŠ›ï¼ŒçŽ°åœ¨åŽ»çœ‹å½“æ—¶å†™çš„ä»£ç ï¼Œå­˜åœ¨ä¸€äº›è€¦åˆçš„åœ°æ–¹ï¼Œç®—æ˜¯ç»™ä»¥åŽå­¦å¼Ÿç•™å‘äº†ðŸ˜
>
> OKï¼Œå›žåˆ°è¿™é‡Œï¼Œè‡ªå®šä¹‰ View ç¡®å®žæ˜¯ä¸‹ä¸‹ç­–ï¼Œä¸æ­¢ä¼šå½±å“ä½ çš„å¿ƒæƒ…ï¼Œå¦‚æžœä½ çš„ä»£ç è®¾è®¡å¾—ä¸å¥½çš„è¯ï¼ˆæ¯”å¦‚è€¦åˆåº¦å¾ˆé«˜ï¼Œä»£ç é€»è¾‘æ··ä¹±ï¼‰ï¼Œè¿˜ä¼šå½±å“ä»¥åŽç»´æŠ¤ä»£ç äººçš„å¿ƒæƒ…ã€‚ï¼ˆè¯´ä¸ªç¬‘è¯ï¼šå¬è¯´ä»£ç å†™å¾—è¶Šçƒ‚ï¼Œè¶Šä¸å®¹æ˜“è¢«è¾žé€€ :ï¼‰

### 2ã€åˆ†ç±»

> è¿™é‡Œè‡ªå®šä¹‰ View æ˜¯ä¸€ä¸ªä¹ æƒ¯æ€§çš„ç»Ÿç§°
>
> å¦‚æžœæŒ‰ç…§ç±»åž‹æ¥åˆ†ï¼š
>
> - è‡ªå®šä¹‰ View
>
>   > æŒ‡ç›´æŽ¥æˆ–é—´æŽ¥ç»§æ‰¿äºŽ View çš„æŽ§ä»¶ï¼Œå¦‚ï¼šTextViewã€Button
>   >
>   > ```java
>   > public class TextView extends View {}
>   > ```
>   >
>   > ```java
>   > public class Button extends TextView {}
>   > ```
>   >
>   > 
>
> - è‡ªå®šä¹‰ ViewGroup
>
>   > ```java
>   > public class LinearLayout extends ViewGroup {}
>   > ```
>   >
>   > ```java
>   > public class FrameLayout extends ViewGroup {}
>   > ```
>
> 
>
> å¦‚æžœæŒ‰ç…§å­¦ä¹ çš„å†…å®¹æ¥åˆ†ï¼Œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å†…å®¹
>
> - View çš„æµ‹é‡ä¸Žå¸ƒå±€
>
>   > æµ‹é‡å°±æ˜¯ä¸Ž Measure ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ï¼š`onMeasure()`
>   >
>   > å¸ƒå±€å°±æ˜¯ä¸Ž Layout ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ï¼š`onLayout()`
>   >
>   > è¿™ä¸¤ä¸ªä¸€èˆ¬æ˜¯åœ¨ä¸€èµ·è°ƒç”¨çš„ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯åœ¨ è‡ªå®šä¹‰ ViewGroup ä¸­æ‰ä¼šæ¶‰åŠåˆ°ï¼ˆView ä¸­ä¹Ÿå¯ä»¥å®žçŽ°ï¼Œæ¯”å¦‚ TextView å°±é‡å†™äº† `onLayout()` æ–¹æ³•ï¼‰
>
> - View çš„ç»˜åˆ¶
>
>   > ç»˜åˆ¶å°±æ˜¯ä¸Ž Draw ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ï¼š`onDraw()`
>   >
>   > ä¸ºä»€ä¹ˆè¦åˆ—å‡ºç»˜åˆ¶ï¼Ÿ
>   >
>   > å› ä¸ºå¾ˆå¤šåŠ¨ç”»éƒ½æ˜¯ä¾é é‡å†™ç»˜åˆ¶æ¥å®žçŽ°çš„ï¼Œæ‰€ä»¥ç»˜åˆ¶ä¹Ÿæ¯”è¾ƒé‡è¦
>
> - äº‹ä»¶åˆ†å‘
>
>   >ä¸€èˆ¬æŒ‡è§¦æ‘¸äº‹ä»¶çš„åˆ†å‘
>   >
>   >è¿™ä¸ªåº”è¯¥æ˜¯è‡ªå®šä¹‰ View ä¸­æœ€éš¾ä¹Ÿæœ€é‡è¦çš„å†…å®¹äº†ï¼Œå¦‚æžœä½ æƒ³è®¾è®¡å‡ºä¸€äº›å¾ˆç‚«é…·çš„ç•Œé¢ï¼Œå°±å¾—ç²¾é€šäº‹ä»¶åˆ†å‘
>   >
>   >äº‹ä»¶åˆ†å‘ä¼šåœ¨ä¸‹ä¸‹èŠ‚è¯¾è®²è§£
>
> æŽ¥ä¸‹æ¥å°±æ˜¯æ­£å¼å¼€å§‹è®²è§£è‡ªå®šä¹‰ View çš„æ—¶é—´ï¼Œç”±äºŽæ—¶é—´åŽŸå› ï¼Œåœ¨åŠ ä¸Šä½ ä»¬çš„çŽ°é˜¶æ®µèƒ½åŠ›çš„åŽŸå› ï¼Œæœ¬èŠ‚è¯¾æ›´åå‘äºŽè®²è§£å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰ Viewï¼Œè€Œä¸æ˜¯è®²è§£åº•å±‚å†…å®¹ï¼Œåº•å±‚å†…å®¹ä»¥åšå®¢çš„å½¢å¼åˆ†äº«

### 3ã€æž„é€ å‡½æ•°

> è¯¥éƒ¨åˆ†å†…å®¹å‚è€ƒï¼šhttps://www.cnblogs.com/angeldevil/p/3479431.html#three
>
> View ä¸€å…±æœ‰å››ä¸ªæž„é€ å‡½æ•°
>
> ```java
> public class View {
> // è¿™ä¸ªç”¨äºŽåœ¨ä»£ç ä¸­ç›´æŽ¥ new ä¸€ä¸ª Viewï¼Œè¿™ä¸ª context ä¸€èˆ¬éƒ½æ˜¯ activityï¼Œä»£è¡¨ä¸Šä¸‹æ–‡
> public View(Context context)
> 
> // è¿™ä¸ªç”¨äºŽåœ¨ xml ä¸­ä¹¦å†™ï¼Œç³»ç»Ÿè‡ªåŠ¨å°†ä½ å†™åœ¨ xml ä¸­çš„å±žæ€§è£…æ¢ä¸ºä¸€ä¸ª AttributeSet å¯¹è±¡ï¼Œç„¶åŽè°ƒç”¨è¿™ä¸ªå‡½æ•°
> public View(
> Context context, 
> @Nullable AttributeSet attrs
> )
> 
> // è¿™ä¸ªä¸€èˆ¬ç”¨äºŽè®¾ç½®é»˜è®¤å±žæ€§ï¼Œä½¿ç”¨çš„æƒ…å†µè¾ƒå°‘
> // ç³»ç»Ÿä¸ä¼šä¸»åŠ¨è°ƒç”¨ï¼Œä¸€èˆ¬æ˜¯å¼€å‘è€…è‡ªå·±è®¾ç½®
> public View(
> Context context, 
> @Nullable AttributeSet attrs, 
> int defStyleAttr
> )
> 
> // è¿™ä¸ªä¸Žä¸Šé¢çš„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯è®¾ç½®é»˜è®¤å±žæ€§ï¼Œä½¿ç”¨çš„æƒ…å†µä¹Ÿè¾ƒå°‘ï¼Œä¸”åªæ”¯æŒ Android 5.0 ä»¥ä¸Š
> // ç³»ç»Ÿä¸ä¼šä¸»åŠ¨è°ƒç”¨
> public View(
> Context context, 
> @Nullable AttributeSet attrs, 
> int defStyleAttr, 
> int defStyleRes
> )
> }
> 
> ```
>
> å‰é¢ä¸¤ä¸ªæž„é€ å‡½æ•°å„ä½åº”è¯¥éƒ½èƒ½çœ‹æ‡‚ï¼Œå…³é”®åœ¨äºŽåŽé¢ä¸¤ä¸ªï¼Œä»–ä»¬ä¸Žè®¾ç½®é»˜è®¤å±žæ€§ç›¸å…³ï¼Œåœ¨è®²è§£å‰æˆ‘ä»¬å…ˆå¾—çŸ¥é“ä¸€ä¸ª View å¯ä»¥é€šè¿‡å“ªäº›æ–¹å¼è®¾ç½®å±žæ€§

#### 1ã€ç›´æŽ¥å†™åœ¨ XML ä¸­

> ```xml
> <androidx.cardview.widget.CardView
> android:layout_width="200dp"
> android:layout_height="200dp"
> app:cardBackgroundColor="@android:color/darker_gray"
> app:cardCornerRadius="8dp"/>
> ```
>
> è¿™æ ·å°±ä¼šç»™å½“å‰ View è®¾ç½®å±žæ€§
>
> åŽŸç†æ˜¯ç³»ç»Ÿè‡ªåŠ¨æŠŠè¿™äº›å±žæ€§å†™å…¥åˆ° AttributeSet ç±»é‡Œé¢ï¼Œç„¶åŽè°ƒç”¨
>
> ```kotlin
> public View(Context context, @Nullable AttributeSet attrs)
> ```
>
> æ¥ç”Ÿæˆ View å¯¹è±¡
>
> 

#### 2ã€ä½¿ç”¨ @style è®¾ç½®å±žæ€§

> åœ¨ `style.xml` ä¸­ï¼š
>
> ```xml
> <style name="myCardView_style">
>     <item name="cardBackgroundColor">@android:color/darker_gray</item>
>     <item name="cardCornerRadius">8dp</item>
> </style>
> ```
>
> åœ¨ `layout.xml` ä¸­ï¼š
>
> ```xml
> <androidx.cardview.widget.CardView
>  android:layout_width="200dp"
>  android:layout_height="200dp"
>  style="@style/myCardView_style"/>
> ```
>
> è¿™ä¸ªä¸€èˆ¬ç”¨äºŽå¤šä¸ªç›¸åŒæŽ§ä»¶å¤ç”¨å±žæ€§çš„æ—¶å€™
>
> åŽŸç†ä¸Žä¸Šä¸€ä¸ªæ˜¯ä¸€æ ·çš„ï¼Œå®ƒä¼šæŠŠ `style="@style/MyCardView"` é‡Œå†™çš„å±žæ€§ä¸€èµ·å†™å…¥ AttributeSet ç±»é‡Œé¢
>
> > é—®é¢˜ï¼šå¦‚æžœ `style="@style/MyCardView"` ä¸Ž xml ä¸­æœ‰ç›¸åŒå±žæ€§å®ƒä¼šæ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿ
> >
> > ç»è¿‡æµ‹è¯•åŽï¼Œxml ä¸­å®šä¹‰çš„å±žæ€§ä¼šè¦†ç›– `style="@style/MyCardView"` ä¸­å®šä¹‰çš„å±žæ€§
> >
> > 

#### 3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æŽ§ä»¶çš„é»˜è®¤å±žæ€§

> åœ¨ `theme.xml` ä¸­ï¼š
>
> ```xml
> <style name="MyAppTheme" parent="Theme.MaterialComponents">
>  <!--ä¸‹é¢è¿™ä¸ª @style/MyCardView å°±æ˜¯å‰é¢å†™çš„ <style name="MyCardView">-->
>  <item name="cardViewStyle">@style/myCardView_style</item>
> </style>
> ```
>
> è¿™é‡Œ `name="cardViewStyle"` æ„æ€æ˜¯å®šä¹‰ CardView çš„é»˜è®¤å±žæ€§
> è¿™ä¸ªé»˜è®¤å±žæ€§æ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿ
>
> ```java
> // åŽŸå› åœ¨äºŽ CardView çš„æž„é€ å‡½æ•°
> public CardView(
> @NonNull Context context, 
> @Nullable AttributeSet attrs
> ) {
> this(context, attrs, R.attr.cardViewStyle);
> }
> 
> public CardView(
> @NonNull Context context, 
> @Nullable AttributeSet attrs, 
> int defStyleAttr
> ) {
> super(context, attrs, defStyleAttr);
> }
> ```
>
> è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼Œä¸¤ä¸ªå‚æ•°çš„æž„é€ å‡½æ•°ä½¿ç”¨äº† `this(context, attrs, R.attr.cardViewStyle)` è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°çš„æž„é€ å‡½æ•°ï¼Œå…¶ä¸­ä»–ç»™ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥äº†ä¸€ä¸ªå€¼ `R.attr.cardViewStyle`ï¼Œæˆ‘ä»¬åŽ»æ‰’å®ƒæºç ï¼Œçœ‹ä¸‹è¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ˆç›´æŽ¥ç‚¹å‡»å¯¼åŒ…ä¸­çš„ `import androidx.cardview.R` å°±å¯ä»¥è·³åˆ°æºç ä¸­ï¼‰
>
> ```xml
> <resources>
> <attr format="reference" name="cardViewStyle"/>
> </resources>
> ```
>
> è¿™é‡Œå¯èƒ½ä½ ä»¬ä¼šçœ‹ä¸æ‡‚ï¼Œæˆ‘ç®€å•è®²ä¸€ä¸‹ï¼šè¿™ä¸ª `format="reference"` ä»£è¡¨è¿™ä¸ªå±žæ€§æŽ¥å—çš„ç±»åž‹ï¼Œè€Œ `reference` è¡¨ç¤ºæŽ¥å—çš„ç±»åž‹ä¸ºä¸€ä¸ªå¼•ç”¨å€¼ï¼Œæ¯”å¦‚ï¼š`@style/xxx`ã€`@color/xxx`ã€`@drawable/xxx` å°±æ˜¯å¼•ç”¨å€¼
>
> ç„¶åŽ `name="cardViewStyle"` ä»£è¡¨è¿™ä¸ªå±žæ€§çš„å”¯ä¸€åå­—
>
> è¿™ä¸ª attr çš„å¼•ç”¨å°±æ˜¯ CardView å¯ä»¥åœ¨ theme ä¸­è®¾ç½®é»˜è®¤å±žæ€§çš„åŽŸå› ï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨ CardView ä¸¤ä¸ªå‚æ•°çš„æž„é€ å‡½æ•°ï¼Œç„¶åŽå®ƒè¿™ä¸ªæž„é€ å‡½æ•°ä¸»åŠ¨è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°çš„æž„é€ å‡½æ•°ï¼Œå¹¶ä¸”ä¼ å…¥äº† `R.attr.cardViewStyle`ï¼Œæ‰€ä»¥æž„é€ å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å¯¹åº”çš„æ˜¯ä¸€ä¸ª`style` æ ¼å¼çš„å¼•ç”¨ï¼Œä½†éœ€è¦ä½ è‡ªå·±åœ¨ View ä¸­æŒ‡å®šåå­—
>
> å¼•ç”¨ `theme.xml` æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š
>
> - å…¨å±€å¼•ç”¨ï¼Œæ‰€æœ‰ View éƒ½ä¼šä½¿ç”¨è¯¥é…ç½®
>
>   ```xml
>   <application
>       android:theme="@style/MyAppTheme">
>   </application>
>   ```
>
> - æŸä¸ª Activity å¼•ç”¨ï¼Œå½“å‰ Activity å†…ä½¿ç”¨è¯¥é…ç½®
>
>   ```xml
>   <activity
>       android:name=".section3.test.TestActivity"
>       android:theme="@style/MyAppTheme"
>       android:exported="false" />
>   ```
>
> - æŸä¸ª Activity ä½¿ç”¨ä»£ç å¼•ç”¨
>
>   ```kotlin
>   override fun onCreate(savedInstanceState: Bundle?) {
>       super.onCreate(savedInstanceState)
>       setTheme(R.style.MyAppTheme)
>       setContentView(R.layout.layout_card0)
>   }
>   // æ³¨æ„åœ¨ Activity ä¸­ä½¿ç”¨å¿…é¡»åœ¨ setContentView ä¹‹å‰
>   ```
>
> - å•ä¸ª View ä½¿ç”¨
>
>   ```xml
>   <androidx.cardview.widget.CardView
>       android:layout_width="200dp"
>       android:layout_height="200dp"
>       android:theme="@style/MyAppTheme" />
>   ```
>
> çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½æœ‰ç‚¹æ™•ï¼Œæˆ‘ä»¬ç®€å•æ¢³ç†ä¸€ä¸‹æµç¨‹ï¼š
>
> ```mermaid
> graph TB
> id1("ç³»ç»Ÿè¯»å–ä½ å†™çš„ xml")-->id2
> id2["ç”Ÿæˆ AttributeSetï¼Œç„¶åŽè°ƒç”¨ä¸¤ä¸ªå‚æ•°çš„æž„é€ å‡½æ•°"]-->id3
> id3["ä¸¤ä¸ªå‚æ•°çš„è°ƒç”¨ä¸‰ä¸ªå‚æ•°çš„ï¼Œå¹¶ä¼ å…¥ R.attr.cardViewStyle"]-->id4
> id4["View å¼€å§‹ä»Ž theme ä¸­è¯»å–å±žæ€§"]-->id5
> id5["View åœ¨ theme ä¸­å‘çŽ° name=cardViewStyle>xxxx< çš„å®šä¹‰"]-->id6
> id6("è¯»å– @style/MyCardView é‡Œé¢çš„å±žæ€§")
> ```
>
> 

#### 4ã€è°ƒç”¨æž„é€ å‡½æ•°çš„ defStyleRes

> ç”±äºŽ CardView æ²¡æœ‰é‡å†™ç¬¬å››ä¸ªæž„é€ å‡½æ•°ï¼ˆå¯èƒ½æ˜¯ä¸ºäº†å…¼å®¹ Android 5.0 ä»¥ä¸‹ï¼Ÿï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ç”¨ FrameLayout æ¥æ¼”ç¤º
>
> å…ˆåœ¨ `style.xml` ä¸­å®šä¹‰å±žæ€§ï¼š
>
> ```xml
> <style name="myFrameLayout">
>  <item name="android:layout_width">match_parent</item>
>  <item name="android:layout_height">match_parent</item>
>  <item name="android:background">@android:color/black</item>
> </style>
> ```
>
> ç„¶åŽåœ¨ä»£ç ä¸­è¿™æ ·ä½¿ç”¨ï¼š
>
> ```kotlin
> val frameLayout = FrameLayout(this, null, 0, R.style.myFrameLayout_style)
> ```
>
> å½“ä½ ä¸èƒ½åœ¨ xml ä¸­ç”³æ˜Žï¼Œåªèƒ½åœ¨ä»£ç ä¸­åŠ¨æ€ç”Ÿæˆæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§å†™æ³•ï¼Œæœ‰ä¸ªä¼˜ç‚¹å°±æ˜¯ä½¿ç”¨ `style.xml` å¯ä»¥è¿›è¡Œå±žæ€§çš„å¤ç”¨ï¼Œä½†ä¸€èˆ¬éƒ½ç”¨ä¸åˆ°å¤ç”¨ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ LayoutParams å’Œè°ƒç”¨å¯¹åº”æ–¹æ³•æ¥ä»£æ›¿ï¼š
>
> ```kotlin
> val frameLayout = FrameLayout(this)
> // Android ç¬¬ä¸€èŠ‚è¯¾æˆ‘ä»¬è®²è¿‡ï¼Œçˆ¶å¸ƒå±€å¯ä»¥ç»™å­å¸ƒå±€è®¾ç½®å±žæ€§
> // ä¸”å±žæ€§éƒ½ä»¥ layout_ å¼€å¤´ï¼Œæ‰€ä»¥ layout_width å’Œ layout_height 
> // å¯¹åº”ç”± LayoutParams æ¥è®¾ç½®
> frameLayout.layoutParams = ViewGroup.LayoutParams(
>  ViewGroup.LayoutParams.MATCH_PARENT,
>  ViewGroup.LayoutParams.MATCH_PARENT
> )
> // background å±žäºŽ View è‡ªèº«å±žæ€§ï¼Œæ‰€ä»¥å¯¹åº” View è‡ªèº«æ–¹æ³•
> frameLayout.setBackgroundColor(Color.BLACK)
> 
> // ä½†è¿™æ ·å†™æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ï¼šLayoutParams è¿™ä¸œè¥¿åªèƒ½è®¾ç½®å°‘é‡çš„å±žæ€§ï¼Œ
> // è€Œä¸” LayoutParams æœ‰å¾ˆå¤šä¸ªï¼Œå…·ä½“é€‰æ‹©é‚£ä¸ªéœ€è¦çœ‹ä½ çš„ View è¢«æ·»åŠ åˆ°
> // å“ªç§çˆ¶å¸ƒå±€é‡Œï¼Œå¦‚æžœæ˜¯ LinearLayoutï¼Œå°±æ˜¯ LinearLayout.LayoutParams(...)
> ```
>
> å¯èƒ½æœ‰äººä¸çŸ¥é“ LayoutParams æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œä½ æš‚æ—¶å¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯ç”¨æ¥ä¿å­˜ View ä¸­æœ‰å…³**çˆ¶å¸ƒå±€å±žæ€§**çš„ä¸€ä¸ªæ•°æ®ç±»ï¼Œä¾›çˆ¶å¸ƒå±€ä½¿ç”¨ï¼ŒåŽé¢ä¼šå†æ¬¡è®²è§£
>
> é™¤äº†ä¸Šé¢è¿™ç§åŠ¨æ€ç”Ÿæˆæ—¶ä¼ å…¥é»˜è®¤å±žæ€§ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æž„é€ å™¨ä¸­è®¾ç½®ä½ çš„è‡ªå®šä¹‰ View çš„é»˜è®¤å±žæ€§ï¼š
>
> ä¸€èˆ¬æ˜¯è¿™æ ·å®šä¹‰æž„é€ å™¨çš„ï¼š
>
> ```kotlin
> // ç”±äºŽ java æ˜¯åŸºç¡€ï¼Œæˆ‘å…ˆç”¨ java æ¥å®šä¹‰æž„é€ å™¨ï¼ŒåŽé¢å†ä½¿ç”¨ kt æ¥ä¼˜åŒ–å†™æ³•
> public class Section3View extends View {
>  public Section3View(Context context) {
>      // æ³¨æ„è¿™é‡Œè°ƒç”¨çš„æ˜¯ thisï¼Œè€Œä¸æ˜¯ super
>      this(context, null);
>  }
> 
>  public Section3View(
>      Context context, 
>      @Nullable AttributeSet attrs
>  ) {
>      // æ³¨æ„è¿™é‡Œè°ƒç”¨çš„æ˜¯ thisï¼Œè€Œä¸æ˜¯ super
>      this(context, attrs, R.attr.mySection3View_attrs);
>  }
> 
>  public Section3View(
>      Context context, 
>      @Nullable AttributeSet attrs, 
>      int defStyleAttr
>  ) {
>      // æ³¨æ„è¿™é‡Œè°ƒç”¨çš„æ˜¯ thisï¼Œè€Œä¸æ˜¯ super
>      // è¿™é‡Œå°±æ˜¯è®¾ç½®é»˜è®¤å±žæ€§
>      this(
>          context, 
>          attrs, 
>          defStyleAttr, 
>          R.style.mySection3View_defaultAttrs
>      );
>  }
> 
>  public Section3View(
>      Context context, 
>      @Nullable AttributeSet attrs, 
>      int defStyleAttr, 
>      int defStyleRes
>  ) {
>      // ç›´åˆ°è¿™é‡Œæ‰è°ƒç”¨ super
>      super(context, attrs, defStyleAttr, defStyleRes);
>  }
> }
> ```
>
> å…¶ä¸­ `R.attr.mySection3View_attrs`ï¼š
>
> ```xml
> <!--value/attrs.xml-->
> <resources>
>  <attr name="mySection3View_attrs" format="reference"/>
> </resources>
> ```
>
> å…¶ä¸­ `R.style.mySection3View_defaultAttrs`ï¼š
>
> ```xml
> <!--value/style.xml-->
> <style name="mySection3View_defaultAttrs">
>  <item name="android:background">@android:color/black</item>
> </style>
> ```
>
> å¦‚æžœä½ åŽ»å¯¹ç…§å®˜æ–¹æŽ§ä»¶çš„å†™æ³•ï¼Œä½ ä¼šå‘çŽ°ä»–ä»¬çš„æž„é€ å‡½æ•°ä¹Ÿæ˜¯è¿™æ ·å†™çš„ï¼Œå‰ä¸‰ä¸ªéƒ½æ˜¯è°ƒç”¨ `this()`ï¼Œåªæœ‰æœ€åŽä¸€ä¸ªè°ƒç”¨   `super()`ï¼Œä½†ä»–ä»¬ä¸€èˆ¬åªè®¾ç½®äº† `R.attr.mySection3View_attrs`ï¼Œç”¨äºŽå¼€å‘è€…åœ¨ theme ä¸­å®šä¹‰å…¨å±€å±žæ€§ï¼ˆ[ç¬¬ä¸‰ç‚¹](#3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æŽ§ä»¶çš„é»˜è®¤å±žæ€§)ï¼‰ï¼Œè€Œ `R.style.mySection3View_defaultAttrs` åœ¨å®˜ç½‘æŽ§ä»¶ä¸­ä¸€èˆ¬æ²¡è®¾ç½®ï¼Œéƒ½æ˜¯å†™ä¸ª 0ï¼Œä»£è¡¨æ²¡å¾—é»˜è®¤å±žæ€§
>
> > ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªé»˜è®¤å±žæ€§ï¼Ÿ
> >
> > ```java
> > public View(
> > Context context, 
> > @Nullable AttributeSet attrs, 
> > int defStyleAttr, 
> > int defStyleRes
> > )
> > ```
> >
> > ä½ ä¼šå‘çŽ°ç¬¬ä¸‰ä¸ªå‚æ•° `defStyleAttr` å’Œç¬¬å››ä¸ª `defStyleRes` éƒ½æ˜¯è®¾ç½®é»˜è®¤å‚æ•°ï¼Œä½†ä¸ºä»€ä¹ˆè¦åŒæ—¶å­˜åœ¨ä¸¤ä¸ªå‘¢ï¼Ÿ
> >
> > åŽŸå› ï¼š`defStyleAttr` æ˜¯ä»Ž theme ä¸­è¯»å–é»˜è®¤å€¼ï¼Œä½†å¦‚æžœæˆ‘ä»¬åªèƒ½åŠ¨æ€ç”Ÿæˆ Viewï¼Œåˆéœ€è¦å¤šæ¬¡ç”¨åˆ°ä¸€äº›å±žæ€§ï¼Œåœ¨ Android 5.0 ä¹‹å‰è¦ä¹ˆæ¯æ¬¡éƒ½æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•æ¥è®¾ç½®ï¼Œè¦ä¹ˆå†™åœ¨ theme ä¸­ï¼Œä½†è¿™æ ·æœªå…éº»çƒ¦äº†äº›ï¼Œåœ¨ Android 5.0 åŽå¢žåŠ äº†è¿™ä¸ª `defStyleRes` å‚æ•°ï¼Œå°±å¯ä»¥ç›´æŽ¥æŠŠå±žæ€§å†™åœ¨ `style.xml` ä¸­ï¼Œæ–¹ä¾¿å¤ç”¨
> >
> > **ä½†è¿™é‡Œæœ‰å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼š**ä½¿ç”¨ `defStyleRes` æ—¶ä¸èƒ½è®¾ç½® `defStyleAttr`ï¼Œç»™ `defStyleAttr` å¡«å…¥ 0 æˆ–è€… theme ä¸­ä¸è®¾ç½®å¯¹åº”çš„å±žæ€§å³å¯
>
> å›žåˆ°è¿™é‡Œï¼Œå‰é¢ java çš„å†™æ³•ç¡®å®žæ„Ÿè§‰æœ‰äº›è‡ƒè‚¿äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ kt çš„å†™æ³•ï¼š
>
> ```kotlin
> // å¿…é¡»æ·»åŠ  @JvmOverloadsï¼Œä¸ç„¶ java å±‚æ— æ³•ä½¿ç”¨è¯¥æž„é€ å™¨
> // ä¼šå¯¼è‡´ xml ä¸­çš„ View æ— æ³•ç”Ÿæˆ
> class Section3ViewKt @JvmOverloads constructor(
>     context: Context,
>     attrs: AttributeSet? = null,
>     defStyleAttr: Int = R.attr.mySection3View_attrs,
>     defStyleRes: Int = R.style.mySection3View_defaultAttrs
> ) : View(context, attrs, defStyleAttr, defStyleRes) {
> }
> // å¦‚æžœä½ æ²¡å¾— R.attr.mySection3View æˆ– R.style.MySection3View_defaultAttrs
> // å¯ä»¥ç›´æŽ¥èµ‹å€¼ä¸º 0ï¼Œå°±æ˜¯æ²¡å¾—é»˜è®¤å±žæ€§è®¾ç½®
> ```
>
> **è®²åˆ°è¿™é‡Œï¼Œæž„é€ å‡½æ•°ä¸­çš„å››ä¸ªå‚æ•°å„ä½åº”è¯¥çŸ¥é“æœ‰ä»€ä¹ˆä½œç”¨äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼š**
>
> ```java
> public View(Context context)
> // ç”¨äºŽåœ¨ä»£ç ä¸­åŠ¨æ€ç”Ÿæˆè‡ªå®šä¹‰ View
> ```
>
> ```java
> public View(
>     Context context, 
>     @Nullable AttributeSet attrs
> )
> // ç”¨äºŽå†™åœ¨ xml é‡Œé¢ç³»ç»Ÿè°ƒç”¨
> ```
>
> ```java
> public View(
>     Context context,
>     @Nullable AttributeSet attrs, 
>     int defStyleAttr
> )
> // ç”¨äºŽè®¾ç½®å…¨å±€é»˜è®¤å±žæ€§å€¼ï¼Œé€šå¸¸æ˜¯é€šè¿‡ä¸Šé¢ä¸¤ä¸ªå‚æ•°çš„æž„é€ å‡½æ•°æ¥é—´æŽ¥è°ƒç”¨
> ```
>
> ```java
> public View(
>     Context context, 
>     @Nullable AttributeSet attrs, 
>     int defStyleAttr, 
>     int defStyleRes
> )
> // ä¹Ÿæ˜¯ç”¨äºŽè®¾ç½®é»˜è®¤å±žæ€§å€¼ï¼Œåªæ˜¯ä¸ç”¨å†™åœ¨ theme ä¸­ï¼Œé€šå¸¸ç”¨äºŽåŠ¨æ€ç”Ÿæˆä»£ç ä¸­æˆ–è‡ªå·±è‡ªå®šä¹‰ View çš„æ—¶å€™
> ```
>
> å‰é¢è®²äº† 4 ç§æ–¹å¼æ¥è®¾ç½®å±žæ€§ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼ä¹Ÿå¯ä»¥æ¥è®¾ç½®å±žæ€§
>

#### 5ã€ç›´æŽ¥åœ¨ theme ä¸­å®šä¹‰å±žæ€§

> è¿™ä¸ªä¸Žç¬¬ä¸‰ç‚¹ï¼š[åœ¨ theme ä¸­è®¾ç½®æŸç§æŽ§ä»¶çš„é»˜è®¤å±žæ€§](#3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æŽ§ä»¶çš„é»˜è®¤å±žæ€§) æœ‰äº›ç±»ä¼¼ï¼Œä½†å®ƒå€¼å…è®¸ç›´æŽ¥å†™åœ¨ theme ä¸­
>
> ```xml
> <resources xmlns:tools="http://schemas.android.com/tools">
>     <style name="Theme.CustomViewWithAnimStudy" parent="Theme.MaterialComponents.DayNight.DarkActionBar">
>         <!--å¦‚æžœä½ åŠ äº†è¿™è¡Œä»£ç ï¼Œä½ ä¼šå‘çŽ°åº”ç”¨å¤§éƒ¨åˆ†æŽ§ä»¶å˜æˆé»‘è‰²äº†-->
>         <item name="android:background">@android:color/black</item>
>     </style>
> </resources>
> ```
>
> **ä½†æ˜¯ï¼Œ**è¿™ä¸ªæ˜¯ä¸åˆ†æŽ§ä»¶çš„ç»™å…¨éƒ¨ View è®¾ç½®å±žæ€§ï¼Œä¸€èˆ¬ä¸ä¼šä½¿ç”¨åˆ°å®ƒï¼Œåªæœ‰è®¾ç½®æ•´ä¸ªåº”ç”¨çš„ä¸»é¢˜æ—¶ä¼šç”¨åˆ°
>
> æ¯”å¦‚ä½ å¯ä»¥è¯•è¯•æŠŠè¿™å‡ ä¸ªå±žæ€§æ”¹ä¸€ä¸‹ï¼Œå°±ä¼šå‘çŽ°åº”ç”¨çš„æ ‡é¢˜æ é¢œè‰²ä»Žç´«è‰²æ”¹æˆäº†ä½ è®¾ç½®çš„é¢œè‰²
>
> ```xml
> <item name="colorPrimary">@color/purple_500</item>
> <item name="colorPrimaryVariant">@color/purple_700</item>
> <item name="colorOnPrimary">@color/white</item>
> <item name="colorSecondary">@color/teal_200</item>
> <item name="colorSecondaryVariant">@color/teal_700</item>
> <item name="colorOnSecondary">@color/black</item>
> ```
>
> è¿™äº›å±žæ€§å¯¹åº”äº†æŸç§å…·ä½“ä½ç½®çš„é¢œè‰²ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡åšå®¢ï¼šhttps://blog.csdn.net/smartzzg/article/details/104788412
>
> ### äº”ç§å±žæ€§å®šä¹‰æ–¹æ³•çš„é¡ºåº
>
> > æˆ‘ä»¬è®²äº†æœ‰ 5 ç§ä¸åŒçš„å±žæ€§å®šä¹‰ï¼Œå¦‚æžœå®šä¹‰äº†ç›¸åŒå±žæ€§ï¼Œä»–ä»¬å­˜åœ¨ä¸€ä¸ªä¼˜å…ˆçº§é¡ºåºï¼š
> >
> > [1ã€ç›´æŽ¥å†™åœ¨ XML ä¸­](#1ã€ç›´æŽ¥å†™åœ¨ XML ä¸­)
> >
> > [2ã€ä½¿ç”¨ @style è®¾ç½®å±žæ€§](#2ã€ä½¿ç”¨ @style è®¾ç½®å±žæ€§)
> >
> > [3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æŽ§ä»¶çš„é»˜è®¤å±žæ€§](#3ã€åœ¨ theme ä¸­è®¾ç½®æŸç§æŽ§ä»¶çš„é»˜è®¤å±žæ€§)
> >
> > [4ã€è°ƒç”¨æž„é€ å‡½æ•°çš„ defStyleRes](#4ã€è°ƒç”¨æž„é€ å‡½æ•°çš„ defStyleRes)
> >
> > [5ã€ç›´æŽ¥åœ¨ theme ä¸­å®šä¹‰å±žæ€§](#5ã€ç›´æŽ¥åœ¨ theme ä¸­å®šä¹‰å±žæ€§)
> >
> > è¿™é‡Œæ³¨æ„ï¼šä½¿ç”¨ `defStyleRes ` æ—¶ä¸èƒ½è®¾ç½® `defStyleAttr`ï¼Œç»™ `defStyleAttr` å¡«å…¥ 0 æˆ–è€… theme ä¸­ä¸è®¾ç½®å¯¹åº”çš„å±žæ€§å³å¯
>
> **åˆ°è¿™é‡Œ View çš„å››ä¸ªæž„é€ å‡½æ•°åŸºæœ¬åˆ†æžå®Œæ¯•äº†ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è®²è§£é‡Œé¢çš„æ–¹æ³•**

### 4ã€onDraw()

> ### ä½œç”¨
>
> å¯¹ View è¿›è¡Œç»˜åˆ¶
>
> ### æ¶‰åŠå†…å®¹
>
> - [Canvas ç”»å¸ƒ](#1ã€Canvas ç”»å¸ƒ)
> - [Paint ç”»ç¬”](#2ã€Paint ç”»ç¬”)
> - [Path è·¯å¾„](#3ã€Path è·¯å¾„)
>
> ```kotlin
> // è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªå›žè°ƒï¼Œä¸ºä»€ä¹ˆæ˜¯å›žè°ƒï¼Œåœ¨ä¹‹åŽçš„ invalidate() ä¼šè¿›è¡Œè®²è§£
> override fun onDraw(canvas: Canvas?) {
> super.onDraw(canvas)
> }
> ```
>
> > è¿™é‡Œè®²ä¸€ä¸ªå°æŠ€å·§ï¼šå¯ä»¥æŠŠ `Canvas?` ä¸­çš„ `?` ä¸ºåŽ»æŽ‰
> >
> > å› ä¸ºåœ¨ kt é‡å†™ `onDraw()` æ–¹æ³•æ—¶ï¼Œæºä»£ç  java å±‚ä¸­å¹¶æ²¡æœ‰ç»™å‚æ•° `canvas` åŠ ä¸Š `@NonNull`ï¼Œå¯¼è‡´ kt ä¸çŸ¥é“å®ƒä¼šä¸ä¼šä¸ºç©ºï¼Œä½†æˆ‘ä»¬ä½œä¸ºå¼€å‘è€…è‚¯å®šæ˜¯çŸ¥é“å®ƒä¸ä¼šä¸ºç©ºçš„ï¼Œæ‰€ä»¥åŽ»æŽ‰ `?`ï¼Œå¯ä»¥å‡å°‘åŽç»­çš„åˆ¤æ–­ï¼Œä¸ç„¶å¾ˆå¯èƒ½å†™å‡ºè¿™æ ·çš„ä»£ç 
> >
> > ```kotlin
> > override fun onDraw(canvas: Canvas?) {
> >     super.onDraw(canvas)
> >     canvas?.drawRect(0F, 0F, 100F, 200F, mBlackPaint)
> >     canvas?.drawRect(0F, 0F, 100F, 200F, mBlackPaint)
> >     canvas?.drawRect(0F, 0F, 100F, 200F, mBlackPaint)
> >     canvas?.drawRect(0F, 0F, 100F, 200F, mBlackPaint)
> >     canvas?.drawRect(0F, 0F, 100F, 200F, mBlackPaint)
> >     canvas?.drawRect(0F, 0F, 100F, 200F, mBlackPaint)
> > }
> > ```
> >
> > çœ‹ç€å¥½åƒæ²¡å¾—ä»€ä¹ˆé—®é¢˜ï¼Œä¸å°±å¤šæ‰“äº†ä¸€ä¸ª `?` å—ï¼Ÿ
> >
> > ç¡®å®žçœ‹ç€æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†ä½ æŠŠ kt è½¬æˆ javaï¼Œä½ å°±ä¼šå‘çŽ°ï¼š
> >
> > ```java
> > protected void onDraw(@Nullable Canvas canvas) {
> >    super.onDraw(canvas);
> >    if (canvas != null) {
> >       canvas.drawRect(0.0F, 0.0F, 100.0F, 200.0F, this.mBlackPaint);
> >    }
> >    if (canvas != null) {
> >       canvas.drawRect(0.0F, 0.0F, 100.0F, 200.0F, this.mBlackPaint);
> >    }
> >    if (canvas != null) {
> >       canvas.drawRect(0.0F, 0.0F, 100.0F, 200.0F, this.mBlackPaint);
> >    }
> >    if (canvas != null) {
> >       canvas.drawRect(0.0F, 0.0F, 100.0F, 200.0F, this.mBlackPaint);
> >    }
> >    if (canvas != null) {
> >       canvas.drawRect(0.0F, 0.0F, 100.0F, 200.0F, this.mBlackPaint);
> >    }
> >    if (canvas != null) {
> >       canvas.drawRect(0.0F, 0.0F, 100.0F, 200.0F, this.mBlackPaint);
> >    }
> > }
> > ```
> >
> > æ¯ä¸ª canvas éƒ½å•ç‹¬åˆ¤æ–­äº†ä¸€éæ˜¯å¦ä¸ºç©ºï¼Œä¸çŸ¥é“ä½ ä»¬æ€Žä¹ˆæƒ³ï¼Œä½†æˆ‘çš„å¼ºè¿«ç—‡ä¸å…è®¸å‡ºçŽ°è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å»ºè®®å„ä½å†™è‡ªå®šä¹‰ View æ—¶ï¼ŒæŠŠæ–¹æ³•å‚æ•°ä¸­å¯ä»¥åŽ»æŽ‰ `?` çš„é¡ºæ‰‹ç»™åŽ»æŽ‰
> >
> > é™¤äº† `onDraw()` ä»¥å¤–ï¼Œè¿˜æœ‰ `override fun onTouchEvent(event: MotionEvent?)` çš„ `?` ä¹Ÿå¯ä»¥åŽ»æŽ‰
> >
> > > æ€Žä¹ˆçœ‹ kt è½¬æˆçš„ java ä»£ç ï¼Ÿ
> > >
> > >  <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320161207313.png" alt="image-20220320161207313" style="zoom:50%;" />
> > >
> > >  <img src="C:/Users/%E9%83%AD%E7%A5%A5%E7%91%9E/AppData/Roaming/Typora/typora-user-images/image-20220320144121673.png" alt="image-20220320144121673" style="zoom:50%;" />
> >
> > æŽ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è®²è§£ `onDraw()` éœ€è¦çš„å…¶ä»–çŸ¥è¯†
>

#### 1ã€Canvas ç”»å¸ƒ

> ç”±äºŽæ—¶é—´åŽŸå› ï¼Œè¿™é‡Œä¸ä¼šè®²å¾—å¾ˆè¯¦ç»†ï¼Œä½ ä»¬å¯ä»¥åœ¨è¿™äº›åœ°æ–¹è¿›è¡Œå­¦ä¹ ï¼š
>
> - https://carsonho.blog.csdn.net/article/details/60598775
> - https://qijian.blog.csdn.net/article/details/50995268
>
>
> | å‚æ•°         | ç±»åž‹   | ä½œç”¨                                                         |
> | ------------ | ------ | ------------------------------------------------------------ |
> | ***canvas*** | Canvas | å­—é¢ç¿»è¯‘æ˜¯â€œå¸†å¸ƒâ€ï¼Œä½ å¯ä»¥çœ‹æˆæ˜¯ç³»ç»Ÿåº•å±‚ç»™äº†ä½ ä¸€å¼ â€œç”»å¸ƒâ€ï¼ˆcanvasï¼‰ï¼Œç„¶åŽä½ åœ¨è¿™å¼ ç”»å¸ƒä¸Šè¿›è¡Œç»˜å›¾ |
>
> é‚£æ€Žä¹ˆè¿›è¡Œç”»å›¾å‘¢ï¼Ÿ
>
> ```kotlin
> // è¿™ä¸ª paint ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯â€œç”»ç¬”â€
> private val mBlackPaint = Paint().apply {
> color = Color.BLACK // è®¾ç½®ç”»ç¬”é¢œè‰²ä¸ºé»‘è‰²
> }
> override fun onDraw(canvas: Canvas) {
> super.onDraw(canvas)
> // ç”»ä¸€ä¸ª (0, 0) - (100, 200) çš„é»‘è‰²çŸ©å½¢
> canvas.drawRect(0F, 0F, 100F, 200F, mBlackPaint)
> }
> ```
>
> å¦‚ä¸Šé¢ä»£ç ï¼Œè°ƒç”¨ `canvas.drawRect()` å°±å¯ä»¥ç”»ä¸€ä¸ªé»‘è‰²çŸ©å½¢åœ¨ View é‡Œé¢
>
> æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ•ˆæžœï¼š
>
> <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320144833039.png" alt="image-20220320144833039" style="zoom:50%;float:left" />
>
> å¦‚æžœä½ æ²¡æœ‰è‡ªå®šä¹‰ View åŸºç¡€çš„è¯ï¼Œå¯èƒ½ä¼šè§‰å¾—æœ‰äº›å¥‡æ€ª
>
> æˆ‘ä»¬ä»Žå°å­¦å¼€å§‹å­¦çš„åæ ‡ç³»ç¬¬ä¸€è±¡é™ä¸æ˜¯å‘ä¸Šä¸º Y æ­£åŠè½´ï¼Œå‘å³ä¸º X æ­£åŠè½´ï¼Œé‚£ä¹ˆæŒ‰ç…§æƒ¯æ€§æ€ç»´ï¼Œ(0, 0) - (100, 200) ä¸ºä»€ä¹ˆä¸æ˜¯ä¸‹å›¾è¿™æ ·çš„ï¼Ÿ
>
> <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320144833039.png" alt="image-20220320144833039" style="zoom:50%;transform:rotateX(180deg);float:left" />
>
> å…¶å®žåŽŸå› åœ¨äºŽ View ä¸­åæ ‡ç³»çš„ y è½´æ˜¯åè¿‡æ¥çš„ï¼Œæˆ‘çŒœæµ‹æ˜¯å› ä¸ºï¼šä¸ºäº†è®¾é…æ‰‹æœºçš„ç‰¹ç‚¹ï¼Œæ¯”å¦‚æˆ‘ä»¬çœ‹ä¸€äº›åˆ—è¡¨ï¼Œéƒ½æ˜¯æ‰‹æŒ‡å¾€ä¸Šæ»‘åŠ¨ï¼ŒæŸ¥çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œæ‰€ä»¥ä¸ºäº†å¥½å¼€å‘ï¼ŒView ä¸­çš„åæ ‡åŽŸç‚¹å°±è®¾ç½®åœ¨äº†å·¦ä¸Šè§’ï¼Œå‘ä¸‹ä¸º Y æ­£åŠè½´ï¼Œå‘å³ä¸º X æ­£åŠè½´
>
> è¿™ä¸ªç®—æ˜¯åŸºç¡€å†…å®¹äº†ï¼Œå¦‚æžœä¸çŸ¥é“çš„è¯ï¼Œå¯ä»¥åŽ»çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼šhttps://blog.csdn.net/carson_ho/article/details/56009827
>
> Canvas é‡Œé¢ä¸æ­¢æœ‰ç»˜åˆ¶çŸ©å½¢çš„æ–¹æ³•ï¼Œè¿˜æœ‰ç»˜åˆ¶åœ†çš„æ–¹æ³•ï¼Œç»˜åˆ¶æ–‡å­—çš„æ–¹æ³•Â·Â·Â·Â·Â·Â·ï¼Œè¿™é‡Œä¸ä¼šåŽ»è®²è§£è¿™äº›åŸºç¡€å†…å®¹ï¼Œå¯ä»¥åŽ»ä¸‹é¢è¿™äº›åœ°æ–¹åŽ»æŸ¥çœ‹ï¼š
>
> - https://developer.android.google.cn/reference/kotlin/androidx/compose/ui/graphics/Canvas?hl=en

#### 2ã€Paint ç”»ç¬”

> å‰é¢çš„ä»£ç æ¼”ç¤ºä¸­å‡ºçŽ°äº† `Paint`ï¼Œè¿™ä¸ªç±»ä¸»è¦æ˜¯ç®¡ç”»ç¬”çš„ï¼Œé™¤äº†è®¾ç½®é¢œè‰²ä»¥å¤–ï¼Œä»–è¿˜å¯ä»¥è®¾ç½®çº¿çš„ç²—ç»†ç­‰
>
> ```kotlin
> // è¿™æ˜¯æˆ‘çš„æŸä¸ªè‡ªå®šä¹‰ View è®¾ç½®çš„ Paint
> private val mCircleBackgroundPaint by lazyUnlock {
>     Paint().apply {
>         color = mCircleBackground
>         style = Paint.Style.FILL
>         isAntiAlias = true
>     }
> }
> ```
>
> Paint çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œç»™å‡ºæ–‡ç« ï¼Œä½ ä»¬æœ‰æ—¶é—´å¯ä»¥åŽ»çœ‹çœ‹ï¼Œé‚£æœ¬è‡ªå®šä¹‰é»‘ä¹¦å¯¹äºŽ Paint çš„å†…å®¹æœ‰ç‚¹å°‘ï¼Œå»ºè®®åŽ»çœ‹ä¹¦ä½œè€…å†™çš„æ–‡ç« ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå…¶ä»–é«˜çº§ç”¨æ³•
>
> - https://qijian.blog.csdn.net/article/details/50995268

#### 3ã€Path è·¯å¾„

> Path è¡¨ç¤ºè·¯å¾„ï¼Œå¸¸ç”¨äºŽç»˜åˆ¶æ›²çº¿ï¼Œç»˜åˆ¶ä¸è§„åˆ™çš„å›¾å½¢ç­‰
>
> ```kotlin
> // è¿™æ˜¯æˆ‘çš„æŸä¸ªè‡ªå®šä¹‰ View è®¾ç½®çš„ Path
> // ä¸»è¦æ˜¯å†™äº†æ ¹æ®å˜åŒ–çš„ offset å€¼æ¥è®¡ç®—åœ†çš„åŠå¾„ï¼Œæœ€åŽç»˜åˆ¶ä¸€ä¸ªåœ†
> private fun drawFirstCircle(path: Path, offset: Float, total: Float) {
>     val radio = abs(offset / total)
>     val startMove = 0.6F
>     val k = 1 / (1 - startMove)
>     val b = 1 - k
>     val y = offset / abs(offset) * max(0F, k * radio + b) * total
>     val r = getNewRadius(y)
>     val dx = (outerX - abs(y)) / (outerR + r) * r
>     val dy = outerY / (outerR + r) * r
>     firstPointX = if (offset > 0) dx + y else -dx + y
>     firstPointY = dy
>     path.addCircle(y, 0F, r, Path.Direction.CCW)
> }
> ```
>
> æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸è¿›è¡Œè®²è§£ï¼Œç»™å‡ºä¸‹é¢æ–‡ç« ï¼š
>
> - https://developer.android.google.cn/reference/kotlin/androidx/compose/ui/graphics/Path?hl=en
> - https://carsonho.blog.csdn.net/article/details/60597923
> - https://qijian.blog.csdn.net/article/details/50995268

#### 4ã€å…¶ä»–ä¸œè¥¿

> ä¸Šé¢å¹¶æ²¡æœ‰åˆ—å®ŒåŸºç¡€çŸ¥è¯†ï¼Œå› ä¸ºåŸºç¡€çŸ¥è¯†å®žåœ¨æ˜¯å¤ªå¤šäº†ï¼Œè¿™é‡Œæ˜¯å†™ä¸ä¸‹çš„ï¼ŒæŽ¥ä¸‹æ¥æˆ‘è®²ä¸€äº›å…¶ä»–ç»éªŒæ€§çš„ä¸œè¥¿

##### 1ã€onDraw() é‡Œé¢ç¦æ­¢ new å¯¹è±¡

> å¾ˆå¤šåˆå­¦è€…åœ¨åˆšå¼€å§‹å†™çš„æ—¶å€™å¾ˆå–œæ¬¢åœ¨ `onDraw()` é‡Œé¢ new å¯¹è±¡ï¼Œä¹‹å‰ `canvas.drawRect()` ä¸æ˜¯è¦ä¼ å…¥ä¸€ä¸ªç”»ç¬”å—ï¼Ÿå°±ä¼šæœ‰äººè¿™æ ·å†™
>
> ```kotlin
> override fun onDraw(canvas: Canvas) {
>  super.onDraw(canvas)
>  val blackPaint = Paint()
>  blackPaint.color = Color.BLACK
>  canvas.drawRect(0F, 0F, 100F, 200F, blackPaint)
> }
> ```
>
> è¿™æ ·å†™æ—¶ AS è¿˜ä¼šæŠ¥ä¸€ä¸ªé»„ï¼Œå‘Šè¯‰ä½ è¿™æ ·å†™æ˜¯ä¸å¯¹çš„ï¼Œä½†ä½ çŸ¥é“ä¸ºä»€ä¹ˆä¸å¯¹å—ï¼Ÿ
>
> åŽŸå› ï¼š`onDraw()` åœ¨ä¸€ç›´åˆ·æ–°è§†å›¾æ—¶ï¼Œåœ¨ 60 å¸§çš„æ‰‹æœºä¸Šä¼šæ¯éš” 16 æ¯«ç§’å›žè°ƒä¸€æ¬¡ï¼Œ90 å¸§çš„æ‰‹æœºä¸Šæ¯éš” 11 æ¯«ç§’å›žè°ƒä¸€æ¬¡ï¼ˆ1000 Ã· 90ï¼‰ï¼Œæ‰€ä»¥åœ¨ä¸€ç§’é’Ÿï¼Œ60 å¸§çš„æ‰‹æœºä¼šç”Ÿæˆ 60 ä¸ª Paint å¯¹è±¡ï¼Œ90 å¸§æ‰‹æœºç”Ÿæˆ 90 ä¸ªå¯¹è±¡ï¼Œè¿™æ ·ç–¯ç‹‚ new å¯¹è±¡ï¼Œä¼šè®©æ‰‹æœºå‡ºçŽ°å¡é¡¿ï¼Œè¿™è·Ÿä¸ŠèŠ‚è¯¾è®²çš„ `onBindViewHolder()` ä¸è¦å†™ç‚¹å‡»ç›‘å¬ä¸€æ ·ï¼Œä½†è¿™ä¸ªä¼šæ¯”å®ƒæ›´ä¸¥é‡
>
> ä½† AS çš„æ™ºèƒ½æç¤ºå¹¶ä¸æ˜¯èƒ½å‘çŽ°æ‰€æœ‰çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š
>
> ```kotlin
> override fun onDraw(canvas: Canvas) {
>  super.onDraw(canvas)
>  set { 
>      // ...
>  }
> }
> 
> private fun set(func: () -> Unit) {
>  func.invoke()
> }
> ```
>
> è¿™ç§æƒ…å†µè¾ƒéš¾å‘çŽ°ï¼Œè¿™æ ·å†™æ¯æ¬¡éƒ½ä¼šç”Ÿæˆä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œå»ºè®®åŠ ä¸Š `inline` å…³é”®å­—
>
> **è¯¥ç¦ä»¤åŒæ ·é€‚ç”¨äºŽ `onMeasure()`ã€`onLayout()`ï¼**

##### 2ã€ä¸è¦åœ¨ onDraw() é‡Œé¢è¿›è¡Œè€—æ—¶æ“ä½œ

> åŽŸå› è·Ÿä¸Šé¢ä¸€æ ·
>
> **è¯¥ç¦ä»¤åŒæ ·é€‚ç”¨äºŽ `onMeasure()`ã€`onLayout()`ï¼**

##### 3ã€ä¸è¦æŒæœ‰ canvas å¯¹è±¡

> æ¯æ¬¡å›žè°ƒçš„ canvas å¯¹è±¡å¹¶ä¸æ˜¯ä¸€å®šæ˜¯åŒä¸€ä¸ªï¼ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯åŒä¸€ä¸ªï¼‰ï¼Œè€Œä¸”æ¯æ¬¡çš„å›žè°ƒåªèƒ½è¡¨ç¤ºå½“å‰å¸§çš„çŠ¶æ€ï¼Œæ¯”å¦‚æˆ‘ä»¬æ¥ä¸ªè¿è§„æ“ä½œï¼š
>
> ```kotlin
> override fun onDraw(canvas: Canvas) {
>  super.onDraw(canvas)
>  // å¼€ä¸€ä¸ªçº¿ç¨‹æ¨¡æ‹ŸæŒæœ‰ canvas å¯¹è±¡
>  thread {
>      // å»¶è¿Ÿ 20 æ¯«ç§’æ‰ç»˜å›¾
>      sleep(20)
>      canvas.drawRect(0F, 0F, 100F, 200F, mBlackPaint)
>  }
> }
> ```
>
> ä½ å¯èƒ½çŒœéƒ½çŒœä¸åˆ°å®ƒæŠŠå›¾ç»˜åˆ¶åˆ°å“ªé‡ŒåŽ»äº†
>
> 
>
> 
>
> 
>
> 
>
> 
>
> 
>
> 
>
> 
>
> 
>
> 
>
> <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320163052101.png" alt="image-20220320163052101" style="zoom:50%;float:left" />
>
> å¥½å®¶ä¼™ï¼Œå®ƒç«Ÿç„¶æŠŠå›¾ç»˜åˆ¶åˆ°æ ‡é¢˜æ ä¸Šäº†ï¼Œè¿™é‡ŒçŒœæµ‹åŽŸå› å¦‚ä¸‹ï¼ˆæ²¡æœ‰åŽ»æŸ¥çœ‹æºç æ‰¾çœŸæ­£åŽŸå› ï¼‰ï¼š
>
> - æ•´ä¸ªåº”ç”¨å…±ç”¨äº†åŒä¸€ä¸ª canvas å¯¹è±¡
> - å› å¼€å¯çº¿ç¨‹åŽ sleepï¼Œæ‰€ä»¥ canvas æ˜¯æ•´ä¸ªåº”ç”¨ç»˜åˆ¶å®ŒæˆåŽå†è°ƒç”¨çš„ `canvas.drawRect()`
> - **æ ‡é¢˜æ æ˜¯åœ¨æœ€åŽè¿›è¡Œç»˜åˆ¶çš„**ï¼Œæ­¤æ—¶çš„ canvas çš„åæ ‡ç³»æ˜¯ä»¥æ ‡é¢˜æ ä¸ºå‡†çš„
>
> è¿™æ€Žä¹ˆéªŒè¯å‘¢ï¼Ÿ
>
> > ä½ æŠŠå¼€å‘è€…æ¨¡å¼æ¨¡å¼çš„ `æ˜¾ç¤ºå¸ƒå±€è¾¹ç•Œ` ç»™æ‰“å¼€ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢è¿™ç§å›¾ï¼š
> >
> > <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320164459116.png" alt="image-20220320164459116" style="zoom: 67%;float:left" />
> >
> > è¿™é‡Œè¯´æ˜Žæ ‡é¢˜æ çš„æ–‡å­—æ˜¯ä¸€ä¸ª View æ¥æ˜¾ç¤ºçš„
> >
> > é‚£æˆ‘ä»¬è¯•è¯•æŠŠæ ‡é¢˜æ ç»™åŽ»æŽ‰ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
> >
> > ```xml
> > <!--theme.xml-->
> > <style name="xxx" parent="Theme.MaterialComponents.DayNight.NoActionBar">
> > ```
> >
> > <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320164844556.png" alt="image-20220320164844556" style="zoom: 67%;float:left" />
> >
> > å˜¿ï¼ŒåŽ»æŽ‰æ ‡é¢˜æ åŽç»˜åˆ¶çš„ä½ç½®å¯¹äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘æå‡ºçŒœæµ‹ï¼šæ ‡é¢˜æ æ˜¯åœ¨æœ€åŽè¿›è¡Œç»˜åˆ¶çš„
> >
> > å…¶å®žæˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªçŒœæµ‹ï¼Œå†™ä¸€ä¸ªåœ¨å®ƒåŽé¢ç»˜åˆ¶çš„ View éªŒè¯ä¸‹ï¼š
> >
> > ```xml
> > <com.ndhzs.lib.section4.MySection4ViewCanvas
> >  android:layout_width="300dp"
> >  android:layout_height="300dp"
> >  app:layout_constraintBottom_toBottomOf="parent"
> >  app:layout_constraintLeft_toLeftOf="parent"
> >  app:layout_constraintRight_toRightOf="parent"
> >  app:layout_constraintTop_toTopOf="parent" />
> > 
> > <View
> >  android:layout_width="match_parent"
> >  android:layout_height="match_parent"/>
> > ```
> >
> > <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320165148269.png" alt="image-20220320165148269" style="zoom: 67%;float:left" />
> >
> > æžœç„¶ï¼Œæˆ‘çš„çŒœæµ‹åº”è¯¥æ˜¯åˆç†çš„

##### 4ã€è‡ªå®šä¹‰ View å’Œ ViewGroup åœ¨ç»˜åˆ¶ä¸­çš„ä¸åŒ

> åœ¨è‡ªå®šä¹‰ ViewGroup ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šé‡å†™ `onDraw()`ï¼Œå› ä¸º ViewGroup å¯¹ `onDraw()` è¿›è¡Œäº†å¤„ç†ï¼Œåªæœ‰åœ¨**æœ‰èƒŒæ™¯å›¾æ—¶**ï¼Œæ‰ä¼šè°ƒç”¨ `onDraw()`ï¼Œæ‰€ä»¥åœ¨è‡ªå®šä¹‰ ViewGroup æ—¶æƒ³ç»˜å›¾ä¸€èˆ¬æ˜¯é‡å†™ `dispatchDraw(Canvas canvas)`ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥å†³å®šæ˜¯ç»˜åˆ¶åœ¨å­ View ä¸Šå±‚è¿˜æ˜¯å­ View ä¸‹å±‚ï¼Œå…·ä½“çš„ä½ ä»¬è‡ªå·±åŽ»å®žè·µä¸€ä¸‹å§ï¼Œè¿™é‡Œç»™å‡ºæ–‡ç« é“¾æŽ¥ï¼šhttps://www.jianshu.com/p/89efaf8bd3dd

#### 5ã€onDraw() çš„ç»˜åˆ¶æµç¨‹

> è¿™ä¸œè¥¿å±žäºŽé«˜é˜¶å†…å®¹ï¼Œé™äºŽæ—¶é—´å…³ç³»ï¼Œè¿™é‡Œæˆ‘å°±ä¸è®²äº†ï¼Œå¯ä»¥çœ‹çœ‹è¿™äº›æ–‡ç« ï¼š
>
> - https://blog.csdn.net/carson_ho/article/details/56011153
> - https://github.com/Idtk/Blog/blob/master/Blog/9%E3%80%81Invalidate.md
>
> 

### 5ã€invalidate()

> è¿™ä¸œè¥¿ä½ ç›®å‰åªéœ€è¦è®°ä½ä»¥ä¸‹å‡ ç‚¹å°±å¯ä»¥äº†ï¼š
>
> - è°ƒç”¨åŽä¼šåœ¨**ä¸‹ä¸€å¸§å›žè°ƒ** `onDraw()` è¿›è¡Œåˆ·æ–°
> - ä¸‹ä¸€å¸§æ˜¯æŒ‡ä¸‹ä¸€æ¬¡å±å¹•åˆ·æ–°çš„æ—¶å€™
>
> å¦‚æžœä½ æƒ³æŽ¢ç©¶æºç çš„è¯ï¼Œæˆ‘åªèƒ½ä¸¢æ–‡ç« å‡ºæ¥äº†ï¼š
>
> - https://juejin.cn/post/7017452765672636446
>
> OKï¼Œè¿™ä¸ªæ–¹æ³•è®²å®Œäº†ï¼Œå› ä¸ºå¾€æ·±äº†è®²ï¼Œä¼šæ¶‰åŠåˆ° Handler æœºåˆ¶ã€ViewRootImpl ç­‰ Framwork å±‚æºç 
>
> å“¦ï¼Œæƒ³èµ·äº†ï¼Œè¿˜è¦ä¸€ç‚¹ï¼Œé™¤äº† `invalidate()` å¤–è¿˜æœ‰ä¸€ä¸ª `postInvalidate()` ç”¨äºŽåœ¨å…¶ä»–çº¿ç¨‹é‡Œåˆ·æ–°
>
> ä½†è€ƒè™‘åˆ°å¯èƒ½ä¼šæœ‰å…¶ä»–å­¦é•¿æ¥å¬è¯¾ï¼Œæˆ‘è¿˜æ˜¯ç”»ä¸€ä¸ªç®€å•çš„æµç¨‹å›¾
>
> ```mermaid
> graph TB
> id1("View")-->id2
> id2["è°ƒç”¨invalidate()åˆ·æ–°"]-->id3
> id3{"parent == null"}--ä¸ä¸º null-->id4
> id4["å‘Šè¯‰çˆ¶å¸ƒå±€æœ‰å­å¸ƒå±€è¦é‡ç»˜"]-->id3--ä¸º null-->id5
> id5["ä¼ é€’åˆ°äº† ViewRootImpl (ä¸€ä¸ªç®¡ç†å¸ƒå±€çš„ç±»)"]-->id6
> id6["ViewRootImpl è°ƒç”¨ mChoreographer å‘é€ä¸€ä¸ª post (ä¸€ä¸ªä¸“é—¨ç›‘å¬å±å¹•åˆ·æ–°çš„ç±»)"]-.->id7
> id7["å±å¹•åˆ·æ–°äº†ï¼Œå›žè°ƒ ViewRootImplï¼Œå¼€å§‹é‡æ–°èµ° View æµ‹é‡å’Œç»˜å›¾æµç¨‹"]-->id8
> id8("ä»Žé¡¶éƒ¨å¸ƒå±€æœ€åŽå›žè°ƒåˆ° View çš„ onDraw()")
> ```
>
> å…¶å®žè¿˜æœ‰äº¿ç‚¹ç»†èŠ‚ï¼Œè¿™é‡Œæˆ‘å°±ä¸è®²è¿°äº†ï¼Œè‡ªå·±çœ‹ä¸‹é¢å›¾ï¼Œå…¶å®žè¿™å›¾ä»æœ‰è®¸å¤šæ²¡æœ‰ç”»ä¸Š
>
> ```mermaid
> sequenceDiagram
> View->>View: invalidate()
> View->>ViewGroup: invalidateChild()
> alt å¦‚æžœæ˜¯ç¡¬ä»¶åŠ é€Ÿ
> 	ViewGroup->>other ViewGroups: onDescendantInvalidated()
> 	other ViewGroups->>DecorView: onDescendantInvalidated()
> 	DecorView->>ViewRootImpl: onDescendantInvalidated()
> 	ViewRootImpl->>ViewRootImpl: invalidate()
> else å¦‚æžœæ˜¯è½¯ä»¶åŠ é€Ÿ
> 	ViewGroup->>other ViewGroups: invalidateChildInParent()
> 	other ViewGroups->>DecorView: invalidateChildInParent()
> 	DecorView->>ViewRootImpl: invalidateChildInParent()
> 	ViewRootImpl->>ViewRootImpl: invalidateRectOnScreen()
> end
> ViewRootImpl->>ViewRootImpl: scheduleTraversals()
> ViewRootImpl->>Choreographer: postCallback(mTraversalRunnable)
> Choreographer->>Handler: sendMessage*()
> Handler->>Handler: ç­‰åˆ°ä¸‹ä¸€æ¬¡å±å¹•åˆ·æ–°
> Handler->>ViewRootImpl: mTraversalRunnable.run()
> ViewRootImpl->>ViewRootImpl: doTraversal()
> ViewRootImpl->>ViewRootImpl: performTraversals()
> ViewRootImpl->>ViewRootImpl: performDraw()
> ViewRootImpl->>DecorView: draw()
> DecorView->>other ViewGroups: draw()
> other ViewGroups->>ViewGroup: draw()
> ViewGroup->>View: draw()
> View->>View: onDraw()
> ```
>
> END

### 6ã€è‡ªå®šä¹‰å±žæ€§ AttributeSet

> å‰é¢æˆ‘ä»¬æåˆ°ç³»ç»Ÿä¼šæŠŠä½  xml ä¸­å†™å¾—å±žæ€§è£…æ¢ä¸ºä¸€ä¸ª AttributeSet å¯¹è±¡ï¼Œé‚£æˆ‘ä»¬æ€Žä¹ˆè‡ªå®šä¹‰è‡ªå·±çš„å±žæ€§å‘¢ï¼Ÿ
>
> é¦–å…ˆï¼Œéœ€è¦æ–°å»ºä¸€ä¸ª `res/value/attrs.xml` æ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªåœ†åŠå¾„çš„å±žæ€§
>
> ```xml
> <resources>
>  <!--è¿™ä¸ª name æ˜¯ View çš„ç±»å-->
>  <declare-styleable name="MySection6View">
>      <!--è¿™ä¸ª name æ˜¯è‡ªå®šä¹‰å±žæ€§çš„åç§°ï¼Œformate æ˜¯æŽ¥å—çš„ç±»åž‹-->
>      <attr name="my6_circleRadius" format="dimension"/>
>  </declare-styleable>
> </resources>
> ```
>
> å¦‚ä¸Šè¿°ä»£ç ï¼Œè¿™é‡Œæœ‰éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼š
>
> - è‡ªå®šä¹‰å±žæ€§çš„åç§°ä¸èƒ½ä¸Žå®˜æ–¹çš„é‡å¤ï¼Œè€Œä¸”å»ºè®®åŠ ä¸Šå‰ç¼€ï¼Œä¸Žå®˜æ–¹çš„è¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚æˆ‘å°±åŠ ä¸Šäº† `my6_`
>
> `formate` æœ‰ä¸‹é¢å‡ ç§ç±»åž‹ï¼š
>
> | ç±»åž‹            | è¯´æ˜Ž     | ç”¨æ³•                          |                                        |
> | --------------- | -------- | ----------------------------- | -------------------------------------- |
> | ***dimension*** | é•¿åº¦å€¼   | "1dp"ã€"1px"ã€"@dimen/xxx"    | è¿™é‡Œæ— æ‰€è°“ dpã€pxï¼Œç³»ç»Ÿä¼šæœ€ç»ˆè£…æ¢æˆ px |
> | ***reference*** | å¼•ç”¨å€¼   | "@drawable/xxx"ã€"@style/xxx" |                                        |
> | ***color***     | é¢œè‰²å€¼   | "#FFFFFFFF"ã€"@color/xxx"     |                                        |
> | ***float***     | å°æ•°     | "1.0"                         |                                        |
> | ***boolean***   | å¸ƒå°”ç±»åž‹ | "true"ã€"@bool/xxx"           |                                        |
> | ***interger***  | æ•´æ•°     | "1"ã€"@interget/xxx"          |                                        |
> | ***string***    | å­—ç¬¦ä¸²   | "string"ã€"@string/xxx"       |                                        |
> | ***fraction***  | ç™¾åˆ†æ•°   | "50%"ã€"@fraction/xxx"        |                                        |
> | ***enum***      | æžšä¸¾     | [çœ‹ä¸‹æ–‡](#enum)               |                                        |
> | ***flag***      | ä½è¿ç®—   | [çœ‹ä¸‹æ–‡](#flag)               |                                        |
>
> ### enum
>
> > ```xml
> > <!--æ¯”å¦‚æˆ‘è®¾ç½®åœ†çš„ä½ç½®å±žæ€§-->
> > <attr name="my6_circleGravity" format="enum">
> >     <enum name="left" value="0"/>
> >     <enum name="center" value="1"/>
> >     <enum name="right" value="2"/>
> > </attr>
> > ```
> >
> > <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220320195658810.png" alt="image-20220320195658810" style="zoom:50%;float:left" />
> >
> > è®¾ç½®åŽåœ¨ä½¿ç”¨æ—¶å®ƒçš„å±žæ€§å°±åªèƒ½é€‰æ‹©ä½ å¡«å†™çš„é‚£å‡ ä¸ª
>
> ### flag
>
> > å°±æ˜¯è¿›è¡Œä½è¿ç®—ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ FrameLayout çš„ `layout_gravity` ä¸ºä¾‹
> >
> > ```xml
> > <attr name="layout_gravity">
> >     <!--0011 0000-->
> >     <flag name="top" value="0x30" />
> >     <!--0101 0000-->
> >     <flag name="bottom" value="0x50" />
> >     <!--0000 0011-->
> >     <flag name="left" value="0x03" />
> >     <!--0000 0101-->
> >     <flag name="right" value="0x05" />
> >     <!--0001 0000-->
> >     <flag name="center_vertical" value="0x10" />
> >     <!--0000 0001-->
> >     <flag name="center_horizontal" value="0x01" />
> >     <!--0001 0001-->
> >     <flag name="center" value="0x11" />
> >     <flag name="start" value="0x00800003" />
> >     <flag name="end" value="0x00800005" />
> > </attr>
> > ```
> >
> > ä½ æ˜¯å¦è¿˜è®°å¾—ä½ æ›¾ç»è¿™æ ·ä½¿ç”¨è¿‡ï¼Ÿ
> >
> > ```xml
> > <FrameLayout
> >     android:layout_width="match_parent"
> >     android:layout_height="match_parent">
> > 
> >     <View
> >         android:layout_width="match_parent"
> >         android:layout_height="match_parent"
> >         android:layout_gravity="top|left"/>
> > 
> > </FrameLayout>
> > ```
> >
> > > è¿™é‡Œä½ ä¼šå‘çŽ°å®ƒæŠŠ `top|left` æŠ¥é»„äº†ï¼ŒåŽŸå› åœ¨äºŽå®ƒæŽ¨èä½ ä½¿ç”¨ `start` åŽ»ä»£æ›¿ `left`ï¼Œå› ä¸ºåœ¨éƒ¨åˆ†å›½å®¶æ˜¯ä»Žå³è¾¹å¾€å·¦è¾¹é˜…è¯»æ–‡å­—çš„ï¼Œæ‰€ä»¥ï¼ŒAndroid ä¸ºäº†å›½é™…åŒ–ï¼Œå°±è®¾è®¡å‡ºäº† `start` ä»£æ›¿ `left`ï¼Œ`end` ä»£æ›¿ `right`
>
> ### ç±»åž‹çš„æ··ç”¨
>
> > æ¯”å¦‚ `android:layout_width` æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š
> >
> > ```xml
> > <attr name="layout_width" format="dimension">
> >     <enum name="fill_parent" value="-1" />
> >     <enum name="match_parent" value="-1" />
> >     <enum name="wrap_content" value="-2" />
> > </attr>
> > ```
> >
> > 
> >
> > è¿˜æœ‰ `android:background` æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š
> >
> > ```xml
> > <attr name="background" format="reference|color" />
> > ```
> >
> > æ‰€ä»¥ä½ ä¼ å…¥ `@drawable/xxx` å’Œ `#FFFFFFFF`ï¼Œå®ƒéƒ½å¯ä»¥èŽ·å–ï¼Œåªæ˜¯å¡«å…¥é¢œè‰²å€¼æ—¶ä½¿ç”¨ `TypedValue#getDrawable()` å¾—åˆ°æ˜¯ ColorDrawable
> >
> > 
> >
> > ä¹Ÿæ”¯æŒè¿™æ ·æ··ç”¨ï¼š
> >
> > ```xml
> > <!--è¿™æ˜¯ View çš„ä¸€ä¸ªå±žæ€§-->
> > <attr name="focusable" format="boolean|enum">
> >     <enum name="auto" value="0x00000010" />
> > </attr>
> > ```
> >
> > ä½†è¿™æ ·ä½¿ç”¨åªèƒ½æ‰‹åŠ¨åŽ»åˆ¤æ–­ï¼š
> >
> > ```java
> > private int getFocusableAttribute(TypedArray attributes) {
> >     TypedValue val = new TypedValue();
> >     if (attributes.getValue(com.android.internal.R.styleable.View_focusable, val)) {
> >         if (val.type == TypedValue.TYPE_INT_BOOLEAN) {
> >             return (val.data == 0 ? NOT_FOCUSABLE : FOCUSABLE);
> >         } else {
> >             return val.data;
> >         }
> >     } else {
> >         return FOCUSABLE_AUTO;
> >     }
> > }
> > ```
>
> å‰é¢è®²äº†ç±»åž‹çš„å®šä¹‰ï¼Œé‚£æˆ‘ä»¬æ€Žä¹ˆèŽ·å–è¿™äº›å±žæ€§å‘¢ï¼Ÿ
>
> ```kotlin
> private var mCircleRadius = 100
> // è¿™ä¸ª enum å±žæ€§æ›´å»ºè®®ä½¿ç”¨æžšä¸¾æ¥ä¿å­˜ï¼Œå®˜æ–¹é€šå¸¸ä½¿ç”¨çš„æ³¨è§£ï¼Œä½† kt å¾ˆæ€ªï¼Œæ³¨è§£ä¸èµ·ä½œç”¨
> private var mCircleGravity = 0
> init {
>     if (attrs != null) {
>         // ä¸»è¦å°±æ˜¯è°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•åŽ»èŽ·å–å±žæ€§
>         val ty = context.obtainStyledAttributes(attrs, R.styleable.MySection6View)
>         mCircleRadius = ty.getDimensionPixelSize(
>             R.styleable.MySection6View_my6_circleRadius,
>             mCircleRadius
>         )
>         mCircleGravity = ty.getInt(
>             R.styleable.MySection6View_my6_circleGravity,
>             mCircleGravity
>         )
>         ty.recycle()
>     }
> }
> ```
>
> è¿™é‡Œè¿˜å¥½åªæœ‰ä¸¤ä¸ªå±žæ€§ï¼Œä½†å¦‚æžœæœ‰å¤šè¾¾ä¸Šç™¾ä¸ªå±žæ€§è¿™æ ·å†™æœªå…å¤ªå è¡Œæ•°äº†ï¼Œæ‰€ä»¥ï¼Œç§‰æŒç€å°‘å†™ä»£ç çš„åŽŸåˆ™ï¼Œæˆ‘ä½¿ç”¨äº† kt æ‰©å±•å‡½æ•°æ¥ä¼˜åŒ–ï¼ˆä¸‹é¢æ˜¯æˆ‘å†™çš„è¯¾è¡¨è‡ªå®šä¹‰ Viewï¼‰ï¼š
>
> ```kotlin
> // å…ˆæŠŠå±žæ€§çš„è¯»å–å•ç‹¬æå–åˆ°ä¸€ä¸ªç±»ä¸­
> open class NetLayout @JvmOverloads constructor(
>     context: Context,
>     attrs: AttributeSet? = null,
>     defStyleAttr: Int = R.attr.netLayoutStyle,
>     defStyleRes: Int = 0
> ) : ViewGroup(context, attrs, defStyleAttr, defStyleRes), INetLayout {
>     // å±žæ€§å€¼
>     protected val mNetAttrs: NetLayoutAttrs = NetLayoutAttrs.newInstance(this, attrs)
> }
> ```
>
> ````kotlin
> // æˆ‘æŠŠå±žæ€§å•ç‹¬å†™åœ¨äº†ä¸€ä¸ªç±»é‡Œé¢
> open class NetLayoutAttrs(
>     rowCount: Int,
>     columnCount: Int
> ) : BaseViewAttrs {
> 
>     var rowCount = rowCount
>         internal set
>     var columnCount = columnCount
>         internal set
> 
>     companion object {
>         fun newInstance(
>             view: View,
>             attrs: AttributeSet?,
>             defStyleAttr: Int = 0,
>             defStyleRes: Int = 0,
>         ): NetLayoutAttrs {
>             return newAttrs(
>                 view,
>                 attrs,
>                 R.styleable.NetLayout,
>                 defStyleAttr,
>                 defStyleRes
>             ) {
>                 // è¿™é‡Œä½ å°±ä¼šçœ‹åˆ°ç›´æŽ¥ä½¿ç”¨ R.styleable.xxx.int() æ¥èŽ·å–å±žæ€§ï¼Œè¿™æ ·å†™èµ·æ¥èˆ’æœå¤šäº†
>                 NetLayoutAttrs(
>                     R.styleable.NetLayout_net_rowCount.int(ROW_COUNT),
>                     R.styleable.NetLayout_net_columnCount.int(COLUMN_COUNT)
>                 )
>             }
>         }
> 
>         const val ROW_COUNT = 4
>         const val COLUMN_COUNT = 4
>     }
> }
> ````
>
> ```kotlin
> // è¿™æ˜¯å®šä¹‰æ‰©å±•å‡½æ•°çš„æŽ¥å£
> internal interface BaseViewAttrs {
> 
>     fun <T> newAttrs(
>         view: View,
>         attrs: AttributeSet?,
>         @StyleableRes
>         styleableId: IntArray,
>         defStyleAttr: Int = 0,
>         defStyleRes: Int = 0,
>         func: Typedef.() -> T
>     ): T = BaseViewAttrs.newAttrs(view, attrs, styleableId, defStyleAttr, defStyleRes, func)
> 
>     companion object {
>         fun <T> newAttrs(
>             view: View,
>             attrs: AttributeSet?,
>             @StyleableRes
>             styleableId: IntArray,
>             defStyleAttr: Int = 0,
>             defStyleRes: Int = 0,
>             func: Typedef.() -> T
>         ): T {
>             val ty = view.context.obtainStyledAttributes(attrs, styleableId, defStyleAttr, defStyleRes)
>             if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {
>                 // è¿™æ˜¯ä¿å­˜åœ¨ Debug æ¨¡å¼ä¸­èƒ½çœ‹åˆ°çš„ä¿¡æ¯ï¼Œå…·ä½“æ€Žä¹ˆæŸ¥çœ‹ï¼Œä½ å¯ä»¥åŽ»çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„æºç 
>                 view.saveAttributeDataForStyleable(
>                     view.context, styleableId, attrs, ty, defStyleAttr, defStyleRes)
>             }
>             try {
>                 return Typedef(ty, view.context).func()
>             } finally {
>                 ty.recycle()
>             }
>         }
>     }
> 
>     class Typedef(val ty: TypedArray, private val context: Context) {
>         fun Int.int(defValue: Int): Int = this.int(ty, defValue)
>         fun Int.color(defValue: Int): Int = this.color(ty, defValue)
>         fun Int.colorById(@ColorRes defValueId: Int): Int = this.color(
>             ContextCompat.getColor(context, defValueId))
>         fun Int.dimens(defValue: Int): Int = this.dimens(ty, defValue)
>         fun Int.dimens(defValue: Float): Float = this.dimens(ty, defValue)
>         fun Int.layoutDimens(defValue: Int): Int = this.layoutDimens(ty, defValue)
>         fun Int.dimensById(@DimenRes defValueId: Int): Int = this
>         .dimens(context.resources.getDimensionPixelSize(defValueId))
>         fun Int.string(defValue: String? = null): String = this.string(ty, defValue)
>         fun Int.boolean(defValue: Boolean): Boolean = this.boolean(ty, defValue)
>         fun Int.float(defValue: Float): Float = this.float(ty, defValue)
>         internal inline fun <reified E: RuntimeException> Int.intOrThrow(
>             attrsName: String): Int = this.intOrThrow<E>(ty, attrsName)
>         internal inline fun <reified E: RuntimeException> Int.stringOrThrow(
>             attrsName: String): String = this.stringOrThrow<E>(ty, attrsName)
>     }
> }
> 
> internal fun Int.int(ty: TypedArray, defValue: Int): Int {
>     return ty.getInt(this, defValue)
> }
> 
> internal fun Int.color(ty: TypedArray, defValue: Int): Int {
>     return ty.getColor(this, defValue)
> }
> 
> internal fun Int.dimens(ty: TypedArray, defValue: Int): Int {
>     return ty.getDimensionPixelSize(this, defValue)
> }
> 
> internal fun Int.dimens(ty: TypedArray, defValue: Float): Float {
>     return ty.getDimension(this, defValue)
> }
> 
> internal fun Int.layoutDimens(ty: TypedArray, defValue: Int): Int {
>     return ty.getLayoutDimension(this, defValue)
> }
> 
> internal fun Int.string(ty: TypedArray, defValue: String? = null): String {
>     return ty.getString(this) ?: defValue ?: ""
> }
> 
> internal fun Int.boolean(ty: TypedArray, defValue: Boolean): Boolean {
>     return ty.getBoolean(this, defValue)
> }
> 
> internal fun Int.float(ty: TypedArray, defValue: Float): Float {
>     return ty.getFloat(this, defValue)
> }
> 
> internal inline fun <reified E: RuntimeException> Int.intOrThrow(
>     ty: TypedArray, attrsName: String
> ): Int {
>     if (!ty.hasValue(this)) {
>         throw E::class.java.getConstructor(String::class.java)
>             .newInstance("å±žæ€§ $attrsName æ²¡æœ‰è¢«å®šä¹‰ï¼")
>     }
>     return this.int(ty, 0)
> }
> 
> internal inline fun <reified E: java.lang.RuntimeException> Int.stringOrThrow(
>     ty: TypedArray, attrsName: String
> ): String {
>     if (!ty.hasValue(this)) {
>         throw E::class.java.getConstructor(String::class.java)
>             .newInstance("å±žæ€§ $attrsName æ²¡æœ‰è¢«å®šä¹‰ï¼")
>     }
>     return this.string(ty)
> }
> ```
>
> ### è‡ªå®šä¹‰ layout_ å±žæ€§
>
> ä¹‹å‰åœ¨æˆ‘ç»™å¤§å®¶ä¸Šçš„ Android ç¬¬ä¸€èŠ‚è¯¾è®²è¿‡ï¼Œçˆ¶ View æ˜¯å¯ä»¥ç»™å­ View é¢å¤–æ·»åŠ å±žæ€§çš„ï¼Œä¸”å±žæ€§åä»¥ `layout_` å¼€å¤´
>
> ```xml
> <!--æ¯”å¦‚è¯´è¿™ä¸ªé‡Œé¢æ‰€æœ‰ layout_ å¼€å¤´çš„éƒ½æ˜¯çˆ¶ View ç»™å­ View æ·»åŠ çš„é¢å¤–å±žæ€§-->
> <androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
>     android:layout_width="match_parent"
>     android:layout_height="match_parent"
>     xmlns:app="http://schemas.android.com/apk/res-auto">
> 
>     <FrameLayout
>         android:layout_width="match_parent"
>         android:layout_height="match_parent"
>         app:layout_constraintEnd_toEndOf="parent"
>         app:layout_constraintStart_toStartOf="parent"
>         app:layout_constraintTop_toTopOf="parent">
> 
>         <View
>             android:layout_width="match_parent"
>             android:layout_height="match_parent"
>             android:layout_gravity="top|left" />
> 
>     </FrameLayout>
> </androidx.constraintlayout.widget.ConstraintLayout>
> ```
>
> é‚£å¦‚ä½•è‡ªå®šä¹‰ ViewGroup å¦‚ä½•è®¾ç½®è‡ªå·±æƒ³è¦çš„å±žæ€§ï¼Ÿ
>
> æ¯”å¦‚æˆ‘ç»™å®ƒæ·»åŠ ä¸€ä¸ªè¡¨ç¤ºå­ View ä½ç½®çš„å±žæ€§ï¼š
>
> ```xml
> <resources>
>     <!--æ³¨æ„ï¼šè¿™ç§å±žæ€§çš„è®¾ç½®å¿…é¡»ä»¥ _Layout ç»“å°¾ï¼Œè¿™æ˜¯å®˜æ–¹çš„è§„èŒƒï¼-->
>     <declare-styleable name="My6ViewGroup_Layout">
>         <!--æ³¨æ„ï¼šå±žæ€§åå»ºè®®å¸¦æœ‰ layout_ å¼€å¤´çš„æ ‡è¯†-->
>         <attr name="my6VG_layout_position" format="integer"/>
>     </declare-styleable>
> </resources>
> ```
>
> ç„¶åŽåœ¨ xml ä¸­å†™å¾—æ—¶å€™ï¼ŒAS ä¼šè¿›è¡Œæ™ºèƒ½æç¤º
>
> <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321194906364.png" alt="image-20220321194906364" style="zoom:67%;" />
>
> é‚£æ€Žä¹ˆèŽ·å–è¿™ä¸ªå±žæ€§å‘¢ï¼Ÿ
>
> è¿™ä¸ªæˆ‘ä»¬ç•™åˆ° [LayoutParams](#1ã€LayoutParams) å†è®²è§£

### 7ã€onMeasure()

> ### ä½œç”¨
>
> æµ‹é‡è‡ªèº«å’Œå­æŽ§ä»¶å¤§å°
>
> ### æ¶‰åŠçŸ¥è¯†
>
> - `MeasureSpecs`
> - `LayoutParams`
>
> ```kotlin
> // ä¸Žä¸Šé¢è®²çš„ onDraw() ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå›žè°ƒï¼Œè¯¥å›žè°ƒçš„ä½œç”¨æ˜¯ç”± requestLayout() è§¦å‘
> override fun onMeasure(widthMeasureSpec: Int, heightMeasureSpec: Int) {
>     super.onMeasure(widthMeasureSpec, heightMeasureSpec)
> }
> ```
>
> ### ä¸»è¦ç”¨æ³•
>
> - è°ƒç”¨ `setMeasuredDimension()`ï¼Œè®¾ç½®è‡ªèº«å®½å’Œé«˜
> - éåŽ†å­ Viewï¼Œå†è°ƒç”¨ `child.measure()`ï¼Œè®¾ç½®å­ View çš„å®½å’Œé«˜
>
> ```mermaid
> graph LR
> id1("ViewRootImpl å¼€å§‹æµ‹é‡")-->id2
> id2["ViewGroup#mearsure()"]-->id3
> id3["ViewGroup#onMeasure()"]-->id4
> id4["View#measure()"]-->id5("View#onMeasure()")
> ```
>
> 

#### 1ã€LayoutParams

> è¿™å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ•°æ®ç±»ï¼Œç”¨äºŽåœ¨å­ View ä¸­ä¿å­˜çˆ¶ç±»éœ€è¦çš„ä¿¡æ¯
>
> æˆ‘ä»¬ç›´æŽ¥æ¥çœ‹ä¸€ä¸‹ FrameLayout çš„ LayoutParams
>
> ```java
> // ä½ ä¼šå‘çŽ°è¿™ LayoutParams å¾ˆç®€å•
> public static class LayoutParams extends MarginLayoutParams {
>  /**
>      * å¯¹åº” layout_gravity å±žæ€§æ²¡æœ‰è¢«è®¾ç½®
>      */
>     public static final int UNSPECIFIED_GRAVITY = -1;
> 
>     /**
>      * è¿™å°±æ˜¯ layout_gravity å±žæ€§çš„ä¿å­˜å€¼
>      * @see android.view.Gravity
>      * @attr ref android.R.styleable#FrameLayout_Layout_layout_gravity
>      */
>     public int gravity = UNSPECIFIED_GRAVITY;
> 
>     public LayoutParams(@NonNull Context c, @Nullable AttributeSet attrs) {
>         super(c, attrs);
>         // çœ‹åˆ°è¿™é‡Œä½ åº”è¯¥å°±èƒ½å›žç­”ä¹‹å‰ç•™ä¸‹çš„é—®é¢˜äº†
>         // çˆ¶ View è¯»å–å­ View ä¸­çš„å±žæ€§æ˜¯åœ¨ LayoutParams ä¸­èŽ·å–çš„
>         // å¯èƒ½ä½ ä¼šå¥‡æ€ªäºŽ View æ˜¯ä»€ä¹ˆæ—¶å€™å¼€å§‹åŠ è½½ LayoutParams
>         // è¿™ä¸ªç•™åˆ°åŽé¢è®² setContentView å†è®²è§£
>         final TypedArray a = c.obtainStyledAttributes(attrs, R.styleable.FrameLayout_Layout);
>         gravity = a.getInt(R.styleable.FrameLayout_Layout_layout_gravity, UNSPECIFIED_GRAVITY);
>         a.recycle();
>     }
> 
>     public LayoutParams(int width, int height) {
>         super(width, height);
>     }
> 
>     public LayoutParams(int width, int height, int gravity) {
>         super(width, height);
>         this.gravity = gravity;
>     }
> 
>     public LayoutParams(@NonNull ViewGroup.LayoutParams source) {
>         super(source);
>     }
> 
>     public LayoutParams(@NonNull ViewGroup.MarginLayoutParams source) {
>         super(source);
>     }
> 
>     public LayoutParams(@NonNull LayoutParams source) {
>         super(source);
>         this.gravity = source.gravity;
>     }
> }
> ```
>
> å¦‚æžœè¦æƒ³ä½¿ç”¨è¿™ä¸ª `LayoutParams` è¿˜å¾—é‡å†™è¿™å‡ ä¸ªæ–¹æ³•ï¼š
>
> ```kotlin
> // è¿™ä¸ªæ˜¯æ£€æŸ¥ LayoutParams æ˜¯å¦æ˜¯ä½ æƒ³è¦çš„ LayoutParams
> // æ³¨æ„ï¼šè¿™ä¸ª LayoutParams æ˜¯éœ€è¦æ‰“ä¸ª ? çš„ï¼Œå› ä¸ºå­˜åœ¨ä¼ å…¥ä¸€ä¸ª null çš„æƒ…å†µ
> override fun checkLayoutParams(p: LayoutParams?): Boolean {
>     // è¿™æ˜¯æƒ¯ç”¨å†™æ³•
>     return p is NetLayoutParams
> }
> 
> // è¿™ä¸ªæ˜¯é€šè¿‡ AttributeSet å¾—åˆ°ä½ è‡ªå·±çš„ LayoutParmas
> override fun generateLayoutParams(attrs: AttributeSet): LayoutParams {
>     return NetLayoutParams(context, attrs)
> }
> 
> // è¿™ä¸ªæ˜¯è£…æ¢ LayoutParms
> override fun generateLayoutParams(lp: LayoutParams): LayoutParams {
>     // è¿™ä¹Ÿæ˜¯æƒ¯ç”¨å†™æ³•ï¼Œæ³¨æ„ï¼šè¦æŠŠä½  LayoutParams çš„æ‰€æœ‰çˆ¶ç±»éƒ½è¦å†™å®Œ
>     return when (lp) {
>         is NetLayoutParams -> NetLayoutParams(lp)
>         is MarginLayoutParams -> NetLayoutParams(lp)
>         else -> NetLayoutParams(lp)
>     }
> }
> 
> // è¿™ä¸ªæ˜¯å¾—åˆ°é»˜è®¤çš„ LayoutParams
> override fun generateDefaultLayoutParams(): LayoutParams {
>     return NetLayoutParams(
>         NetLayoutParams.UNSET,
>         NetLayoutParams.UNSET,
>         NetLayoutParams.UNSET,
>         NetLayoutParams.UNSET
>     )
> }
> ```
>
> è¿™å‡ ä¸ªæ–¹æ³•ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬ä¼šåœ¨åŽé¢çš„ [LayoutInflater](#1ã€LayoutInflater) è®²è§£

#### 2ã€MeasureSpecs

> æŽ¨èæ–‡ç« ï¼šhttps://www.jianshu.com/p/1260a98a09e9
>
> å®ƒä¿å­˜äº†æµ‹é‡æ¨¡å¼å’Œæµ‹é‡å¤§å°
>
> æ¯”å¦‚ä¸Šé¢ä»£ç ä¸­çš„ï¼š`widthMeasureSpec` å’Œ `heightMeasureSpec`
>
> å¯èƒ½ä½ ä¼šæ¯”è¾ƒç–‘æƒ‘å®ƒæ˜¯æ€Žä¹ˆç”¨ä¸€ä¸ª int æ¥ä¿å­˜çš„ï¼Œå…¶å®žåŽŸç†å¾ˆç®€å•ï¼Œå®ƒä½¿ç”¨é«˜ 2 ä½ä¿å­˜æµ‹é‡æ¨¡å¼ï¼ŒåŽ 30 ä¸ºæµ‹é‡å¤§å°
>
> ```kotlin
> // ä½¿ç”¨æ–¹å¼ï¼ŒåŽŸç†å°±æ˜¯ä½è¿ç®—
> val wSize = MeasureSpec.getSize(widthMeasureSpec)
> val wMode = MeasureSpec.getMode(widthMeasureSpec)
> ```
>
> æµ‹é‡æ¨¡å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š
>
> | æ¨¡å¼              | è¯´æ˜Ž       | åº”ç”¨åœºæ™¯                                     |
> | ----------------- | ---------- | -------------------------------------------- |
> | ***EXACTLY***     | æœ‰å…·ä½“å€¼æ—¶ | ä¸€èˆ¬å¯¹åº” `match_parent` å’Œå…·ä½“çš„å€¼           |
> | ***AT_MOST***     | è‡ªé€‚åº”å¤§å° | ä¸€èˆ¬å¯¹åº” `wrap_content`                      |
> | ***UNSPECIFIED*** | å¯ä»»æ„å–å€¼ | åªå‡ºçŽ°äºŽ `ScrollView`ã€`ListView` è¿™ç±»æŽ§ä»¶ä¸­ |
>
> é‡å†™ ViewGroup æ—¶å°±æ˜¯é€šè¿‡è¿™äº›æ¥åˆ¤æ–­å­ View åº”è¯¥å–å¾—çš„é«˜åº¦çš„
>
> å…³äºŽæ€Žä¹ˆå–ï¼Œå¯ä»¥çœ‹è¿™ä¸ªåœ¨ ViewGroup ä¸­çš„æ–¹æ³•ï¼Œé‡Œé¢æ˜¯å¸¸è§æƒ…å†µæ—¶çš„å–æ³•ï¼Œè¯¥æ–¹æ³•åœ¨å¾ˆå¤šå®˜æ–¹æŽ§ä»¶ä¸­è¢«ä½¿ç”¨
>
> ```java
> /**
>  * @param spec å­ View èƒ½å¾—åˆ°çš„ MeasureSpecsï¼Œä¸€èˆ¬æ˜¯çˆ¶ View çš„æµ‹é‡æ¨¡å¼ + æƒ³ç»™å‡ºçš„å¤§å°
>  * @param padding é—´è·å€¼ï¼Œä¸€èˆ¬è¿™æ ·å¡«å…¥ï¼šlayoutParams.leftMargin + layoutParams.rightMargin
>  * @param childDimension å­ View çš„å®½æˆ–è€…é«˜ï¼Œå›ºå®šå¡«å…¥ï¼šchild.width æˆ–è€… child.height
>  */
> public static int getChildMeasureSpec(int spec, int padding, int childDimension) {
>     int specMode = MeasureSpec.getMode(spec); // æµ‹é‡æ¨¡å¼
>     int specSize = MeasureSpec.getSize(spec); // æµ‹é‡é•¿åº¦
> 
>     int size = Math.max(0, specSize - padding); // å…ˆå‡åŽ»é—´è·å€¼å¾—åˆ°çš„æœ€å¤§é•¿åº¦
> 
>     int resultSize = 0; // ä¿å­˜æœ€åŽçš„é•¿åº¦å€¼
>     int resultMode = 0; // ä¿å­˜æœ€åŽçš„æµ‹é‡ï¼Œæ¨¡å¼
> 
>     switch (specMode) {
>     // å¦‚æžœæµ‹é‡æ¨¡å¼æ˜¯å…·ä½“å€¼ï¼Œå³ä¸€èˆ¬å¯¹åº”çˆ¶ View ä¸º match_parent æˆ–è€… ç¡®å®šå€¼
>     case MeasureSpec.EXACTLY:
>         if (childDimension >= 0) {
>             // å‡è®¾å­ View å›ºå®šä¸º 100dp
>             resultSize = childDimension;
>             resultMode = MeasureSpec.EXACTLY;
>         } else if (childDimension == LayoutParams.MATCH_PARENT) {
>             // å­ View æ˜¯ match_parent
>             resultSize = size; // é‚£ç»“æžœå€¼å°±æ˜¯æœ€å¤§å€¼
>             resultMode = MeasureSpec.EXACTLY; // æµ‹é‡æ¨¡å¼ä¿æŒä¸€æ ·ï¼Œä¸ºå…·ä½“å€¼
>         } else if (childDimension == LayoutParams.WRAP_CONTENT) {
>             // å­ View æ˜¯ wrap_content
>             resultSize = size;
>             resultMode = MeasureSpec.AT_MOST; // æ”¹å˜æµ‹é‡æ¨¡å¼ä¸ºè‡ªé€‚åº”å¤§å°
>         }
>         break;
> 
>     // å¦‚æžœæµ‹é‡æ¨¡å¼æ˜¯è‡ªé€‚åº”å¤§å°ï¼Œå³ä¸€èˆ¬å¯¹åº”çˆ¶ View ä¸º wrap_content
>     case MeasureSpec.AT_MOST:
>         if (childDimension >= 0) {
>             // å‡è®¾å­ View å›ºå®šä¸º 100dp
>             resultSize = childDimension;
>             resultMode = MeasureSpec.EXACTLY;
>         } else if (childDimension == LayoutParams.MATCH_PARENT) {
>             // å­ View æ˜¯ match_parent
>             // è¿™é‡Œæ¯”è¾ƒé‡è¦
>             // è¿™é‡Œå¯¹åº”çˆ¶ View ä¸º wrap_contentï¼Œä½†å­ View å´ä¸º match_parent
>             resultSize = size; // è¿™é‡Œçš„æ„æ€æ˜¯ç»™å‡ºå­ View èƒ½å¾—åˆ°çš„æœ€å¤§å€¼
>             resultMode = MeasureSpec.AT_MOST;
>         } else if (childDimension == LayoutParams.WRAP_CONTENT) {
>             // å­ View æ˜¯ wrap_content
>             resultSize = size;
>             resultMode = MeasureSpec.AT_MOST;
>         }
>         break;
> 
>     // å¦‚æžœæµ‹é‡æ¨¡å¼æ˜¯å¯ä»»æ„å–å€¼ï¼Œå³ä¸€èˆ¬å¯¹åº”çˆ¶ View ä¸º ScrollView
>     case MeasureSpec.UNSPECIFIED:
>         if (childDimension >= 0) {
>             // å‡è®¾å­ View å›ºå®šä¸º 100dp
>             resultSize = childDimension;
>             resultMode = MeasureSpec.EXACTLY;
>         } else if (childDimension == LayoutParams.MATCH_PARENT) {
>             // å­ View æ˜¯ match_parent
>             // è¿™ä¸ª sUseZeroUnspecifiedMeasureSpec å˜é‡ç”¨äºŽå…¼å®¹ Android æ—§ç‰ˆæœ¬
>             resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;
>             resultMode = MeasureSpec.UNSPECIFIED;
>         } else if (childDimension == LayoutParams.WRAP_CONTENT) {
>             // å­ View æ˜¯ wrap_content
>             resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;
>             resultMode = MeasureSpec.UNSPECIFIED;
>         }
>         break;
>     }
>     return MeasureSpec.makeMeasureSpec(resultSize, resultMode);
> }
> ```
>
> å¦‚æžœä½ ä»¥åŽå¼€å‘è‡ªå®šä¹‰ ViewGroupï¼Œåœ¨ç»™å­ View æµ‹é‡æ—¶æˆ‘æ›´æŽ¨èä½¿ç”¨è¯¥æ–¹æ³•ï¼Œéµå¾ªå®˜æ–¹çš„å†™æ³•å¯ä»¥æé«˜å¯è¯»æ€§

#### 3ã€onMeasure() æºç ç›¸å…³åˆ†æž

##### 1ã€FrameLayout çš„ onMeasure() æºç åˆ†æž

> ```java
> // æŽ¥ä¸‹æ¥æ˜¯èµ·é£žçŽ¯èŠ‚
> @Override
> protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
>  int count = getChildCount();
> 
>  // åˆ¤æ–­è‡ªèº«æ˜¯å¦æœ‰ä¸€è¾¹ä¸æ˜¯å…·ä½“å€¼ï¼Œä½œç”¨å¦‚ä¸‹ï¼š
>  // æ¯”å¦‚ FrameLayout çš„å®½æ˜¯ wrap_contentï¼Œä½†å…¶ä¸­ä¸€ä¸ªå­ View å®½ä¸º match_parent
>  // é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ FrameLayout æ˜¯ä¸çŸ¥é“è¯¥ç»™è¿™ä¸ªå­ View å®½åº¦å¤šå°‘çš„
>  // ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶ä»– View æ¥åˆ¤æ–­ FrameLayout èƒ½å¾—åˆ°çš„å®½åº¦
>  // è¿™ä¸ªæ—¶å€™å°±çŸ¥é“ FraneLayout å®½åº¦å€¼èƒ½å–å¤šå°‘äº†
>  final boolean measureMatchParentChildren =
>          MeasureSpec.getMode(widthMeasureSpec) != MeasureSpec.EXACTLY ||
>          MeasureSpec.getMode(heightMeasureSpec) != MeasureSpec.EXACTLY;
>  // è¿™ä¸ªæ˜¯ä¿å­˜ä¸Šè¿°æ‰€è¯´çš„é‚£ç§å­ Viewï¼Œç”¨äºŽäºŒæ¬¡æµ‹é‡
>  mMatchParentChildren.clear(); 
> 
>  int maxHeight = 0;
>  int maxWidth = 0;
>  // çŠ¶æ€å€¼ï¼Œç”¨æ¥è®°å½•å­ View æ˜¯å¦å¾—åˆ°äº†æƒ³è¦çš„å¤§å°ï¼Œç”¨çš„å¾ˆå°‘ï¼Œå¿½ç•¥å³å¯
>  int childState = 0; 
> 
>  // éåŽ†æ‰€æœ‰å­ View
>  for (int i = 0; i < count; i++) {
>      final View child = getChildAt(i);
>      // è¿™ä¸ª mMeasureAllChildren æ˜¯ä¸€ä¸ªå±žæ€§ï¼Œä½œç”¨ï¼šæ˜¯å¦å¿½ç•¥ Gone çš„å½±å“
>      // child.getVisibility() != GONEï¼šGone æ—¶ä¸æµ‹é‡å­ View
>      // è¿™ä¸ª Gone æ—¶å†è‡ªå·±å†™è‡ªå®šä¹‰ View å»ºè®®ä¹Ÿåˆ¤æ–­ä¸Š
>      if (mMeasureAllChildren || child.getVisibility() != GONE) {
>          // measureChildWithMargins() é‡Œé¢è°ƒç”¨äº†æµ‹é‡å­ View çš„æ–¹æ³•
>          // ä¹‹åŽä¼šæåˆ°è¯¥æ–¹æ³•ï¼Œä½ åªéœ€è¦çŸ¥é“è°ƒç”¨åŽå¯ä»¥å¾—åˆ°å­ View æµ‹é‡çš„å®½å’Œé«˜
>          // ä½†è¿™ä¸ªå®½å’Œé«˜ä¸æ˜¯ width å’Œ heightï¼Œè€Œæ˜¯ measuredWidth å’Œ measuredHeight
>          measureChildWithMargins(child, widthMeasureSpec, 0, heightMeasureSpec, 0);
>          // å¾—åˆ° LayoutParamsï¼Œä¸»è¦æ˜¯ä»Žé‡Œé¢å–å¾—å®šä¹‰çš„ Margin å€¼
>          final LayoutParams lp = (LayoutParams) child.getLayoutParams();
>          // ä¿å­˜å­ View ä¸­æœ€å¤§çš„å®½åº¦
>          maxWidth = Math.max(maxWidth,
>                  child.getMeasuredWidth() + lp.leftMargin + lp.rightMargin);
>          // ä¿å­˜å­ View ä¸­æœ€å¤§çš„é«˜åº¦
>          maxHeight = Math.max(maxHeight,
>                  child.getMeasuredHeight() + lp.topMargin + lp.bottomMargin);
>          // çŠ¶æ€å€¼ï¼Œå¿½ç•¥å³å¯ï¼Œåœ¨ ViewRootImpl ä¸­æœ‰ä½¿ç”¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è‡ªå®šä¹‰ View ä¸ç”¨
>          childState = combineMeasuredStates(childState, child.getMeasuredState());
>          // æœ€å¼€å§‹çš„é‚£ä¸ª boolean å€¼ï¼Œç”¨æ¥ä¿å­˜æ˜¯ match_parent çš„ View
>          if (measureMatchParentChildren) {
>              if (lp.width == LayoutParams.MATCH_PARENT ||
>                      lp.height == LayoutParams.MATCH_PARENT) {
>                  mMatchParentChildren.add(child);
>              }
>          }
>      }
>  }
> 
>  // æœ€å¤§å€¼åŠ ä¸Š padding å€¼
>  // getPadding*WithForeground() æ˜¯å†…éƒ¨æ–¹æ³•ï¼Œæˆ‘ä»¬è‡ªå·±ç”¨æ—¶æ˜¯ä½¿ç”¨ getPadding*() ä»£æ›¿
>  maxWidth += getPaddingLeftWithForeground() + getPaddingRightWithForeground();
>  maxHeight += getPaddingTopWithForeground() + getPaddingBottomWithForeground();
> 
>  // æ£€æŸ¥æœ€å°å€¼çš„è®¾ç½®
>  // View éƒ½è‡ªå¸¦äº†ä¸€ä¸ª android:minHeight å±žæ€§ï¼Œè‡ªå·±è‡ªå®šä¹‰ View æ—¶å»ºè®®æŠŠè¿™ä¸ªé€‚é…ä¸€ä¸‹
>  maxHeight = Math.max(maxHeight, getSuggestedMinimumHeight());
>  maxWidth = Math.max(maxWidth, getSuggestedMinimumWidth());
> 
>  // å¾—åˆ°å‰å°çš„èƒŒæ™¯å›¾ï¼Œå†ä¸Žæœ€å¤§å€¼æ¯”è¾ƒ
>  final Drawable drawable = getForeground();
>  if (drawable != null) {
>      maxHeight = Math.max(maxHeight, drawable.getMinimumHeight());
>      maxWidth = Math.max(maxWidth, drawable.getMinimumWidth());
>  }
> 
>  // å…³é”®æ–¹æ³•ï¼Œè°ƒç”¨ setMeasuredDimension() è®¾ç½®è‡ªèº«å®½å’Œé«˜
>  setMeasuredDimension(resolveSizeAndState(maxWidth, widthMeasureSpec, childState),
>          resolveSizeAndState(maxHeight, heightMeasureSpec,
>                  childState << MEASURED_HEIGHT_STATE_SHIFT));
> 
>  // åœ¨ä¸Šé¢é‚£ä¸ªè°ƒç”¨è¿‡åŽï¼Œå°±èƒ½å¾—åˆ°è‡ªèº«çš„å®½å’Œé«˜äº†
>  // ç„¶åŽè¿™é‡Œå†é‡å†™æµ‹é‡ä¸º match_parent çš„ View
>  count = mMatchParentChildren.size();
>  // è¿™ä¸ª count åˆ¤æ–­æˆ‘ä¸ªäººæ„Ÿè§‰æœ‰ç‚¹é—®é¢˜
>  // count æ˜¯æŒ‡ä¸º match_parent View çš„æ•°é‡ï¼Œ
>  // è€Œå¦‚æžœæˆ‘åªæœ‰ä¸€ä¸ª View æ˜¯ match_parentï¼Œé‚£å®ƒä¸æ˜¯å°±ä¸ä¼šé‡æ–°æµ‹é‡äº†å—ï¼Ÿ
>  // çœŸå¥‡æ€ªï¼Œæˆ‘æ„Ÿè§‰è¯¥ç”¨ childCount
>  if (count > 1) {
>      for (int i = 0; i < count; i++) {
>          final View child = mMatchParentChildren.get(i);
>          final MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();
> 
>          final int childWidthMeasureSpec;
>          if (lp.width == LayoutParams.MATCH_PARENT) {
>              final int width = Math.max(0, getMeasuredWidth()
>                         - getPaddingLeftWithForeground() - getPaddingRightWithForeground()
>                         - lp.leftMargin - lp.rightMargin);
>                 childWidthMeasureSpec = MeasureSpec.makeMeasureSpec(
>                         width, MeasureSpec.EXACTLY);
>             } else {
>                 childWidthMeasureSpec = getChildMeasureSpec(widthMeasureSpec,
>                         getPaddingLeftWithForeground() + getPaddingRightWithForeground() +
>                         lp.leftMargin + lp.rightMargin,
>                         lp.width);
>             }
> 
>             final int childHeightMeasureSpec;
>             if (lp.height == LayoutParams.MATCH_PARENT) {
>                 final int height = Math.max(0, getMeasuredHeight()
>                         - getPaddingTopWithForeground() - getPaddingBottomWithForeground()
>                         - lp.topMargin - lp.bottomMargin);
>                 childHeightMeasureSpec = MeasureSpec.makeMeasureSpec(
>                         height, MeasureSpec.EXACTLY);
>             } else {
>                 childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,
>                         getPaddingTopWithForeground() + getPaddingBottomWithForeground() +
>                         lp.topMargin + lp.bottomMargin,
>                         lp.height);
>             }
>             // è¿™é‡Œå¯ä»¥å‘çŽ° onMeasure() ä¸æ­¢ä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæœ‰æ—¶å€™éœ€è¦è°ƒç”¨å¤šæ¬¡æ‰èƒ½æµ‹é‡å®Œæˆ 
>             child.measure(childWidthMeasureSpec, childHeightMeasureSpec);
>         }
>     }
> 
> ```
>
> 

##### 2ã€NestedScrollView åµŒå¥— Rv å¤ç”¨å¤±æ•ˆ

> æŽ¥ä¸‹æ¥å¼€å§‹åšç«ç®­
>
> æˆ‘ä»¬æ¥åˆ†æžä¸€ä¸‹æˆ‘å¯’å‡æ—¶å¤šæ¬¡æåˆ° NestedScrollView åµŒå¥— Rvï¼Œå¯¼è‡´ Rv å¤ç”¨å¤±æ•ˆçš„é—®é¢˜ï¼Œç½‘ä¸Šæˆ‘è¿˜æ²¡æœ‰çœ‹è¿‡å¾ˆè¯¦ç»†çš„ä»Žæºç è§’åº¦æ¥åˆ†æžçš„æ–‡ç« 
>
> é¦–å…ˆæˆ‘ä»¬è¦æƒ³æƒ³é—®ä»€ä¹ˆä¼šå¤±æ•ˆï¼Ÿ
>
> å¤±æ•ˆè¯´æ˜Ž Rv æŠŠå…¨éƒ¨å­ View éƒ½æµ‹é‡å®Œäº†ï¼Œé‚£è¯´æ˜Žè‚¯å®šæ˜¯ `onMeasure()` çš„é—®é¢˜ï¼Œokï¼Œé‚£æˆ‘ä»¬æ¥ debug ä¸€ä¸‹ `onMeasure()` çš„æ•´ä¸ªæµç¨‹
>
> ##### é¦–å…ˆä»Ž NestedScrollView çš„ onMeasure() å¼€å§‹ debug
>
> > ![image-20220321225743926](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321225743926.png)
> >
> > å¯ä»¥å‘çŽ° NestedScrollView æŠŠæµ‹é‡ç›´æŽ¥äº¤ç»™äº†çˆ¶ç±» FrameLayout å¤„ç†ï¼Œï¼ˆä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œä¸é‡å†™ `onMeasure()` é‚£ NestedScrollView æ˜¯æ€Žä¹ˆå®žçŽ°ä¸åŒäºŽå…¶ä»– View æµ‹é‡çš„ï¼Ÿè¿™ä¸ªé—®é¢˜åœ¨ä¸‹é¢ä¼šè®²è§£ï¼‰
> >
> > åˆç”±äºŽ `mFillViewport` ä¸º `false`ï¼Œå°±ç›´æŽ¥ return äº†ï¼Œè‡³äºŽ `mFillViewport` æ˜¯ä»€ä¹ˆæˆ‘ä»¬åŽé¢ä¼šè®²è§£
>
> ##### æ¥åˆ° FrameLayout çš„ onMeasure() å®žçŽ°
>
> > ![image-20220321230004519](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230004519.png)
> >
> > è¿™é‡Œåªæœ‰ä¸€ä¸ª Viewï¼Œå°±æ˜¯ Rvï¼Œç„¶åŽ FrameLayout è°ƒç”¨äº† `measureChildWithMargins(child, widthMeasureSpec, 0, heightMeasureSpec, 0)`ï¼Œè¿™ä¸ªå‡½æ•°è¢« NestedScrollView é‡å†™äº†ï¼Œç„¶åŽç»™å‡ºäº†ä¸€ä¸ª `MeasureSpec.UNSPECIFIED`ï¼Œè¿™å°±æ˜¯ NestedScrollView ä¸åŒäºŽå…¶ä»– View æµ‹é‡çš„åŽŸå› 
> >
> > ![image-20220321230432739](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230432739.png)
> >
> > ä»”ç»†çœ‹çº¢çº¿å¤„ï¼Œè¿™é‡Œå®ƒç»™å‡ºçš„é«˜åº¦ç«Ÿç„¶ç›´æŽ¥ä¸º `lp.topMargin + lp.bottomMargin`ï¼Œå¯èƒ½ä½ ä¸ä¼šæ„è¯†åˆ°è¿™ä¸ªæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ NestedScrollView çš„å­ªç”Ÿå…„å¼Ÿ ScrollView å¯¹äºŽè¯¥æ–¹æ³•çš„å®žçŽ°
> >
> > ![image-20220321230936516](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230936516.png)
> >
> > å‘çŽ°ä¸åŒäº†å—ï¼ŒScrollView æœ‰ä¸ª `parentHeightMeasureSpec` çš„é«˜åº¦ï¼Œè€Œ NestedScrollView åªä½¿ç”¨äº† `lp.topMargin + lp.bottomMargin`ï¼Œå¦‚æžœå­ View æ²¡å¾— margin å€¼ï¼Œé‚£ä¸å°±ç›´æŽ¥ç»™å­ View ä¼ å…¥çš„é«˜åº¦ä¸º 0 äº†ï¼Ÿ
> >
> > NestedScrollView ä¸Ž ScrollView åœ¨è¿™ä¸ªæ–¹æ³•ä¸Šçš„ä¸åŒï¼Œå°±æ˜¯é€ æˆ Rv å¤ç”¨å¤±æ•ˆçš„ç›´æŽ¥åŽŸå› ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬æŽ¢ç©¶ä¸€ä¸‹æ ¹æœ¬åŽŸå› 
>
> ##### æ¥åˆ° Rv çš„ onMeasure
>
> > ç´§æŽ¥ç€ä¸Šé¢ç»§ç»­ debugï¼Œæˆ‘ä»¬æ¥åˆ°äº† Rv çš„ `onMeasure()` å®žçŽ°
> >
> > ![image-20220321231555746](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321231555746.png)
> >
> > å¯ä»¥å‘çŽ°è¿™é‡Œ `heightSpec` ä¸º 0
>
> ##### æ¥åˆ° dispatchLayoutStep2() æ–¹æ³•
>
> > ![image-20220321231735164](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321231735164.png)
> >
> > å‰é¢é‚£ä¸ª `dispatchLayoutStrp1()` å› ä¸ºä¸å¤„äºŽ `State.STEP_START` è€Œè·³è¿‡äº†
>
> ##### å‘çŽ° mLayout.onLayoutChildren()
>
> > ![image-20220321232502431](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321232502431.png)
> >
> > æ•´ä¸ª `dispatchLayoutChild2()` ä¸€çœ‹å°±åªæœ‰è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºŽå¸ƒå±€çš„ï¼Œdebug è¿›åŽ»è¯•è¯•
>
> ##### æŽ¢ç´¢ onLayoutChild() æ–¹æ³•
>
> > ![image-20220321233030377](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321233030377.png)
> >
> > å‰é¢æœ‰ä¸€å †æ–¹æ³•ï¼Œä½†å…¶å®ž Rv æ˜¯è°ƒç”¨è¿™ä¸ª `fill()` æ¥ç»™å­ View å¸ƒå±€çš„
>
> ##### æŽ¢ç´¢ fill()
>
> > ![image-20220321233713916](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321233713916.png)
> >
> > è¿™ä¸ª while å¾ˆé‡è¦ï¼Œå°±æ˜¯ä¾é è¿™ä¸ªå¾ªçŽ¯æ¥æµ‹é‡å­ View çš„ï¼Œè™½ç„¶ä½ åº”è¯¥çœ‹çš„å¾ˆæ‡µé€¼ï¼Œä½†è¯·è®°ä½è¿™ä¸¤ä¸ªä¸œè¥¿ï¼š
> >
> > `layoutState.mInfinite = true` å’Œ `remainingSpace = 0`ï¼ŒåŽé¢çš„ `layoutState.hasMore(state)` æ˜¯ç”¨äºŽåˆ¤æ–­æ¬¡æ•°æ˜¯å¦è¾¾åˆ° ItemCount çš„ï¼Œå¯ä»¥ä¸ç”¨ç®¡
> >
> > è¿™é‡Œå°±ç›´æŽ¥å‘Šè¯‰ä½ ç»“è®ºï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ª `layoutState.mInfinite = true` å¯¼è‡´å®ƒä¸€ç›´æ‰§è¡Œå¾ªçŽ¯ï¼Œç„¶åŽä¸€ç›´åˆ° `layoutState.hasMore(state) = false` æ‰ç»“æŸï¼Œå³æŠŠ ItemCount ä¸ª item éƒ½æµ‹é‡å®Œäº†
> >
> > å¾ˆæ‡µé€¼æ˜¯ä¸æ˜¯ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æžœä½¿ç”¨ ScrollView åŒ…è£¹è¿è¡Œåˆ°è¿™é‡Œæ—¶ä¼šæ€Žä¹ˆæ ·ï¼Ÿ
> >
> > ![image-20220321234733578](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321234733578.png)
> >
> > çœ‹åˆ°åŒºåˆ«äº†å§ï¼Œä½¿ç”¨ ScrollView æ—¶ä¼šä¸ä¸€æ ·ï¼Œå…¶ä¸­ `layoutState.mInfinite = false` å’Œ `remainingSpace = 1868` 
> >
> > å¦‚æžœä½¿ç”¨ ScrollView ç»§ç»­å¾€ä¸‹èµ°
> >
> > ![image-20220321234928364](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321234928364.png)
> >
> > ä»–ä¼šåœ¨è¿™ä¸ªåœ°æ–¹å‡å°‘ `remainingSpace` çš„å€¼ï¼Œæœ€åŽå°±å¯ä»¥ä½¿ while å¾ªçŽ¯æå‰é€€å‡ºäº†
>
> OKï¼ŒåŸºæœ¬ä¸Šæ ¹æœ¬åŽŸå› æ‰¾åˆ°äº†ï¼Œä½†ä¸ºä»€ä¹ˆé‚£ä¸ª `layoutState.mInfinite = true` ä¸” `remainingSpace = 0` å‘¢ï¼Ÿ
>
> ç»§ç»­åˆ†æž
>
> ##### ä¸ºä»€ä¹ˆ layoutState.mInfinite = true ?
>
> > ![image-20220321235408579](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321235408579.png)
> >
> > ç‚¹å‡» `layoutState.mInfinite`ï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ° `mLayoutState.mInfinite` åœ¨è¿™é‡Œè¢«èµ‹å€¼
> >
> > ç‚¹è¿›åŽ»çœ‹çœ‹å®ƒèµ‹çš„ä»€ä¹ˆå€¼
> >
> > ![image-20220321235709470](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321235709470.png)
> >
> > ç¬¬ä¸€ä¸ª `getMode() == View.MeasureSpec.UNSPECIFIED` è‚¯å®šæ˜¯ `true`ï¼Œå› ä¸ºå¤–å¸ƒå±€æ˜¯ NestedScrollView å˜›ï¼Œå‰é¢æåˆ°äº†å®ƒé‡å†™äº† FrameLayout çš„ `measureChildWithMargins()` æ–¹æ³•ï¼Œç»™çš„å­ View çš„æµ‹é‡æ¨¡å¼æ˜¯ `MeasureSpec.UNSPECIFIED` ï¼Œç¬¬äºŒä¸ªåˆ¤æ–­ `mOrientationHelper.getEnd() == 0`ï¼Œæ ¹æ® debug å¯ä»¥å¾—åˆ°å€¼ä¹Ÿä¸º `true`
> >
> > ç»§ç»­è·Ÿè¸ª `mOrientationHelper.getEnd() == 0` çš„åŽŸå› 
> >
> > ![image-20220322000124439](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000124439.png)
> >
> > å¯ä»¥å‘çŽ°å®ƒç›´æŽ¥è°ƒç”¨äº† `mLayoutManger.getHeight()`ï¼Œç»§ç»­
> >
> > ![image-20220322000411111](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000411111.png)
> >
> > `mHeight` è¢«ä¿®æ”¹çš„åœ°æ–¹å¦‚ä¸‹
> >
> > ![image-20220322000630000](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000630000.png)
> >
> > å…¶ä¸­å‰é¢ä¸¤ä¸ªæ˜¯ `setRecyclerView()` æ˜¯åœ¨ Rv æ·»åŠ  Adapter æ—¶è®¾ç½®çš„åˆå§‹å€¼ï¼Œè‚¯å®šä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„åœ°æ–¹ï¼Œé‚£åªèƒ½æ˜¯ `setMeasureSpecs()` äº†
> >
> > ![image-20220322000826091](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000826091.png)
> >
> > è¿™é‡Œæœ‰ä¸€ä¸ª `mHeight = 0` çš„æ“ä½œï¼Œç‚¹å‡»æ–¹æ³•åç§°çœ‹çœ‹æ˜¯è°è°ƒç”¨äº†å®ƒ
> >
> > ![image-20220322000941813](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322000941813.png)
> >
> > è¿æ°”çœŸå¥½ï¼Œåˆšå¥½å›žåˆ°äº†æˆ‘ä»¬ä¹‹å‰å¤§çš„æ–­ç‚¹å‰ï¼Œé‚£åªèƒ½è¯´æ˜Žå°±æ˜¯åœ¨è¿™é‡Œè°ƒç”¨çš„ï¼Œæ‰€ä»¥ `mHeight = 0`ï¼Œå¯¼è‡´å‰é¢çš„ `mOrientationHelper.getEnd() == 0` ä¸º `true`ï¼Œæœ€åŽå¯¼è‡´ `layoutState.mInfinite` ä¸º `true` äº† 
>
> ##### ä¸ºä»€ä¹ˆ remainingSpace = 0ï¼Ÿ
>
> > å¦‚æžœä½ å¤§èƒ†çŒœæµ‹çš„è¯ï¼Œåº”è¯¥èƒ½çŒœåˆ°è‚¯å®šä¸Ž `mHeight` æœ‰å…³ç³»
> >
> > å…ˆæ¥åˆ°è¿™é‡Œ
> >
> > ![image-20220322001506870](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322001506870.png)
> >
> > æˆ‘ä»¬å¯ä»¥çŸ¥é“ `remainingSpace` ç”± `layoutState.mAvailable + layoutState.mExtraFillSpace` ç»„æˆï¼Œå…¶ä¸­é€šè¿‡æŸ¥çœ‹æ³¨é‡Šå¯ä»¥çŸ¥é“è·Ÿ `layoutState.mExtraFillSpace` æ²¡æœ‰å…³ç³»ï¼Œé‚£å°±åŽ»å¯»æ‰¾ `layoutState.mAvailable` å§
> >
> > å¯æ˜¯ `layoutState.mAvailable` è¢«æ”¹å˜çš„åœ°æ–¹æœ‰ç‚¹å¤šï¼Œä¸æ˜¯å¾ˆå¥½å®šä½ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è¯•è¯•ç»™è¿™ä¸ªå˜é‡æ‰“ä¸Šæ–­ç‚¹ï¼Œé‡æ–°èµ°ä¸€ä¸‹æµç¨‹ï¼ŒæŽ¥ä¸‹æ¥å°±æ˜¯é‡æ–° debug ä¸€é
> >
> > ![image-20220322002054498](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002054498.png)
> >
> > ä¸€ä¸‹å­å°±æ‰¾åˆ°äº†ï¼Œä¸å¾—ä¸è¯´ debug ç¡®å®žå¾ˆæ–¹ä¾¿
> >
> > ç‚¹å‡»åŽ»çœ‹ä¸€ä¸‹ `mOrientationHelper.getEndAfterPadding()` æ–¹æ³•
> >
> > ![image-20220322002252433](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002252433.png)
> >
> > æžœç„¶ï¼Œè·Ÿæœ€å¼€å§‹çš„çŒœæµ‹ä¸€æ ·ï¼Œå®ƒä¸Ž `mHeight` æœ‰å…³ç³»
> >
> > é‚£ `updateLayoutStateToFillEnd()` æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„å‘¢ï¼Ÿ
> >
> > ![image-20220322002424079](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322002424079.png)
> >
> > ä»Žè°ƒç”¨æ ˆå‘çŽ°åŽŸæ¥ä»–åœ¨ `fill()` æ–¹æ³•å‰è¢«è°ƒç”¨äº†
> >
> > OKï¼Œè¿™ä¸‹å­ NestedScrollView åµŒå¥— Rv ä½¿å¤ç”¨å¤±æ•ˆçš„æ ¹æœ¬åŽŸå› å’Œå†³å®šæ€§å› ç´ éƒ½æ‰¾åˆ°äº†
>
> ### å¦‚ä½•è§£å†³å¤ç”¨å¤±æ•ˆé—®é¢˜ï¼Ÿ
>
> æ ¹æ®ä¸Šé¢çš„æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸‹é¢è¿™å‡ ç§æ–¹æ³•ï¼š
>
> ##### 1ã€é‡å†™ NestedScrollView çš„ `measureChildWithMargins()` æ–¹æ³•
>
> > ```kotlin
> > /**
> >  * é‡å†™è¯¥æ–¹æ³•çš„å‡ ä¸ªåŽŸå› ï¼š
> >  * 1ã€ä¸ºäº†åœ¨ UNSPECIFIED æ¨¡å¼ä¸‹ï¼ŒRv ä¹Ÿèƒ½å¾—åˆ° NestedScrollView çš„é«˜åº¦
> >  * 2ã€NestedScrollView ä¸Ž ScrollView åœ¨å¯¹äºŽå­ View é«˜åº¦å¤„ç†æ—¶åœ¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¸ä¸€æ ·, å¯¼è‡´
> >  *    NestedScrollView ä¸­å­ View å¿…é¡»ä½¿ç”¨å…·ä½“çš„é«˜åº¦, è®¾ç½®æˆ wrap_content æˆ– match_parent
> >  *    éƒ½å°†æ— æ•ˆï¼Œå…·ä½“çš„å¯ä»¥åŽ»çœ‹ ScrollView å’Œ NestedScrollView ä¸­å¯¹äºŽè¿™åŒä¸€æ–¹æ³•çš„æºç 
> >  * 3ã€åœ¨ NestedScrollView ä¸­åµŒå¥— RecyclerView ä¼šä½¿ RecyclerView çš„æ‡’åŠ è½½å¤±æ•ˆï¼Œç›´æŽ¥åŽŸå› å°±ä¸Ž
> >  *    è¿™ä¸ªæ–¹æ³•æœ‰å…³ï¼Œè€Œä½¿ç”¨ ScrollView å°±ä¸ä¼šé€ æˆæ‡’åŠ è½½å¤±æ•ˆçš„æƒ…å†µ
> >  * 4ã€è‡³äºŽä¸ºä»€ä¹ˆ NestedScrollView ä¸Ž ScrollView åœ¨è¯¥æ–¹æ³•ä¸åŒï¼Œæˆ‘çŒœæµ‹åŽŸå› æ˜¯ä¸ºäº†å…¼å®¹ä»¥å‰çš„ Android ç‰ˆæœ¬ï¼Œ
> >  *    åœ¨ ViewGroup#getChildMeasureSpec() æ–¹æ³•ä¸­å¯ä»¥å‘çŽ°ä½¿ç”¨äº†
> >  *    ä¸€ä¸ªé™æ€å˜é‡ sUseZeroUnspecifiedMeasureSpec
> >  *    æ¥åˆ¤æ–­ UNSPECIFIED æ¨¡å¼ä¸‹å­ View è¯¥å¾—åˆ°çš„å¤§å°ï¼Œä½†å¯èƒ½è®¾è®¡ NestedScrollView â€œå·æ‡’â€äº†ï¼Œ
> >  *    æ²¡æœ‰åŠ è¿™ä¸ªä¸œè¥¿ï¼Œå…·ä½“åŽŸå› ä¸çŸ¥
> >  */
> > override fun measureChildWithMargins(
> >     child: View,
> >     parentWidthMeasureSpec: Int,
> >     widthUsed: Int,
> >     parentHeightMeasureSpec: Int,
> >     heightUsed: Int
> > ) {
> >     val lp = child.layoutParams as MarginLayoutParams
> > 
> >     val childWidthMeasureSpec = getChildMeasureSpec(
> >         parentWidthMeasureSpec,
> >         paddingLeft + paddingRight + lp.leftMargin + lp.rightMargin
> >                 + widthUsed, lp.width
> >     )
> >     // è¿™é‡Œçš„å†™æ³•ä¸Ž ScrollView é‡Œé¢çš„ä¸€æ ·
> >     val usedTotal = paddingTop + paddingBottom + lp.topMargin + lp.bottomMargin + heightUsed
> >     val childHeightMeasureSpec: Int = MeasureSpec.makeMeasureSpec(
> >         max(0, MeasureSpec.getSize(parentHeightMeasureSpec) - usedTotal),
> >         MeasureSpec.UNSPECIFIED
> >     )
> > 
> >     child.measure(childWidthMeasureSpec, childHeightMeasureSpec)
> > }
> > ```
>
> ##### 2ã€ç›´æŽ¥ç»™ Rv è®¾ç½®å›ºå®šé«˜åº¦
>
> > è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥ç›´æŽ¥ä¿®æ”¹ `mHeight` çš„å€¼ï¼Œä»Žä¹‹å‰çš„åˆ†æžä¸­å¯ä»¥å¾—åˆ°`layoutState.mInfinite` å’Œ `remainingSpace` éƒ½ä¸Ž `mHeight` æœ‰å…³ï¼Œæ‰€ä»¥ä¿®æ”¹ `mHeight` å°±å¯ä»¥ä»Žæ ¹æºä¸Šè§£å†³å¤ç”¨å¤±æ•ˆé—®é¢˜
>
> ##### 3ã€ä½¿ç”¨ mFillViewport å±žæ€§ï¼Œä½†éœ€è¦ NsetedScrollView çš„ layout_height = match_parent æˆ– ç¡®å®šå€¼
>
> > å‰é¢åœ¨ `onMeasure()` æåˆ°äº†ä¸€ä¸ª `mFillViewport` å˜é‡
> >
> > è¿™æ˜¯å®ƒçš„å®˜æ–¹è§£é‡Šï¼š
> >
> > > è®¾ç½®æ­¤ ScrollView æ˜¯å¦åº”æ‹‰ä¼¸å…¶å†…å®¹é«˜åº¦ä»¥å¡«å……è§†å£
> >
> > å®ƒå¯¹åº”è¿™ä¸ªå±žæ€§ï¼š
> >
> > ![image-20220322003418726](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322003418726.png)
> >
> > ä½†å†æ¬¡ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ï¼Œè®¾ç½®ä¸º `true` åŽ `onMeasure()` å¹²äº†äº›ä»€ä¹ˆä¸œè¥¿
> >
> > ```java
> > @Override
> > protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
> >     super.onMeasure(widthMeasureSpec, heightMeasureSpec);
> >     // mFillViewport ä¸º true ä¸ä¼šè¢« return äº†
> >     if (!mFillViewport) {
> >         return;
> >     }
> > 
> >     final int heightMode = MeasureSpec.getMode(heightMeasureSpec);
> >     if (heightMode == MeasureSpec.UNSPECIFIED) {
> >         return;
> >     }
> > 
> >     if (getChildCount() > 0) {
> >         View child = getChildAt(0);
> >         final NestedScrollView.LayoutParams lp = (LayoutParams) child.getLayoutParams();
> > 
> >         int childSize = child.getMeasuredHeight();
> >         
> >         // å…³é”®åœ¨äºŽè¿™é‡Œï¼Œå¾—åˆ°è‡ªèº«çš„æµ‹é‡é«˜åº¦
> >         // è¿™ä¸ªæµ‹é‡é«˜åº¦æ˜¯ä¹‹å‰è°ƒç”¨ super.onMeasure() è€Œè®¾ç½®çš„
> >         int parentSpace = getMeasuredHeight()
> >                 - getPaddingTop()
> >                 - getPaddingBottom()
> >                 - lp.topMargin
> >                 - lp.bottomMargin;
> > 
> >         if (childSize < parentSpace) {
> >             int childWidthMeasureSpec = getChildMeasureSpec(widthMeasureSpec,
> >                     getPaddingLeft() + getPaddingRight() + lp.leftMargin + lp.rightMargin,
> >                     lp.width);
> >             // ç»™å­ View çš„æµ‹é‡æ¨¡å¼ä½¿ç”¨äº† MeasureSpec.EXACTLY
> >             int childHeightMeasureSpec =
> >                     MeasureSpec.makeMeasureSpec(parentSpace, MeasureSpec.EXACTLY);
> >             child.measure(childWidthMeasureSpec, childHeightMeasureSpec);
> >         }
> >     }
> > }
> > ```
> >
> > ä»Žä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼Œè®¾ç½® `mFillViewport = true` åŽ NestedScrollView ä¼šä½¿ç”¨ `MeasureSpec.EXACTLY` æ¨¡å¼å†æ¬¡æµ‹é‡å­ Viewï¼Œé«˜åº¦ä½¿ç”¨çš„æ˜¯è‡ªèº«çš„é«˜åº¦
> >
> > è€Œè‡ªèº«çš„é«˜åº¦åªæœ‰åœ¨ `match_parent` æˆ–è€… ç¡®å®šå€¼ æ—¶æ‰æœ‰ç”¨ï¼Œä¸ç„¶ï¼Œå¦‚æžœä½ çš„ `layout_height` ä¸º `wrap_content`ï¼Œé‚£ `NestedScrollView#getMeasuredHeight()` å¾—åˆ°ä»ç„¶æ˜¯ Rv å…¨éƒ¨æµ‹é‡æ—¶çš„é«˜åº¦ï¼Œæ‰€ä»¥è¿™æ—¶å†æµ‹é‡è¿˜æ˜¯ä¼šå¯¼è‡´ Rv å¤ç”¨å¤±æ•ˆ
> >
> > ä½¿ç”¨ mFillViewport å±žæ€§ï¼Œä½†éœ€è¦ NsetedScrollView çš„ **layout_height = match_parent æˆ– ç¡®å®šå€¼**
> >
> > ä½†ä¸€èˆ¬éƒ½ä¸ä¼šä½¿ç”¨åˆ°è¿™ä¸ªå±žæ€§æ¥è§£å†³ Rv å¤ç”¨å¤±æ•ˆé—®é¢˜ï¼Œè¿™é‡Œåªæ˜¯å½“ä¸ªæ‰©å±•æ¥è®²è§£
>
> ##### é—®é¢˜ï¼šå¦‚æžœç»™ Rv å¤–é¢å†åŒ…ä¸€å±‚ï¼Œé‚£å¤ç”¨è¿˜ä¼šå¤±æ•ˆå—ï¼Ÿ
>
> > ç­”æ¡ˆï¼šä»ç„¶ä¼šå¤±æ•ˆ
> >
> > é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“å¤±æ•ˆçš„å†³å®šå› ç´ æ˜¯ `mHeight == 0 && mode == MeasureSpec.UNSPECIFIED`ï¼Œè€Œ NestedScrollView åœ¨å­ View æ²¡æœ‰è®¾ç½® Margin å€¼æ—¶ç»™å­ View ä¼ å…¥çš„é«˜åº¦è‚¯å®šæ˜¯ 0
> >
> > ![image-20220321230936516](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220321230936516.png)
> >
> > è€Œ `MeasureSpec.UNSPECIFIED` æµ‹é‡æ¨¡å¼å…·æœ‰ä¼ é€’æ€§ï¼Œå‰é¢æˆ‘ä»¬æåˆ° `getChildMeasureSpec()` æ–¹æ³•ï¼ˆ[MeasureSpecs](#2ã€MeasureSpecs)ï¼‰
> >
> > ```java
> > // å¦‚æžœæµ‹é‡æ¨¡å¼æ˜¯å¯ä»»æ„å–å€¼ï¼Œå³ä¸€èˆ¬å¯¹åº”çˆ¶ View ä¸º ScrollView
> > case MeasureSpec.UNSPECIFIED:
> >     if (childDimension >= 0) {
> >         // å‡è®¾å­ View å›ºå®šä¸º 100dp
> >         resultSize = childDimension;
> >         resultMode = MeasureSpec.EXACTLY;
> >     } else if (childDimension == LayoutParams.MATCH_PARENT) {
> >         // å­ View æ˜¯ match_parent
> >         // è¿™ä¸ª sUseZeroUnspecifiedMeasureSpec å˜é‡ç”¨äºŽå…¼å®¹ Android æ—§ç‰ˆæœ¬
> >         resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;
> >         resultMode = MeasureSpec.UNSPECIFIED;
> >     } else if (childDimension == LayoutParams.WRAP_CONTENT) {
> >         // å­ View æ˜¯ wrap_content
> >         resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;
> >         resultMode = MeasureSpec.UNSPECIFIED;
> >     }
> >     break;
> > ```
> >
> > å¯ä»¥çœ‹åˆ°é™¤äº† `childDimension >= 0` å¤–å…¶ä»–æƒ…å†µæµ‹é‡æ¨¡å¼éƒ½æ˜¯ `MeasureSpec.UNSPECIFIED`ï¼Œæ‰€ä»¥ä½ ä¸­é—´å¤¹ä¸€å±‚å…¶ä»–å¸ƒå±€æ˜¯è§£å†³ä¸äº†çš„

##### 3ã€Dialog æ ¹å¸ƒå±€è®¾ç½®å®½é«˜å¤±æ•ˆ

> è¿™ä¸ªä¸œè¥¿ä¹‹å‰åœ¨å¯’å‡æœŸé—´è®²è¿‡ï¼Œä½†æ‰å‘çŽ°å½“æ—¶è®²çš„æœ‰äº›å°é—®é¢˜ï¼š
>
> - åªæœ‰ DialogFragment æ‰ä¼šä½¿å¤–å±‚å¸ƒå±€çš„æ‰€æœ‰ `layout_` å±žæ€§å¤±æ•ˆï¼Œè€Œ Dialog åˆ™**ä¸€èˆ¬**ä¸ä¼š
>
> å…¶å®žä¹Ÿä¸æ˜¯ä¸€èˆ¬ä¸ä¼šï¼Œä¸»è¦æ˜¯ DialogFragment å’Œ Dialog åœ¨ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨ä¸Šçš„ä¸åŒï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆæˆ‘æœ€å¼€å§‹ç»™é‚£ä½å­¦å¼Ÿè®²çš„<img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180055610.png" alt="image-20220322180055610" style="zoom: 50%;" />
>
> åŽŸæ¥æ˜¯æˆ‘ä»¥ä¸º dialog èƒ½è®¾ç½®ï¼Œé‚£ DialogFragment ä¹Ÿèƒ½è®¾ç½®äº†ï¼ŒåŽŸæ¥ DialogFragment è®¾ç½®æ˜¯å¤±æ•ˆçš„
>
> è¿™é‡Œç›´æŽ¥å…ˆè®²åŽŸå› ï¼š
>
> DialogFragment æ˜¯ä½¿ç”¨ `setContentView(View view)` æ¥è®¾ç½®æ ¹å¸ƒå±€çš„ï¼Œè€Œ Dialog ä¸€èˆ¬ä½¿ç”¨ `setContentView(int id)` æ¥è®¾ç½®æ ¹å¸ƒå±€ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨åº•å±‚çš„è°ƒç”¨ä¼šæœ‰äº›ä¸åŒ
>
> æˆ‘ä»¬ç›´æŽ¥ä»Ž DialogFragment å¼€å§‹ debug
>
> DialogFragment æ˜¯ä¸€ä¸ª Fragmentï¼Œé‡Œé¢å¤¹å¸¦äº†ä¸€ä¸ª dialogï¼Œæ ¹æ® Fragment å¸¸è§çš„å†™æ³•ï¼Œå…ˆç»™ `onCreateView()` æ‰“ä¸Š debug
>
> ![image-20220326185016280](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326185016280.png)
>
> debug è¿›æ¥å‘çŽ°ä¸€å †æ–¹æ³•ï¼Œä½†å¦‚æžœä¸äº†è§£è¿™äº›ä¸œè¥¿çš„è¯ï¼Œç¡®å®žå¾ˆéš¾çŸ¥é“å®ƒæŠŠè¿™ä¸ªè¿”å›žçš„ View æ‹¿æ¥å¹²äº†ä»€ä¹ˆï¼Œå…¶å®žå½“æ—¶æˆ‘åœ¨ç»™é‚£ä½å­¦å¼Ÿæ‰¾è¿™ä¸ªé—®é¢˜ç­”æ¡ˆçš„æ—¶å€™æ‰¾äº†å¾ˆä¹…ï¼Œæœ€åŽæ˜¯ä»Ž `View#setLayoutParams()` æ–¹æ³•å…¥æ‰‹ï¼Œåœ¨ä¸€å †è°ƒç”¨æ ˆä¸­å‘çŽ°äº†ç­”æ¡ˆã€‚è¿™é‡Œä¸ºäº†çœæ—¶é—´å°±ç›´æŽ¥æŒ‰æ­£å‘æµç¨‹è®²ä¸€éå§
>
> ![image-20220322180533094](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180533094.png)
>
> è¿™é‡Œå®ƒæœ‰ä¸€ä¸ª `LiveData` é€šçŸ¥è§‚å¯Ÿè€…
>
> ![image-20220322180809792](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322180809792.png)
>
> DialogFragment é‡Œé¢å¯¹å®ƒè¿›è¡Œäº†è§‚å¯Ÿï¼ŒDialogFragment æ˜¯åœ¨ `onAttach()` çš„æ—¶å€™å¼€å§‹è¿›è¡Œè§‚å¯Ÿçš„ï¼Œæ€ªä¸å¾—æˆ‘æŒ‰æ­£å¸¸æµç¨‹èµ°äº†åŠå¤©ä¹Ÿæ‰¾ä¸åˆ°é—®é¢˜ :( 
>
> è¿™é‡Œçš„è§‚å¯Ÿè€…è¢«é€šçŸ¥æ—¶è°ƒç”¨äº† `mDialog.setContentView(view)`ï¼Œç‚¹å‡»å®ƒç»§ç»­å¾€ä¸‹èµ°
>
> ![image-20220322190910124](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322190910124.png)
>
> å¯ä»¥å‘çŽ°è¿™é‡Œå®ƒç›´æŽ¥ä¼ å…¥äº†è‡ªå·±çš„ LayoutParamsï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‰€æœ‰ `layout_` å±žæ€§å…¨éƒ¨å¤±æ•ˆçš„åŽŸå› 
>
> é‚£æ™®é€šçš„ dialog ä¸ºä»€ä¹ˆä¸ä¼šå¤±æ•ˆå‘¢ï¼Ÿ
>
> ä¸»è¦åŽŸå› æ˜¯ dialog ä¸€èˆ¬æ˜¯è¿™æ ·å†™çš„ï¼š
>
> ![image-20220322191150701](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322191150701.png)
>
> <img src="https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220322191527878.png" alt="image-20220322191527878" style="zoom: 50%;" />
>
> å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº†
>
> ```java
>mLayoutInflater.inflate(layoutResID, mContentParent);
> ```
> 
> è€Œä¸æ˜¯ä½¿ç”¨çš„ `setContenView(View view)`
>
> è‡³äºŽ `LayoutInflater` ä¼šåœ¨åŽé¢è¿›è¡Œè®²è§£ï¼Œè¿™é‡Œä½ åªéœ€è¦çŸ¥é“è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•åŽï¼Œå®ƒä¼šè¯»å– xml æ–‡ä»¶ï¼Œå¹¶æŠŠ xml ä¸­å†™çš„ `layout_` å±žæ€§ä¿å­˜åœ¨ä¸€ä¸ª `LayoutParams` ä¸­ä¾›çˆ¶å¸ƒå±€ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ DialogFragment çš„ `layout_` å±žæ€§ä¸ä¼šå¤±æ•ˆçš„åŽŸå› ï¼Œå½“ç„¶ï¼Œåªæ˜¯ä¸€èˆ¬ä¸ä¼šå¤±æ•ˆï¼Œå¦‚æžœä½ éžè¦åœ¨ dialog ä¸­è°ƒç”¨ `setContentView(View view)`ï¼Œé‚£è‚¯å®šä¹Ÿæ˜¯ä¸€æ ·ä¼šå¤±æ•ˆçš„
>
> ### è§£å†³æ–¹æ¡ˆ
>
> ##### 1ã€åœ¨ DialogFragment çš„æ ¹å¸ƒå±€å¤–é¢å†åŒ…ä¸€å±‚ FrameLayout
>
> > è¿™æ ·åŒ…äº†ä¸€å±‚åŽå°±å¯ä»¥è®©ä½ è‡ªå·±çš„å¸ƒå±€çš„ `layout_` åœ¨ FrameLayout ä¸‹ç”Ÿæ•ˆï¼ŒFrameLayout çš„ `layout_width`ã€`layout_height` ä»»æ„è®¾ç½®éƒ½å¯ä»¥ï¼Œå› ä¸ºå¤±æ•ˆäº†ï¼Œä½†æˆ‘æ›´æŽ¨èè®¾ç½®æˆ `wrap_content`ï¼Œè¿™æ ·çœ‹èµ·æ¥é€»è¾‘è¦å¥½ä¸€ç‚¹
>
> ##### 2ã€é€šè¿‡ä»£ç è®¾ç½®å®½å’Œé«˜
>
> > å¯ä»¥è®¾ç½®æ ¹å¸ƒå±€çš„å®½å’Œé«˜
>>
> > ```java
> > // åªæœ‰åœ¨ onViewCreated() å›žè°ƒé‡Œè®¾ç½®æ‰æœ‰æ•ˆ
> > override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
> >     super.onViewCreated(view, savedInstanceState)
> >     // density æ˜¯ dp / px çš„è½¬æ¢çŽ‡ï¼Œæ¯”å¦‚ï¼šæˆ‘çš„æ‰‹æœºè½¬æ¢çŽ‡æ˜¯ 2.75ï¼Œåˆ™ 1dp å¯¹åº” 2.75px
> >     val density = requireContext().resources.displayMetrics.density
> >     val lp = view.layoutParams
> >     lp.width = (density * 400).toInt()
> >     lp.height = (density * 300).toInt()
> >     // è¿™é‡Œåªæ˜¯ä¿®æ”¹äº†å®½å’Œé«˜ï¼Œå› ä¸º View è¿˜æ²¡æœ‰è¢«æµ‹é‡å¸ƒå±€
> >     // æ‰€ä»¥å¯ä»¥ä¸ç”¨è°ƒç”¨ view.layoutParams = lp æ¥åˆ·æ–°ï¼Œåœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨æ—¶æ˜¯è¦é€šè¿‡è¿™ç§æ–¹å¼æ‰èƒ½åˆ·æ–°çš„ï¼
> > }
> > ```
> >
> > ä¹Ÿå¯ä»¥è®¾ç½® window çš„å®½å’Œé«˜
> >
> > ```java
> > // åªæœ‰åœ¨ onViewCreated() å›žè°ƒé‡Œè®¾ç½®æ‰æœ‰æ•ˆ
> > override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
> >     super.onViewCreated(view, savedInstanceState)
> >     // density æ˜¯ dp / px çš„è½¬æ¢çŽ‡ï¼Œæ¯”å¦‚ï¼šæˆ‘çš„æ‰‹æœºè½¬æ¢çŽ‡æ˜¯ 2.75ï¼Œåˆ™ 1dp å¯¹åº” 2.75px
> >     val density = requireContext().resources.displayMetrics.density
> >     dialog?.window?.setLayout(
> >         (density * 400).toInt(),
> >         (density * 300).toInt()
> >     )
> > }
> > ```
> >
> > è¿™ä¸ª window å…¶å®žæ˜¯ Android é‡Œçš„ `PhoneWindow`ï¼Œå¬åå­—å°±çŸ¥é“æ˜¯ä¸€ä¸ªç®¡ç†æ‰‹æœºçª—å£çš„ç±»ï¼Œè°ƒç”¨è¿™ä¸ª `setLayout()` æœ€åŽä¼šé‡æ–°ç»™ `DectorView` è®¾ç½® `LayoutParams`ï¼Œ`DectorView` æ˜¯æ‰€æœ‰çª—å£çš„æ ¹å¸ƒå±€
> 
> ä¸Šé¢ä¸¤ç§è§£å†³æ–¹æ³•æˆ‘æ›´æŽ¨èä½¿ç”¨ç¬¬ä¸€ç§ï¼Œå› ä¸ºåœ¨ xml ä¸­å®šä¹‰å±žæ€§æ›´å¥½ä¿®æ”¹ï¼Œä¸ç„¶åœ¨ä»£ç ä¸­ä¿®æ”¹å®½å’Œé«˜ï¼Œä¼šç»™ä»¥åŽçœ‹ä»£ç çš„äººå¸¦æ¥ç–‘æƒ‘
>
> ##### 
>
> OKï¼Œ`onMeasure()` åŸºæœ¬ä¸Šå°±è®²åˆ°è¿™é‡Œäº†
>
> 

### 8ã€onLayout()

> ### ä½œç”¨
>
> å¸ƒå±€å­æŽ§ä»¶
>
> ### æ¶‰åŠçŸ¥è¯†
>
> - `measureWidth` ä¸Ž `meaasureHeigth`
>
> ```kotlin
> /**
> * ä¸Žä¸Šé¢è®²çš„ onDraw() ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå›žè°ƒï¼Œè¯¥å›žè°ƒçš„ä½œç”¨æ˜¯ç”± requestLayout() è§¦å‘
> * @param changed ä¸Žä¸Šæ¬¡å¸ƒå±€ç›¸æ¯”ï¼Œæ˜¯å¦å‘ç”Ÿæ”¹å˜
> */
> override fun onLayout(                                
>     changed: Boolean,                                 
>     left: Int, top: Int, right: Int, bottom: Int      
> ) {                                                   
>     super.onLayout(changed, left, top, right, bottom) 
> }                                                     
> ```
>
> ### ä¸»è¦ç”¨æ³•
>
> - éåŽ†å­ Viewï¼Œå†è°ƒç”¨ `child.layout()`ï¼Œæ‘†æ”¾å­ View
>
> - ä¸€èˆ¬æ˜¯ ViewGroup å®žçŽ°
>
>   ä¹‹å‰æåˆ°äº† `TextView` ä½œä¸º View å´é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œå…¶å®žå®ƒæ²¡æœ‰å¹²ä»€ä¹ˆï¼Œä¸»è¦æ˜¯é‡æ–°è®¾ç½®äº†æ–‡å­—çš„ä½ç½®å’Œå¤§å°
>
>   ä¸ºä»€ä¹ˆéœ€è¦åœ¨è¿™é‡Œé‡å†™è®¾ç½®å‘¢ï¼Ÿ
>
>   åŽŸå› ï¼š`onLayout()` èƒ½æ‹¿åˆ°æœ€ç»ˆæ˜¾ç¤ºçš„å®½åº¦å’Œé«˜åº¦ï¼Œä¸”ä¸€èˆ¬æƒ…å†µä¸‹åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥åœ¨æœ‰ç‰¹æ®Šéœ€è¦æ—¶å¯ä»¥åœ¨è¿™é‡Œé¢æ¥è®¾ç½®ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼šä¸€äº›ç‰¹æ®Šçš„è‡ªå®šä¹‰ ViewGroup å§‹ç»ˆæ˜¯å›ºå®šçš„å¤§å°ï¼Œåˆ™å¯ä»¥ä¸ç”¨é‡å†™ `onMeasure()`ï¼Œè€Œæ˜¯åœ¨ `onLayout()` ä¸­ç›´æŽ¥ç»™å­ View è°ƒç”¨ `measure()`ã€`layout()` å¸ƒå±€
>
> ```mermaid
> graph LR
> id1("ViewRootImpl å¼€å§‹å¸ƒå±€")-->id2
> id2["ViewGroup#layout()"]-->id3
> id3["ViewGroup#onLayout()"]-->id4
> id4["View#layout()"]-->id5("View#onLayout()")
> ```
>
> 

#### 1ã€measureWidth (measureHeight) ä¸Ž width (height)

> `measureWidth` ä»£è¡¨æµ‹é‡çš„å®½åº¦ï¼Œå…¶å®žå°±æ˜¯ `onMeasure()` ä¸­è°ƒç”¨ `setMeasuredDimension()` è®¾ç½®çš„å®½åº¦
>
> `width` ä»£è¡¨å¸ƒå±€åŽçš„å®½åº¦ï¼Œæ˜¯ç”± `layout()` ä¸­æ‘†æ”¾åŽé€šè¿‡ `right - left` å¾—åˆ°çš„
>
> ä¸€èˆ¬ `measureWidth` åªç”¨äºŽ `layout()` å’Œ `onLayout()` ä¸­ï¼Œå…¶ä»–åœ°æ–¹ä¸åº”è¯¥ä½¿ç”¨å®ƒ

#### 2ã€FrameLayout çš„ onLayout() æºç åˆ†æž

> ```java
> @Override
> protected void onLayout(boolean changed, int left, int top, int right, int bottom) {
>     layoutChildren(left, top, right, bottom, false /* no force left gravity */);
> }
> void layoutChildren(int left, int top, int right, int bottom, boolean forceLeftGravity) {
>     final int count = getChildCount();
>     // è®¡ç®—å­ View èƒ½ç»˜åˆ¶çš„è¾¹ç•Œ
>     final int parentLeft = getPaddingLeftWithForeground();
>     final int parentRight = right - left - getPaddingRightWithForeground();
>     final int parentTop = getPaddingTopWithForeground();
>     final int parentBottom = bottom - top - getPaddingBottomWithForeground();
>     for (int i = 0; i < count; i++) {
>         final View child = getChildAt(i);
>         // å­ View ä¸º Gone æ—¶ä¸å¸ƒå±€ï¼Œåœ¨è‡ªå·±è®¾è®¡è‡ªå®šä¹‰ View æ—¶å»ºè®®ä¹Ÿè¿›è¡Œåˆ¤æ–­
>         if (child.getVisibility() != GONE) {
>             // å–å‡ºå­ View èº«ä¸Šçš„ LayoutParams
>             final LayoutParams lp = (LayoutParams) child.getLayoutParams();
>             // å¾—åˆ°ä¹‹å‰æµ‹é‡çš„å®½å’Œé«˜
>             final int width = child.getMeasuredWidth();
>             final int height = child.getMeasuredHeight();
>             int childLeft;
>             int childTop;
>             // å‰é¢æåˆ°çš„ FrameLayout#LayoutParams
>             int gravity = lp.gravity;
>             if (gravity == -1) {
>                 gravity = DEFAULT_CHILD_GRAVITY;
>             }
>             final int layoutDirection = getLayoutDirection();
>             final int absoluteGravity = Gravity.getAbsoluteGravity(gravity, layoutDirection);
>             final int verticalGravity = gravity & Gravity.VERTICAL_GRAVITY_MASK;
>             // ä¸‹é¢æ˜¯æ ¹æ®ä¸åŒçš„ gravity æ¥å¸ƒå±€ï¼Œå°±æ˜¯ä¸€äº›ç®€å•çš„è®¡ç®—
>             switch (absoluteGravity & Gravity.HORIZONTAL_GRAVITY_MASK) {
>                 case Gravity.CENTER_HORIZONTAL:
>                     childLeft = parentLeft + (parentRight - parentLeft - width) / 2 +
>                     lp.leftMargin - lp.rightMargin;
>                     break;
>                 case Gravity.RIGHT:
>                     if (!forceLeftGravity) {
>                         childLeft = parentRight - width - lp.rightMargin;
>                         break;
>                     }
>                 case Gravity.LEFT:
>                 default:
>                     childLeft = parentLeft + lp.leftMargin;
>             }
>             switch (verticalGravity) {
>                 case Gravity.TOP:
>                     childTop = parentTop + lp.topMargin;
>                     break;
>                 case Gravity.CENTER_VERTICAL:
>                     childTop = parentTop + (parentBottom - parentTop - height) / 2 +
>                     lp.topMargin - lp.bottomMargin;
>                     break;
>                 case Gravity.BOTTOM:
>                     childTop = parentBottom - height - lp.bottomMargin;
>                     break;
>                 default:
>                     childTop = parentTop + lp.topMargin;
>             }
>             // æœ€åŽè°ƒç”¨ child.layout()
>             child.layout(childLeft, childTop, childLeft + width, childTop + height);
>         }
>     }
> }
> ```

### 9ã€requestLayout()

> è¿™ä¸œè¥¿è·Ÿå‰é¢çš„ `invalidate()` ä¸€æ ·ï¼Œä½ ä»¬åªéœ€è¦è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š
>
> - è°ƒç”¨åŽä¼šåœ¨ä¸‹ä¸€å¸§å›žè°ƒ `onMeasure()` å’Œ `onMeasure()` è¿›è¡Œé‡æ–°æµ‹é‡å’Œå¸ƒå±€
> - å¦‚æžœä½ çš„ View å¤§å°å‘ç”Ÿæ”¹å˜ï¼Œå®ƒè¿˜ä¼šè°ƒç”¨ `onDraw()` è¿›è¡Œåˆ·æ–°
>
> æ–‡ç« çš„è¯ï¼Œä¸Ž `invalidate()` çš„ä¸€æ ·ï¼šhttps://juejin.cn/post/7017452765672636446
>
> ```mermaid
> graph TB
> id1("View")-->id2
> id2["è°ƒç”¨requestLayout()é‡æ–°å¸ƒå±€"]-->id3
> id3{"parent == null"}--ä¸ä¸º null-->id4
> id4["å‘Šè¯‰çˆ¶å¸ƒå±€æœ‰å­å¸ƒå±€è¦é‡å¸ƒå±€"]-->id3--ä¸º null-->id5
> id5["ä¼ é€’åˆ°äº† ViewRootImpl (ä¸€ä¸ªç®¡ç†å¸ƒå±€çš„ç±»)"]-->id6
> id6["ViewRootImpl è°ƒç”¨ mChoreographer å‘é€ä¸€ä¸ª post (ä¸€ä¸ªä¸“é—¨ç›‘å¬å±å¹•åˆ·æ–°çš„ç±»)"]-.->id7
> id7["å±å¹•åˆ·æ–°äº†ï¼Œå›žè°ƒ ViewRootImplï¼Œå¼€å§‹é‡æ–°èµ° View æµ‹é‡å’Œå¸ƒå±€æµç¨‹"]-->id8
> id8("ä»Žé¡¶éƒ¨å¸ƒå±€æœ€åŽå›žè°ƒåˆ° View çš„ onMeasure()ã€onLayout()")-->id9
> id9{"å¦‚æžœå®½é«˜æ”¹å˜"}--true-->id10("è°ƒç”¨ onDraw() å›žè°ƒ")-->id11
> id9--false-->id11("ç»“æŸ")
> ```
>
> 



### 10ã€setContentView

> debug èµ°èµ·ï¼Œæœ€åŽå‘çŽ°å®ƒè°ƒç”¨äº†
>
> ![image-20220323223301814](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323223301814.png)
>
> æ·»åŠ å¸ƒå±€ç›´æŽ¥äº¤ç»™äº† `LayoutInflater` å¤„ç†ï¼Œé‚£æˆ‘ä»¬è®²è§£ä¸€ä¸‹ `LayoutInflater`

#### 1ã€LayoutInflater

> `LayoutInflater` æˆ‘ä»¬å¸¸ç”¨çš„å°±ä¸‹é¢è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•
>
> ```java
> public View inflate(@LayoutRes int resource, @Nullable ViewGroup root) {
>     // å¯ä»¥çœ‹åˆ°å®ƒç›´æŽ¥è°ƒç”¨äº†ä¸‹é¢é‚£ä¸ªä¸‰ä¸ªå‚æ•°çš„
> 	return inflate(resource, root, root != null);
> }
> 
> /**
>  * @param resource å¸ƒå±€ id
>  * @param root çˆ¶å¸ƒå±€
>  * @param attachToRoot æ˜¯å¦ç›´æŽ¥æ·»åŠ åˆ°çˆ¶å¸ƒå±€ï¼Œå¦‚æžœä¸º trueï¼Œåœ¨è§£æžå‡º View åŽä¼šç›´æŽ¥æ·»åŠ åˆ° root ä¸­
>  * @return å¦‚æžœ attachToRoot ä¸º trueï¼Œè¿™è¿”å›ž rootï¼Œå¦‚æžœä¸º falseï¼Œåˆ™è¿”å›ž xml ä¸­çš„æ ¹å¸ƒå±€
>  */
> public View inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot) {}
> ```
>
> ç»§ç»­å¾€é‡Œé¢èµ°ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„ä»£ç åœ¨è¿™é‡Œï¼š
>
> ![image-20220323224318637](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323224318637.png)
>
> ä¸Šé¢é‚£ä¸ªå°±æ˜¯ä¹‹å‰ç•™ä¸‹çš„é—®é¢˜ï¼ˆ[LayoutParams](#1ã€LayoutParams)ï¼‰ï¼Œåœ¨ `root != null` é€šè¿‡ `AttributeSet` å¾—åˆ°ä½ è‡ªå·±çš„ `LayoutParmas`ï¼Œç„¶åŽåœ¨ `!attchToRoot` æ—¶è°ƒç”¨ `setLayoutParams()`ï¼Œé‡Œé¢ä¼šè°ƒç”¨ `requestLayout()`è¿›è¡Œé‡æ–°å¸ƒå±€
>
> ç»§ç»­å¾€ä¸‹é¢çœ‹ï¼š
>
> ![image-20220323230405944](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323230405944.png)
>
> è¿™é‡Œåœ¨ `root != null && attachToRoot` æ—¶è°ƒç”¨ `root.addView()`ï¼Œè¿™å°±æ˜¯ä½¿ç”¨ `attachToRoot` çš„æ—¶å€™
>
> ç„¶åŽåœ¨ `addView()` é‡Œé¢å°±è°ƒç”¨äº†ä¹‹å‰é‡å†™çš„é‚£ä¸¤ä¸ªæ–¹æ³•ï¼š
>
> ![image-20220323230713647](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323230713647.png)
>
> è¿™å°±æ˜¯ `LayoutInflater` çš„ç®€å•åˆ†æžäº†
>
> ä¹‹å‰æœ‰å­¦å¼Ÿé—®é“ `LayoutInflater#inflate()` ä¸Ž `View#inflate()` çš„åŒºåˆ«ï¼ŒæŸ¥çœ‹æºç ä½ å°±ä¼šå‘çŽ°å…¶å®ž `View#inflate()` å°±æ˜¯è°ƒç”¨çš„ `LayoutInflater#inflate()`
>
> ![image-20220323231300755](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323231300755.png)
>
> è¿˜æœ‰å­¦å¼Ÿé—®è¿‡ä¸ºä»€ä¹ˆ Rv çš„ `onCreateView()` ä½¿ç”¨åƒä¸‹é¢è¿™æ ·å†™ä¸è¡Œ
>
> ```java
> // å…¶å®žè¿™ä¸ª parent å°±æ˜¯ Rv
> override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MyViewHolder {
>     return MyViewHolder(
>         // è¿™ç§å†™æ³•å°±æ˜¯ä¸‹é¢è¿™ç§å†™æ³•
>         View.inflate(parent.context, R.layout.recycler_item, parent)
>     )
> }
> 
> override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MyViewHolder {
>     return MyViewHolder(
>         LayoutInflater.from(parent.context).inflate(R.layout.recycler_item, parent, true)
>     )
> }
> 
> // ä¸Šé¢è¿™ä¸¤ç§å†™æ³•ä½¿ç”¨åŽä¼šæŠ¥é”™ï¼š
> // java.lang.IllegalStateException: 
> // ViewHolder views must not be attached when created. 
> // Ensure that you are not passing 'true' to the attachToRoot parameter 
> // of LayoutInflater.inflate(..., boolean attachToRoot)
> // æ„æ€å°±æ˜¯åªèƒ½åœ¨ ViewHolder å¼€å§‹ä½¿ç”¨æ—¶æ‰èƒ½æŠŠ View æ·»åŠ åˆ° parent ä¸­åŽ»
> ```
>
> å¯èƒ½éƒ¨åˆ†æœ‰äººè¿™æ ·å†™è¿‡ï¼Œå‘çŽ° item çš„å¸ƒå±€æ— æ³•è®¾ç½®å¤§å°ï¼Œè¿™ä¸ªé—®é¢˜è·Ÿå‰é¢è®²åˆ°çš„ dialog æ ¹å¸ƒå±€å®½é«˜å¤±æ•ˆæœ‰ç‚¹ç±»ä¼¼
>
> ```java
> override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MyViewHolder {
>     return MyViewHolder(
>         // ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ null
>         LayoutInflater.from(parent.context).inflate(R.layout.recycler_item, null)
>     )
> }
> ```
>
> ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ null æ—¶ï¼ŒæŒ‰ç…§å‰é¢åˆ†æžçš„æµç¨‹ï¼Œå°±ä¸ä¼šç»™æ ¹å¸ƒå±€è®¾ç½® `LayoutParams`ï¼Œé‚£ä¹ˆåœ¨ Rv `addView()`æ—¶ï¼Œä¼šè°ƒç”¨ Rv çš„ `generateDefaultLayoutParams()` ï¼Œæœ€åŽè°ƒç”¨åˆ° `LayoutManger` çš„ `generateDefaultLayoutParams()`
>
> ![image-20220323234144858](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323234144858.png)
>
> å¦‚æžœæ˜¯ `LinearLayoutManger`ï¼Œå°±ç›´æŽ¥è®¾ç½®æˆ `wrap_content` äº†ï¼Œæ‰€ä»¥åœ¨ xml ä¸­å†™çš„å®½å’Œé«˜æ ¹æœ¬å°±æ²¡æœ‰åŽ»è¯»å–
>
> ![image-20220323234305639](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220323234305639.png)

### 11ã€å‘å¸ƒå¼€æºåº“

#### 1ã€åˆ›å»ºæ¨¡å—

> å¤§åž‹é¡¹ç›®éƒ½ä¼šé‡‡ç”¨å¤šæ¨¡å—å¼€å‘ï¼Œæ¯ä¸ªäººåªéœ€è¦è´Ÿè´£è‡ªå·±çš„æ¨¡å—ï¼Œæ¨¡å—æ–¹é¢çš„çŸ¥è¯†æˆ‘å°±ä¸è®²è§£äº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯è®²è§£å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰ View çš„æ¨¡å—
>
> é¦–å…ˆ new ä¸€ä¸ªæ¨¡å—
>
> ![image-20220325141248013](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325141248013.png)
>
> ç„¶åŽé€‰ç€å¯¹åº”çš„æ¨¡å—
>
> ![image-20220325141438062](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325141438062.png)
>
> > è¿™é‡Œç®€å•è®²ä¸€ä¸‹ï¼š
> >
> > ç¬¬ä¸€ä¸ª `Phone & Tablet` ä¹Ÿæ˜¯åˆ›å»ºæ¨¡å—ï¼Œå…¶å®žä¸Žè¿™ä¸ª `Android Library` ä¸»è¦æ˜¯åœ¨ `build.gradle` ä¸Šçš„ç»†å¾®ä¸åŒ
> >
> > ##### 1ã€Phone & Tablet
> >
> > ```groovy
> > plugins {
> >     id 'com.android.application'
> > }
> > 
> > android {
> >     defaultConfig {
> >     	applicationId "com.ndhzs.myapplication"
> >     	minSdk 21
> > 		targetSdk 31
> >     	versionCode 1
> > 	    versionName "1.0"
> >     }
> > }
> > ```
> >
> > ##### 2ã€Android Library
> >
> > ```groovy
> > plugins {
> >     id 'com.android.library'
> > }
> > 
> > android {
> >     defaultConfig {
> >     	minSdk 21
> > 		targetSdk 31
> >     }
> > }
> > ```
> >
> > ä¸åŒä¹‹å¤„ä¸»è¦å°±æ˜¯ä¸Šé¢ä¸¤å¤„ï¼Œå…¶ä»–è¿˜æœ‰ `AndroidManifest.xml` éƒ½æ˜¯å·®ä¸å¤šçš„
>
> åˆ›å»ºå¥½çš„æ¨¡å—ä¼šå°‘ res æ–‡ä»¶å¤¹ï¼Œè‡ªå·±æ–°å»ºå³å¯ï¼Œå…¶ä»–åœ°æ–¹ç”¨æ³•å°±è·Ÿå¹³å¸¸å†™æ³•éƒ½ä¸€æ ·
>
> åœ¨ä½ çš„ app æ¨¡å—ä¸­ä½¿ç”¨ä¸‹é¢è¿™ç§å†™æ³•å°±å¯ä»¥åˆšå»ºçš„æ¨¡å—
>
> ```groovy
> dependencies {
> 	implementation project(':lib')
> }
> ```
>
> æ¨¡å—ä¸‹ä¹Ÿæ˜¯å…è®¸å†å»ºå­æ¨¡å—çš„ï¼Œæ¨¡å—åŒ–éœ€è¦å­¦ä¹  gradle ç›¸å…³çš„çŸ¥è¯†ï¼Œç­‰ä½ ä»¬è¿›æ¥æŽ¥æ‰‹æŽŒé‚®äº†å¤šçœ‹å‡ ä¸ªæ¨¡å—å°±æ— å¸ˆè‡ªé€šäº†ï¼ˆé€æ¼ä¸€ä¸‹æ–°æ¶ˆæ¯ï¼Œç›®å‰å¼ºç¥žè¿˜åœ¨æ›´æ–°æ•´ä¸ªæŽŒé‚®çš„ gradleï¼Œå·²ç»é‡æž„ä¸º kts äº†ï¼Œä¼°è®¡ç­‰ä½ ä»¬è¿›æ¥å°±å¯ä»¥ä½“éªŒåç¨‹äº†ï¼‰

#### 2ã€å‘å¸ƒåˆ° jitPack

> å¾ˆå¤šæ—¶å€™å‘å¸ƒåˆ°å¼€æºåº“æ–¹ä¾¿æˆ‘ä»¬åœ¨å…¶ä»–é¡¹ç›®ä¸­å¼•ç”¨ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬å°†è®²è§£å¦‚ä½•å‘å¸ƒåˆ° `jitPack`ï¼Œä¸ºä»€ä¹ˆä¸å‘å¸ƒåˆ° `Maven Central`ï¼Œå› ä¸º `Maven Central` è¦ç”³è¯·æ–‡ä»¶ï¼Œå¾ˆéº»çƒ¦ï¼Œè€Œ `jitPack` ç›´æŽ¥å‚»ç“œå¼æ“ä½œä¸€æ­¥åˆ°ä½
>
> ```groovy
> // åœ¨ lib çš„ build.gradle ä¸­
> plugins {
> 	id 'maven-publish'
> }
> 
> android {
> 	publishing {
> 		singleVariant "release"
> 	}
> }
> 
> afterEvaluate {
> 	publishing {
> 		publications {
> 			release(MavenPublication) {
> 				from components.release
> 			}
> 		}
> 	}
> }
> ```
>
> **æ³¨æ„æ˜¯åœ¨ lib çš„ build.gradle ä¸­ï¼Œä¸æ˜¯åœ¨ app çš„ build.gradle**
>
> > **è¿™é‡Œæ˜¯åŽŸå› çš„è®²è§£ï¼Œä¸æƒ³çœ‹çš„è¯å¯ä»¥è·³è¿‡**
> >
> > è¿™æ˜¯æˆ‘æ‘¸ç´¢å‡ºæ¥çš„**æœ€æ–°æ•™ç¨‹**ï¼Œå¦‚æžœä½ åŽ»é‚£äº›çœ‹é‚£äº›åšå®¢ï¼Œå…¨æ˜¯è¿‡æ—¶æ•™ç¨‹ï¼Œè¿™é‡Œç»™å‡ºæ‘¸ç´¢çš„è¿‡ç¨‹ï¼š
> >
> > - å‘å¸ƒå¼€æºåº“çš„æ•™ç¨‹å…ˆæ ¹æ® `jitPack` å®˜ç½‘æ¥ï¼šhttps://docs.jitpack.io/android/
> >
> > - ç„¶åŽçœ‹å®ƒå®˜ç½‘ç»™å‡ºçš„æºç ç¤ºä¾‹ï¼šhttps://github.com/jitpack/android-example/blob/master/library/build.gradle
> >
> > - å†å‚è€ƒè°·æ­Œç»™çš„ç¤ºä¾‹ï¼šhttps://developer.android.google.cn/studio/build/maven-publish-plugin
> >
> > - æœ€åŽçœ‹çœ‹ gradle å®˜ç½‘æ¯ä¸ªæ–¹æ³•çš„æ„æ€ï¼š
> >
> >   https://docs.gradle.org/current/userguide/publishing_maven.html#publishing_maven:tasks
> >
> >   https://docs.gradle.org/current/dsl/org.gradle.api.publish.maven.MavenPublication.html#org.gradle.api.publish.maven.MavenPublication
> >
> > 
> >
> > è¿™æ ·åŸºæœ¬ä¸Šèƒ½å®žçŽ°äº†ï¼Œä½†åœ¨æ‰“åŒ…æ—¶ä¼šæŠ¥ä¸€ä¸ªè­¦å‘Šï¼š
> >
> > ```
> > WARNING:Software Components will not be created automatically for Maven publishing from Android Gradle Plugin 8.0. To opt-in to the future behavior, set the Gradle property 
> > ```
> >
> > æœ€åŽä¸Š stackoverflow å¯»æ‰¾ï¼ˆå› ä¸ºå…¶ä»–åœ°æ–¹æ‰¾ä¸åˆ°ï¼‰ï¼š
> >
> > https://stackoverflow.com/questions/71365373/software-components-will-not-be-created-automatically-for-maven-publishing-from
> >
> > æœ€æœ€åŽåœ¨è°·æ­Œæ‰¾åˆ°æ–¹æ³•ï¼š
> >
> > https://developer.android.google.cn/studio/publish-library/configure-pub-variants
> >
> > https://developer.android.google.cn/reference/tools/gradle-api/7.1/com/android/build/api/dsl/LibraryPublishing
> >
> > è¿™é‡Œç®€å•è®²ä¸€ä¸‹ï¼š
> >
> > ```groovy
> > android {
> > 	publishing {
> >          // è¿™ä¸ªæ˜¯ä¼šè‡ªåŠ¨åˆ›å»ºä¸‹é¢ publications ä¸­çš„åŒåæ–¹æ³•
> > 		singleVariant "release"
> > 
> >          // æ¯”å¦‚è¿™ä¸ªå°±æ˜¯ä¸‹é¢é‚£ä¸ª myRelease(MavenPublication)
> >          // singleVariant "myRelease"
> > 	}
> > 
> >     // è¿™æ˜¯å®˜æ–¹é»˜è®¤è‡ªå¸¦çš„ä¸œè¥¿ï¼Œå°±ä¸Žå¯¹ä¸åŒçš„åŒ…å®šä¹‰ä¸åŒçš„è®¾ç½®
> >     buildTypes {
> >         release {
> >         }
> >     }
> > }
> > 
> > afterEvaluate {
> > 	publishing {
> > 		publications {
> > 			release(MavenPublication) {
> >                  // è¿™ä¸ª components.release ä¸­çš„ release æ˜¯ buildTypes ä¸­çš„ release
> > 				from components.release
> > 			}
> > 
> >              // è¿™é‡Œè¿™ä¸ª myRelease å°±å¯¹åº”äºŽä¸Šé¢å†™çš„é‚£ä¸ª singleVariant "myRelease"
> >              // myRelease(MavenPublication) {
> > 			//     from components.release
> > 			// }
> > 		}
> > 	}
> > }
> > ```
> >
> > å¦‚æžœå®žåœ¨çœ‹ä¸æ‡‚çš„è¯å°±ç›´æŽ¥æŒ‰ç…§åˆšå¼€å§‹ç»™å‡ºçš„æŠ„ä¸ŠåŽ»å³å¯ï¼Œæ¯•ç«Ÿçœ‹æ‡‚éœ€è¦æœ‰ä¸€å®šçš„ gradle åŸºç¡€
>
> ç„¶åŽåœ¨ github ä¸Šå‘ä¸€ä¸ª Releases
>
> ![image-20220325133455931](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325133455931.png)
>
> Release å‘å¸ƒå¥½äº†åŽï¼Œæ‰“å¼€ `jitPack` 
>
> ![image-20220325133728477](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325133728477.png)
>
> è¿™æ ·ä¸€ä¸ªæ­£å¼åŒ…å°±æˆåŠŸå‘å¸ƒå‡ºåŽ»äº†ï¼Œå¼•å…¥çš„è¯ä¸‹é¢æœ‰æ•™ç¨‹
>
> ![image-20220325134213260](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325134213260.png)
>
> > å°æ’æ›²ï¼šç”±äºŽ gradle åˆ° 7.0.0 ç‰ˆæœ¬ä»¥åŽï¼Œå¼•å…¥æ”¹ä½ç½®äº†
> >
> > ```groovy
> > // åœ¨ settings.gradle é‡Œ
> > dependencyResolutionManagement {
> >  repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
> >  repositories {
> >      google()
> >      mavenCentral()
> >      maven { url = "https://jitpack.io" }
> >  }
> > }
> > ```
>
> å¦‚æžœæ˜¯è‡ªå·±å¹³æ—¶å¼€å‘ä¸­ç”¨åˆ°ï¼Œæ¯æ¬¡éƒ½å‘ Releases æ˜¾å¾—è¿‡äºŽéº»çƒ¦ï¼Œ`jitPack` å¯ä»¥å‘å¸ƒå¿«ç…§ç‰ˆæœ¬ï¼Œä½•ä¸ºå¿«ç…§ï¼Œçœ‹å®Œä¸‹é¢çš„æ•™ç¨‹ä½ å°±æ‡‚äº†
>
> ![image-20220325135853586](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325135853586.png)
>
> ä½ ä¼šå‘çŽ°ä¸‹é¢ç»™å‡ºçš„å¼•å…¥å†™æ³•æ²¡æœ‰å¸¦ç‰ˆæœ¬å·
>
> ![image-20220325135808864](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325135808864.png)
>
> è¿™ä¸ª `SNAPSHOP` å°±æ˜¯å¿«ç…§çš„æ ‡è¯†ï¼Œå¸¦æœ‰å¿«ç…§çš„ç‰ˆæœ¬å·åœ¨ build æ—¶ä¼šè‡ªåŠ¨åŽ»æ£€æŸ¥æ˜¯å¦æ˜¯æœ€æ–°ç‰ˆï¼Œä»¥åŽåªéœ€è¦æäº¤åˆ° main åˆ†æ”¯ï¼Œç„¶åŽå‘ä¸ªå¿«ç…§ç‰ˆæœ¬å°±å¯ä»¥å‡çº§äº†
>
> åªæœ‰è‡ªå·±ä½¿ç”¨æ—¶æ›´æŽ¨èå‘å¸ƒå¿«ç…§

#### 3ã€å‘å¸ƒåˆ°é˜¿é‡Œçš„ Maven

> å°±åœ¨è¦ä¸Šè¯¾çš„æ˜¨å¤©ï¼Œè‰¾ç¥žæ¥é—®æˆ‘æ€Žä¹ˆå‘å¸ƒé˜¿é‡Œçš„ Mavenï¼Œä»–æŽ‰è¿›å‘é‡Œå¡äº†ä¸€ä¸ªæ™šä¸Šï¼ŒäºŽæ˜¯æˆ‘åŽ»è¯•ç€è§£å†³äº†ä¸€ä¸‹
>
> æžœç„¶å¤Ÿå‘çš„ï¼Œå› ä¸º gradle å‡åˆ° 7.0.0 ä»¥åŽæŠŠä¸€ä¸ªæ’ä»¶ç»™ç§»é™¤äº†ï¼Œè€Œé˜¿é‡Œå®˜ç½‘å’Œå…¶ä»–æ•™ç¨‹éƒ½æ˜¯è¿‡æ—¶çš„ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´æ‰æžå‡ºæ¥ï¼Œè¿™é‡Œå°±ç›´æŽ¥ç»™æœ€æ–°çš„æ“ä½œæ•™ç¨‹
>
> é¦–å…ˆï¼ŒåŽ»é˜¿é‡Œå®˜ç½‘æ³¨å†Œä¸€ä¸‹ï¼ˆå¥½åƒæ˜¯å…è´¹çš„ï¼‰ï¼šhttps://packages.aliyun.com/maven
>
> æ³¨å†Œè¿‡åŽï¼Œä»–ä¼šç»™ä½ ä¸¤ä¸ªä»“åº“ï¼š
>
> ![image-20220326231305660](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326231305660.png)
>
> ä¸€ä¸ªæ˜¯ç”¨äºŽå‘å¸ƒç¨³å®šç‰ˆçš„åº“ï¼Œä¸€ä¸ªæ˜¯å‘å¸ƒå¿«ç…§ç‰ˆçš„åº“ï¼Œä¸Šé¢ `jitPack` ä¸­ä¹Ÿä»‹ç»äº†å¿«ç…§
>
> ç„¶åŽæ‰¾åˆ°è¿™ä¸ªæŒ‡å—ç•Œé¢
>
> ![image-20220326231921252](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326231921252.png)
>
> è¿™é‡Œé¢æœ‰ä¸€äº›åŸºç¡€è®¾ç½®ï¼Œä½†è¿™æ•™ç¨‹è¿‡æ—¶äº†ï¼Œä¸‹é¢æˆ‘ç»™å‡ºæœ€æ–°çš„å†™æ³•ï¼š
>
> ```groovy
> // settings.gradle
> dependencyResolutionManagement {
>     repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
>     repositories {
>         google()
>         mavenCentral()
>         // è¿™é‡Œæ·»åŠ é˜¿é‡Œ maven çš„ä»“åº“åœ°å€
>         maven {
>             url 'https://maven.aliyun.com/repository/public'
>         }
>     }
> }
> ```
>
> ```groovy
> // è¿™æ˜¯å•ç‹¬å†™çš„ä¸€ä¸ª maven.gradle
> 
> // gradle 7ä¹‹å‰ä½¿ç”¨çš„ maven æ’ä»¶ï¼Œ7ä¹‹åŽåªèƒ½ä½¿ç”¨ maven-publish äº†
> apply plugin: 'maven-publish'
> // è¿™ä¸ªæ˜¯å¼•ç”¨æˆ‘çš„å¯†ç ç­‰ç§å¯†æ–‡ä»¶ï¼Œå»ºè®®æŠŠè¿™äº›å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œå¹¶åœ¨.gitignoreä¸Šæ·»åŠ å®ƒ
> apply from: "${rootDir}/secret.gradle"
> 
> afterEvaluate {
>     publishing {
>         publications {
>             release(MavenPublication) {
>                 from components.release
>                 // ç‰ˆæœ¬å·ï¼Œå¦‚æžœæœ«å°¾åŠ ä¸Š -SNAPSHOT è¯´æ˜Žæ˜¯å¿«ç…§ç‰ˆæœ¬
>                 version = '0.0.1-SNAPSHOT'
>                 // é¡¹ç›®åç§°ï¼Œé€šå¸¸ä¸ºç±»åº“æ¨¡å—åç§°ï¼Œä¹Ÿå¯ä»¥ä»»æ„è®¾ç½®
>                 artifactId = 'example'
>                 // å”¯ä¸€æ ‡è¯†ï¼Œé€šå¸¸ä¸ºæ¨¡å—åŒ…åï¼Œä¹Ÿå¯ä»¥ä»»æ„è®¾ç½®
>                 groupId = 'com.985892345'
>             }
>         }
> 
>         // è¿™ä¸‹é¢çš„ aliMavenUsernameã€aliMavenPasswordã€releaseUrlã€snapshotUrl
>         // å¯¹åº”ä½ è‡ªå·±çš„ï¼Œåœ¨é˜¿é‡Œå®˜ç½‘é‚£ä¸ªæŒ‡å—é‡Œæœ‰
>         repositories {
>             maven {
>                 credentials {
>                     username aliMavenUsername
>                     password aliMavenPassword
>                 }
>                 url releaseUrl
>             }
>             maven {
>                 credentials {
>                     username aliMavenUsername
>                     password aliMavenPassword
>                 }
>                 url snapshotUrl
>             }
>         }
>     }
> }
> ```
>
> ```groovy
> // secret.gradle
> // è¿™ä¸ªæ²¡å­¦è¿‡ gradle çš„è¯å¯èƒ½çœ‹ä¸æ‡‚ï¼Œè¿™é‡Œä¸ä¼šè®²è§£ï¼Œä½ åªç®¡è¿™æ ·å†™å°±å¯ä»¥
> ext.aliMavenUsername = "ä½ çš„è´¦å·"
> ext.aliMavenPassword = "ä½ çš„å¯†ç "
> ext.releaseUrl = "ä½ çš„ç¨³å®šç‰ˆæœ¬å‘å¸ƒåœ°å€"
> ext.snapshotUrl = "ä½ çš„å¿«ç…§ç‰ˆæœ¬å‘å¸ƒåœ°å€"
> ```
>
> ```groovy
> // åœ¨ä½ è¦å‘å¸ƒçš„é¡¹ç›®é‡Œçš„ build.gradle
> apply from: "maven.gradle"
> 
> android {
>     // è¿™ä¸ªä¸œè¥¿åœ¨ä¹‹å‰ jitPack è®²è¿‡ï¼Œè¿™é‡Œå°±ä¸å†è®²äº†
>     publishing {
>         singleVariant "release"
>     }
> }
> ```
>
> **æ³¨æ„ï¼š**é€šå¸¸ä½ è¦å‘å¸ƒçš„é¡¹ç›®æ˜¯ä¸€ä¸ª `library`ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª `application`ï¼Œå› ä¸ºä¸€èˆ¬ `library` æ‰æ˜¯ç»™åˆ«äººä½¿ç”¨çš„ï¼Œè€Œ `application` æ˜¯ä¸€ä¸ªé¡¹ç›®çš„å…¥å£ï¼Œé€šå¸¸æ¥ä¾èµ– `library`
>
> OKï¼Œè¿™æ ·å°±é…ç½®å®Œäº†ï¼Œåˆ·æ–°ä¸€ä¸‹ gradleï¼Œå†ç‚¹å‡»å³ä¸Šè§’çš„ gradle æ ‡å¿—
>
> ![image-20220326234300251](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326234300251.png)
>
> ç‚¹å‡»è¿™ä¸ªå°±å¯ä»¥ç›´æŽ¥è¿è¡Œå‘å¸ƒåˆ° maven çš„ task
>
> <img src="D:/Typora/img/image-20220326234410761.png" alt="image-20220326234410761" style="zoom: 67%;" />
>
> > å¯èƒ½ä½ ä»¬æœ‰äº›äººæ‰¾ä¸åˆ°è¿™ä¸ªé€‰é¡¹ï¼Œå› ä¸ºæ–°ç‰ˆçš„ AS æŠŠè¿™ä¸ªé»˜è®¤å…³é—­äº†ï¼Œæˆ‘ä¹Ÿæžä¸æ‡‚ä¸ºå•¥ï¼Œä¸ºäº†è®©å¤§å®¶ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œä»»åŠ¡ï¼Ÿ
> >
> > åœ¨è¿™é‡Œè¿›è¡Œè®¾ç½®ï¼Œå°±èƒ½çœ‹å¾—åˆ°äº†
> >
> > ![image-20220326234634838](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220326234634838.png)
> >
> > 

### 12ã€åˆ†äº«ä¸€äº›ä¸œè¥¿

#### 1ã€Material Design å®˜ç½‘

> è°æƒ³å†™è‡ªå®šä¹‰ View å•Šï¼Œä½ æƒ³å†™å—ï¼Ÿæ­£ç»äººå†™ä»€ä¹ˆè‡ªå®šä¹‰ Viewã€‚
>
> è‡ªå®šä¹‰ View ç¡®å®žå¾ˆéš¾ï¼Œä¸œè¥¿åˆå¤šåˆæ‚ï¼Œåœ¨è€ƒè™‘å†™è‡ªå®šä¹‰ View ä¹‹å‰ï¼Œè¯·å…ˆæœç´¢ä¸€ä¸‹æ˜¯å¦æœ‰åˆ«äººå·²ç»é€ å¥½çš„è½®å­ï¼Œæœ‰è½®å­ç›´æŽ¥ç”¨ï¼Œä»–ä¸é¦™å—ï¼Ÿ[ç‹—å¤´]ï¼ŒMaterial Design å®˜ç½‘å°±åŒ…å«è®¸å¤šå®˜æ–¹è½®å­
>
> å®˜ç½‘é“¾æŽ¥ï¼šhttps://material.io/
>
> æºç åœ°å€ï¼šhttps://github.com/material-components/material-components-android
>
> ç¤ºä¾‹ä¸‹è½½ï¼šhttps://github.com/material-components/material-components-android/releases
>
> è¿™é‡Œé¢çš„éƒ½ç®—å®˜æ–¹æŽ§ä»¶ï¼Œè€Œä¸”æœ‰å¾ˆå¤šï¼Œå¦‚æžœæƒ³å®žçŽ°æŸä¸ªåŠŸèƒ½æ—¶å¯ä»¥åŽ»çœ‹çœ‹æ˜¯å¦å·²ç»æœ‰å®žçŽ°äº†çš„ï¼Œä»–è¿˜ä¸“é—¨å†™äº†ä¸€ä¸ªå®žä¾‹ appï¼Œå¯ä»¥ä¸‹ä¸‹æ¥çœ‹çœ‹ï¼Œæ‰¾åˆ°æƒ³è¦çš„å†åŽ»çœ‹ä»–çš„æºç 

#### 2ã€MotionLayout

> è¿™ä¸œè¥¿æˆ‘éƒ½è¿˜æ²¡æ€Žä¹ˆæ·±å…¥å­¦ä¹ ï¼Œå¯ä»¥åŽ»çœ‹çœ‹æŽ˜é‡‘ä¸Šçš„ä¸€äº›æ•™ç¨‹ï¼Œè¿™é‡Œæˆ‘å°±ä¸è®²äº† ï¼‰
>
> å®˜ç½‘ï¼šhttps://developer.android.google.cn/training/constraint-layout/motionlayout/examples?hl=zh_cn

#### 2ã€View#post()ã€posyDelay()ã€postOnAnimation()

> ##### é¢è¯•é¢˜ï¼š
>
> å¦‚ä½•åœ¨ `onCreate()` ä¸­å¾—åˆ° View çš„å®½å’Œé«˜ï¼Ÿ
>
> å“ˆå“ˆï¼Œè¿™ä¸æ˜¯æœ‰æ‰‹å°±è¡Œï¼Ÿ
>
> ```kotlin
> override fun onCreate(savedInstanceState: Bundle?) {
> 	super.onCreate(savedInstanceState)
> 	setContentView(com.ndhzs.lib.R.layout.layout_section7)
>         
> 	val view = findViewById<View>(com.ndhzs.lib.R.id.myView7)
> 	val width = view.width
> 	val height = view.height
> }
> ```
>
> ç„¶åŽé¢è¯•å®˜ç¬‘äº†ç¬‘ï¼Œä½ å°±è¢«åˆ·äº†
>
> åŽŸå› ï¼šè¿™ç§å†™æ³•å¾—åˆ°çš„å®½å’Œé«˜ç»“æžœæ˜¯ 0
>
> ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ
>
> å› ä¸ºå‰é¢æˆ‘ä»¬è®²åˆ°ï¼Œ`View#width` å’Œ `View#height` æ˜¯åœ¨ `onLayout()` ä¸­è®¾ç½®çš„ï¼Œè€Œ `onCreate()` æ­¤æ—¶è¿˜æ²¡æœ‰å¼€å§‹å¸ƒå±€ï¼Œåªæ˜¯è°ƒç”¨äº† `setContentView()` åŠ è½½äº†å¸ƒå±€ï¼Œä¸‰å¤§æµç¨‹è¿˜æ²¡æœ‰å¼€å§‹èµ°ï¼ŒçœŸæ­£å¼€å§‹èµ°ä¸‰å¤§æµç¨‹æ˜¯åœ¨ `onResume()` åŽï¼Œè¿™é‡Œæä¾›ä¸‹é¢å‡ ç§æ­£ç¡®æ–¹æ³•ï¼š
>
> > ##### 1ã€post()
> >
> > ```kotlin
> > val view = findViewById<View>(com.ndhzs.lib.R.id.myView7)
> > view.post {
> >     val width = view.width
> >     val height = view.height
> > }
> > ```
> >
> > åŽŸç†ï¼špost æ˜¯ç”¨ Handler å‘ä¸€ä¸ª Messageï¼Œè€Œ View å¯¹äºŽè‡ªå¸¦çš„ post åšäº†ç‰¹æ®Šå¤„ç†ï¼Œåªä¼šåœ¨ View è¢«æµ‹é‡åŽæ‰å¼€å§‹å‘ Message
> >
> > ##### 2ã€doOnLayout
> >
> > ```kotlin
> > val view = findViewById<View>(com.ndhzs.lib.R.id.myView7)
> > view.doOnLayout {
> >     val width = view.width
> >     val height = view.height
> > }
> > ```
> >
> > åŽŸç†ï¼šä½¿ç”¨ View çš„ä¸€ä¸ª `addOnLayoutChangeListener()` æ–¹æ³•ï¼Œç›‘å¬ View çš„ `onLayout()` å›žè°ƒ
>
> ##### å†æ¥ä¸ªé¢è¯•é¢˜ï¼š
>
> View çš„ `post()` åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ`postDelayed()` ä¼šé€ æˆå†…å­˜æ³„æ¼å—ï¼Ÿå¦‚æžœä¼šè¯¥æ€Žä¹ˆå¤„ç†ï¼Ÿ
>
> ç­”æ¡ˆï¼š
>
> 1ã€View çš„ `post()` åœ¨æ²¡æœ‰æ·»åŠ åˆ°å±å¹•å‰ä¼šå…ˆä¿å­˜ Runnable åœ¨ç¬¬ä¸€æ¬¡ `performTraversals` åˆ°æ¥æ—¶æ‰§è¡Œï¼Œå¦‚æžœå·²ç»æ·»åŠ å±å¹•ä¸Šï¼Œå°±ç›´æŽ¥äº¤ç»™ `mAttachInfo` çš„ `mHanlder` æ‰§è¡Œï¼Œè‡³äºŽè¿™ä¸ª `mHandler`ï¼Œæ˜¯ `ViewRootImpl` æŒæœ‰çš„ä¸€ä¸ª `ViewRootHandler` å¯¹è±¡
>
> 2ã€`postDelayed()` ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œå› ä¸ºå®ƒæ²¡ä¸»åŠ¨åˆ é™¤ä½ å‘é€çš„ Runnableï¼ˆå…¶å®ž `post()` ç†è®ºä¸Šä¹Ÿä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œä½†å› ä¸ºæ—¶é—´æžçŸ­ï¼Œçº¦ç­‰äºŽä¸æ³„æ¼ï¼‰
>
> 3ã€å¤„ç†çš„è¯ï¼Œå¯ä»¥åœ¨é‡å†™ View çš„ `onDetachedFromWindow()` æ–¹æ³•ä¸»åŠ¨å–æ¶ˆï¼Œæˆ–è€…å°è£…ä¸€ä¸‹æˆå•ç‹¬çš„ä¸€ä¸ªç±»ï¼Œä½¿ç”¨ `addOnAttachStateChangeListener()` ä¸“é—¨æ¥å‘ `postDelayed()`
>
> > å¦‚æžœé¢è¯•å®˜çœŸçš„åˆéš¾ä½ ï¼Œå¯èƒ½è¿˜ä¼šé—® `View#post()` åœ¨ä¸åŒç‰ˆæœ¬ä¸Šçš„å®žçŽ° (
> >
> > è¿™ä¸ªä½ ä»¬è‡ªå·±çœ‹æ–‡ç« å§ï¼šhttps://juejin.cn/post/6844903521804877832
> >
> > è¿˜æœ‰å¦‚ä½•æ£€æµ‹å†…å­˜æ³„æ¼ï¼Œè¿™ä¸ªè¿˜æ˜¯å¾—æä¸€ä¸‹ï¼Œä¸ç„¶ä¸æçš„è¯ï¼Œå¯èƒ½éƒ½ä¸ä¼šæœ‰äººçŸ¥é“
> >
> > ç›´æŽ¥ä½¿ç”¨ï¼šLeakCanary  https://github.com/square/leakcanary
> >
> > ç”¨æ³•å¾ˆç®€å•ï¼Œåªéœ€ä¸€è¡Œä»£ç å³å¯
> >
> > ```groovy
> > dependencies {
> >   // debugImplementation because LeakCanary should only run in debug builds.
> >   debugImplementation 'com.squareup.leakcanary:leakcanary-android:xxx'
> > }
> > ```
> >
> > ç„¶åŽå®ƒä¼šè‡ªå·±ç”Ÿæˆä¸€ä¸ªå¤šä½™çš„å›¾æ ‡ï¼Œåœ¨ä½ åº”ç”¨å‡ºçŽ°å†…å­˜æ³„æ¼æ—¶å¼¹çª—æé†’
> >
> > ![image-20220325155039418](https://img-1307243988.cos.ap-chengdu.myqcloud.com/typora/image-20220325155039418.png)
> >
> > å†…å­˜æ³„éœ²ä¹Ÿæ˜¯é¢è¯•çš„ç‚¹ï¼ˆ
>
> ##### æœ€åŽä¸€ä¸ªé¢è¯•é¢˜
>
> `postOnAnimation()` æ˜¯ä»€ä¹ˆï¼Ÿé€šå¸¸ç”¨äºŽä»€ä¹ˆæ—¶å€™ï¼Ÿ
>
> ä¸è¦è¢« Animation è¿·æƒ‘äº†ï¼Œè®¤ä¸ºè¿™ä¸ªæ˜¯ç”¨æ¥å‘é€åŠ¨ç”»çš„ï¼Œå¦‚æžœè¦è®²è¿™ä¸ªï¼Œæˆ‘ä»¬å…ˆä»Žå®˜æ–¹å¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ³•è®²èµ·ï¼Œå¦‚æžœä½ ç»å¸¸çœ‹å®˜æ–¹æŽ§ä»¶æºç ï¼Œä½ ä¼šå‘çŽ°ä¸‹é¢è¿™ä¸ªä¸œè¥¿å¸¸å‡ºçŽ°
>
> ```java
> ViewCompat.postOnAnimation()
> ```
>
> å¦‚æžœä½ åŽ»çœ‹ä¸€éå®ƒçš„æ³¨é‡Šï¼Œå°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå°±æ˜¯å°† Runnable åœ¨æ‰‹æœºçš„ä¸‹ä¸€å¸§æ‰§è¡Œï¼ˆå‰é¢è¯´è¿‡åˆ·æ–°çŽ‡ 60 çš„æ‰‹æœºæ¯å¸§ç›¸éš” 16 æ¯«ç§’ï¼‰ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨åœ¨ SDK 16 åŠä»¥ä¸Šå°±æ˜¯è°ƒç”¨çš„ `View#postOnAnimation()`
>
> é‚£è¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨åœºæ™¯å¦‚ä½•å‘¢ï¼Ÿ
>
> å®ƒå¸¸ç”¨äºŽä»£æ›¿ `ValueAnimator` åŠ¨ç”»ï¼ˆ`ValueAnimator` è¿™ç±»åŠ¨ç”»ä¸Ž `View#postOnAnimation()` å†…éƒ¨å®žçŽ°æ˜¯ä¸€æ ·çš„ï¼‰ï¼Œæ¯”å¦‚åœ¨ Rv çš„æƒ¯æ€§æ»‘åŠ¨ä¸­å°±ä¼šç”¨åˆ°è¿™ä¸ª `ViewCompat.postOnAnimation()`ï¼ˆä¸‹æ¬¡äº‹ä»¶åˆ†å‘æ—¶æ‰è®²ï¼‰
>
> æ‰€ä»¥ä½ ä¼šç»å¸¸çœ‹è§è¿™æ ·ä½¿ç”¨ï¼š
>
> ```java
> private Runnable mRunnable = new Runnable() {
> 	@Override
> 	public void run() {
> 		// ......
> 		ViewCompat.postOnAnimation(View.this, this)
>          // å¹³æ—¶å¼€å‘å¯ä»¥ç›´æŽ¥ä½¿ç”¨ View.postOnAnimation(View.this, this)
> 	}
> }
> // è¿™æ ·å°±å½¢æˆäº†ä¸€ç§éšå¼çš„é€’å½’ï¼Œåœ¨æ¯æ¬¡å±å¹•åˆ·æ–°æ—¶è°ƒç”¨ run()
> ```
>
> 

#### 3ã€View çš„ç”Ÿå‘½å‘¨æœŸ

> View ä¹Ÿæœ‰ä»€ä¹ˆå‘¨æœŸï¼Œä½† View çš„ç”Ÿå‘½å‘¨æœŸå¾ˆä¸å®Œå–„
>
> ```mermaid
> graph TB
> id1("æž„é€ å‡½æ•°ï¼ˆå¯¹åº” onCreate()ï¼‰")-->id2
> id2["onFinishInflate()ï¼ˆå¯¹åº” onCreate() ä¸­çš„ setContentView()ï¼‰"]-->id3
> id3["onAttachedToWindow()"]-->id4
> id4["onWindowVisbilityChanged()"]-->id5
> id5["onMeasure()"]-->id6
> id6["onLayout()"]-->id7
> id7["onDraw()"]-->id8
> id8["onWindowFocusChanged()"]-->id9
> id9["onWindowVisibilityChanged()"]-->id10
> id10["onDetachedFromWindow()"]
> ```
>
> ##### onFinishInflate()
>
>  ä»Ž xml ä¸­å®Œå…¨åŠ è½½å®Œæ—¶çš„å›žè°ƒ
>
> ##### onAttachedToWindow()
>
> å¼€å§‹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶çš„å›žè°ƒ
>
> ##### onWindowVisbilityChanged()
>
> çª—å£å¯è§æ€§æ”¹å˜çš„å›žè°ƒ
>
> ##### onWindowFocusChanged()
>
> çª—å£èŽ·å–ç„¦ç‚¹æ—¶çš„å›žè°ƒ
>
> ##### onDetachedFromWindow()
>
> View ä¸æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶çš„å›žè°ƒ
>
> å…¶ä»–çš„çœ‹çœ‹è¿™ç¯‡æ–‡ç« å§ï¼šhttps://www.jianshu.com/p/0a4cb44ce9d1
>
> å¯ä»¥çœ‹åˆ°å…¶å®ž View çš„ç”Ÿå‘½å‘¨æœŸä¸æ˜¯å¾ˆå®Œå–„ï¼Œç”šè‡³è¿žè‡ªèº«ä»€ä¹ˆæ—¶å€™è¢«æ·»åŠ è¿› ViewGroup éƒ½æ²¡æœ‰æ–¹æ³•å›žè°ƒï¼Œremove ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä½†å¦‚æžœæƒ³å®žçŽ° addView å’Œ removeView ç›‘å¬çš„è¯ï¼ŒæŸ¥çœ‹æºç åŽå‘çŽ°åªèƒ½ä½¿ç”¨ `ViewGroup#setOnHierarchyChangeListener()`ï¼Œæ„æ€æ˜¯åœ¨ View ä¸­é€šè¿‡ç»™ parent è®¾ç½®ç›‘å¬ï¼Œä½†è¿™ä¸ªæœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯åªèƒ½è®¾ç½®ä¸€æ¬¡ç›‘å¬

#### 4ã€è‡ªå®šä¹‰ View çš„ä¸€äº›è§„èŒƒ

> - åº”è¯¥å°½é‡è§£è€¦ï¼ŒView é‡Œé¢ä¸å»ºè®®åŒ…å« `ç½‘ç»œè¯·æ±‚`ã€`Rxjavaj`ã€`EventBus`ã€`Lifecycle ç›¸å…³ç»„ä»¶` ç­‰ï¼Œè¿™äº›åº”è¯¥æ˜¯ä¸»è¯­åº”ç”¨å±‚ä½¿ç”¨çš„ï¼Œè€Œä¸æ˜¯åœ¨ View é‡Œé¢ä½¿ç”¨ï¼ŒView é‡Œé¢åº”è¯¥å°½é‡ä½¿ç”¨ MVC çš„æ¨¡å¼æ¥å†™
> - å¯ä»¥åˆ†ç¦»ä¸€äº›èŒè´£å‡ºæ¥ï¼Œæ¯”å¦‚è¯¾è¡¨æˆ‘å°±æŠŠäº‹ä»¶å’Œç»˜åˆ¶é€šè¿‡è®¾ç½®ç›‘å¬çš„æ–¹å¼æ¥åˆ†ç¦»ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æ‰©å±•ï¼Œè€Œä¸æ˜¯å…¨éƒ¨å¡žåœ¨ View é‡Œé¢
>
> ##### åˆ†ç¦» Draw äº‹ä»¶
>
> ```kotlin
> // è‡ªå®šä¹‰ç»˜å›¾çš„ç›‘å¬
> private val mItemDecoration = ArrayList<ItemDecoration>(5)
> 
> final override fun dispatchDraw(canvas: Canvas) {
>     mItemDecoration.forEach {
>         it.onDrawBelow(canvas, this)
>     }
>     super.dispatchDraw(canvas)
>     mItemDecoration.forEach {
>         it.onDrawAbove(canvas, this)
>     }
> }
> 
> /**
>  * è¯¥ç±»ä¸»è¦ç”¨äºŽå®žçŽ°ä¸€äº›ç®€å•çš„ç»˜å›¾å¤„ç†
>  *
>  * ç»è¿‡æˆ‘çš„æ€è€ƒï¼Œæˆ‘è®¤ä¸ºä¸åº”è¯¥æä¾›åˆ é™¤çš„æ–¹æ³•ï¼ŒåŽŸå› å¦‚ä¸‹ï¼š
>  * - ä¸€èˆ¬ä¸ä¼šæœ‰éœ€è¦ä¸­é€”åˆ é™¤çš„æƒ…å†µ
>  * - å¾ˆå®¹æ˜“å‡ºçŽ°äº‹ä»¶åœ¨éåŽ†ä¸­å°±æŠŠå®ƒåˆ é™¤ï¼Œå¯¼è‡´å‡ºçŽ°éåŽ†è¶Šä½çš„é”™è¯¯
>  *
>  * è®¾è®¡å‚è€ƒäº† RV çš„ ItemDecoration
>  * @author 985892345 (Guo Xiangrui)
>  * @email 2767465918@qq.com
>  * @date 2022/1/27
>  */
> interface ItemDecoration {
>     /**
>      * åœ¨æ‰€æœ‰å­ View çš„ onDraw() å‰çš„å›žè°ƒï¼Œåœ¨è¿™é‡Œé¢ç»˜å›¾å¯ä»¥ç»˜åˆ¶åœ¨å­ View ä¸‹æ–¹
>      */
>     fun onDrawBelow(canvas: Canvas, view: View) { }
> 
>     /**
>      * åœ¨æ‰€æœ‰å­ View çš„ onDraw() åŽçš„å›žè°ƒï¼Œåœ¨è¿™é‡Œé¢ç»˜å›¾å¯ä»¥ç»˜åˆ¶åœ¨å­ View ä¸Šæ–¹
>      */
>     fun onDrawAbove(canvas: Canvas, view: View) { }
> }
> ```
>
> è¿˜æœ‰åˆ†ç¦»äº‹ä»¶åˆ†å‘ï¼Œæˆ‘å°±ç•™åˆ°ä¸‹æ¬¡è¯¾æ¥è®²äº†
>
> 

#### 5ã€å¸ƒå±€è°ƒè¯•è½¯ä»¶

> Android è°ƒè¯•åˆ©å™¨ Pandora
>
> ä¸€ä¸ªå¾ˆç‰›é€¼çš„ debug å·¥å…·ï¼Œå¯ä»¥åœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹å¸ƒå±€å±žæ€§ã€ç½‘ç»œè¯·æ±‚ã€sp ç­‰å¾ˆå¤šä¸œè¥¿
>
> https://www.wanandroid.com/blog/show/2183

#### 6ã€Rv æ€Žä¹ˆå¾—åˆ°æŸä¸ª item  çš„å®žä¾‹

> è¿™ä¸ç®—è‡ªå®šä¹‰ View çš„å†…å®¹ï¼Œå› ä¸ºå¯’å‡æ—¶æœ‰å¾ˆå¤šå­¦å¼Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è¿™é‡Œè®²è§£ä¸€ä¸‹å§
>
> å¾—åˆ°é‡Œé¢çš„ item æ›´å»ºè®®ä½¿ç”¨åœ¨ä¸éœ€è¦ä¿æŒçŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚æŸä¸ª item çš„å˜åŠ¨éœ€è¦åŠ è½½åŠ¨ç”»ï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•
>
> ```kotlin
> class RvAdapter : RecyclerView.Adapter<RvAdapter.RvVH>() {
>  class RvVH(itemView: View) : RecyclerView.ViewHolder(itemView) {
>      val mAnimationView: AnimationView = itemView.findViewById(R.id.item_animation)
>  }
> 
>  fun getVHolder(position: Int, call: VHolderCallback) {
>      // è°ƒç”¨ä¸¤ä¸ªå‚æ•°çš„è¿™ä¸ªåˆ·æ–°
>      notifyItemChanged(position, call)
>  }
> 
>  override fun onCreateViewHolder(
>      parent: ViewGroup, 
>      viewType: Int
>  ): RvVH {
>      return RvVH(
>          LayoutInflater
>          	.from(parent.context)
>          	.inflate(R.layout.layout_item, parent, false)
>      )
>  }
> 
>  // é‡å†™ä¸‰ä¸ªå‚æ•°çš„è¿™ä¸ªæ–¹æ³•
>  override fun onBindViewHolder(
>      holder: RvVH, 
>      position: Int, 
>      payloads: MutableList<Any>
>  ) {
>      if (payloads.isEmpty()) {
>          super.onBindViewHolder(holder, position, payloads)
>      } else {
>          // è¿™é‡Œå¾—åˆ° payloads å°±æ˜¯ä¹‹å‰åˆ·æ–°ä¼ å…¥çš„å›žè°ƒ
>          // å› ä¸ºæ˜¯åœ¨ä¸‹ä¸€å¸§æ‰ä¼šåˆ·æ–°ï¼ŒæœŸé—´å¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡åˆ·æ–° itemï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ª List
>          payloads.forEach {
>              if (it is VHolderCallback) {
>                  it.call(holder)
>              }
>          }
>      }
>  }
> 
>  override fun onBindViewHolder(holder: RvVH, position: Int) {
>  }
> 
>  override fun getItemCount(): Int = 100
> 
>  fun interface VHolderCallback {
>      fun call(holder: RvVH)
>  }
> }
> ```
>
> ä½¿ç”¨æ–¹å¼å°±æ˜¯è°ƒç”¨ `getVHolder()` å°±å¯ä»¥äº†
>
> ```kotlin
> getVHolder(1) {
>  // å¼€å§‹åŠ¨ç”»
>  it.mAnimationView.startAnim()
> }
> ```
>
> **æ³¨æ„ï¼š**
>
> - è¿™ç§æ–¹æ³•åœ¨å›žè°ƒæ—¶ä¸èƒ½è¿›è¡Œå»¶è¿Ÿä¿å­˜è¿”å›žçš„ holder å¯¹è±¡ï¼Œå› ä¸ºå®ƒåªæ˜¯ç›®å‰çŠ¶æ€ä¸‹çš„ holderï¼Œä¸èƒ½ä¿è¯åˆ·æ–°åŽä»æ˜¯è¿™ä¸ª
>
> - è¿™é‡Œé¢å¯¹ View çš„è®¾ç½®éƒ½æ˜¯æš‚æ—¶çš„ï¼Œæ‰€ä»¥æœ€å¼€å§‹æˆ‘å°±è¯´äº†ç”¨æ¥è°ƒç”¨ä¸€ä¸‹åŠ¨ç”»æ‰èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¦‚æžœæƒ³æ°¸ä¹…ä¿å­˜å»ºè®®ï¼š
>
>   - æ”¹å˜ä¼ å…¥ Rv çš„æ•°æ®é›†åˆï¼Œ
>   - æˆ–è€…è°ƒç”¨ `ViewHolder#setIsRecyclable(false)`ï¼Œä½†è¦è®°å¾—åœ¨ä¹‹åŽè¿˜åŽŸï¼Œä¸ç„¶è¿™ä¸ª ViewHolder å°±ä¸ä¼šè¢«å›žæ”¶
>
> - è¿™ç§æƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼š
>
>   ```kotlin
>   getVHolder(1) {
>       // å¼€å§‹åŠ¨ç”»
>       it.setIsRecyclable(false)
>       it.mAnimationView.startAnim()
>   }
>   // åŽé¢è°ƒç”¨è¿™ä¸ªè¿›è¡Œæ™®é€šåˆ·æ–°ï¼Œåªè¦å‡ºçŽ°äº†è¿™ä¸ªï¼Œå‰é¢çš„ç‰¹æ®Šåˆ·æ–°éƒ½ä¼šå¤±æ•ˆ
>   notifyItemChanged(1)
>   ```
>
> å¯¹äºŽå·®åˆ†åˆ·æ–°ä¹Ÿæœ‰ä¸€ä¸ªä¸Ž payload ç›¸å…³çš„æ–¹æ³•
>
> ```kotlin
> // è¿™ä¸ªæ˜¯ ItemCallbackï¼Œä½†ä¸Ž DiffUtil.Callback æ˜¯å·®ä¸å¤šçš„
> object : DiffUtil.ItemCallback<ICourseVpBean>() {
>     override fun areItemsTheSame(
>         oldItem: ICourseVpBean,
>         newItem: ICourseVpBean
>     ): Boolean {
>         return oldItem.week == newItem.week
>     }
> 
>     override fun areContentsTheSame(
>         oldItem: ICourseVpBean,
>         newItem: ICourseVpBean
>     ): Boolean {
>         return oldItem == newItem
>     }
> 
>     // å°±è¿™ä¸ªæ–¹æ³•ï¼Œå»ºè®®é‡å†™å¹¶ä¸è¿”å›ž
>     override fun getChangePayload(
>         oldItem: ICourseVpBean, 
>         newItem: ICourseVpBean
>     ): Any {
>         return "" // åªè¦ä¸ä¸º null å°±å¯ä»¥åœ¨åˆ·æ–°æ—¶åŽ»æŽ‰ä¸Žç¼“å­˜çš„äº’æ¢ï¼Œå‡å°‘æ€§èƒ½çš„æ¶ˆè€—
>     }
> }
> ```

## äºŒã€åŠ¨ç”»

> åŠ¨ç”»è¿™ä¸œè¥¿å»ºè®®çœ‹ã€ŠAndroidè‡ªå®šä¹‰æŽ§ä»¶å¼€å‘å…¥é—¨ä¸Žå®žæˆ˜ã€‹å’Œä¸‹é¢è¿™ç½‘å€ï¼Œæˆ‘è¿™é‡Œå°±ä¸è¿›è¡Œè®²è§£äº†
>
> https://qijian.blog.csdn.net/article/details/50995268
>
> æœ¬èŠ‚è¯¾ä¸»è¦è®²å…ƒç´ å…±äº«åŠ¨ç”»
>
> å› ä¸ºæ—¶é—´å…³ç³»å†™ä¸äº†äº†ï¼ˆè¿™è¯¾ä»¶ç¡®å®žæŠŠæˆ‘å†™ç´¯äº†ï¼‰ï¼Œè¿™é‡Œç»™å‡ºä¸€äº›ç½‘å€ï¼š
>
> - https://juejin.cn/post/6844903727015395336
>
>   > è¿™ä¸ªä¸»è¦å†™äº† activity ä¹‹é—´çš„å…ƒç´ å…±äº«ï¼Œä¾‹å­è¾ƒå…¨
>
> - https://blog.csdn.net/qq_29425853/article/details/53104919
>
>   